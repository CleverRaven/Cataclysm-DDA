window.storyFormat({
  "name": "cdda_twison",
  "version": "0.0.2",
  "author": "SittingDucken",
  "description": "Export your Twine 2 story as a JSON document for CDDA NPC talk topics",
  "proofing": false,
  "source": "<html>\r\n  <head>\r\n    <title>{{STORY_NAME}}</title>\r\n    <script type=\"text/javascript\">\r\n      /**\r\n       * CDDA Twison - Twine 2 JSON talk-topic formated Export Story Format\r\n       *\r\n       * Copyright (c) 2025 Sitting Ducken\r\n       * https://github.com/SittingDucken/sittingducken.github.io\r\n       *\r\n       * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and\r\n       * associated documentation files (the \"Software\"), to deal in the Software without restriction,\r\n       * including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,\r\n       * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so,\r\n       * subject to the following conditions:\r\n       *\r\n       * The above copyright notice and this permission notice shall be included in all copies or substantial\r\n       * portions of the Software.\r\n       *\r\n       * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT\r\n       * LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\r\n       * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\r\n       * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\r\n       * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n       */\r\n      var Twison={extractLinksFromText:function(t){var e=t.match(/\\[\\[.+?\\]\\]/g);const n=/\\{\\{((\\s|\\S)+?)\\}\\}((\\s|\\S)+?)\\{\\{\\/\\1\\}\\}/gm;if(!e)return null;var r=t.split(\"\\n\"),a=[];return r.forEach(function(t){var e=t.match(/\\[\\[.+?\\]\\]/g);e&&e.forEach(function(e){var r={},s=e.substring(2,e.length-2),o=t.replace(e,\"\").replace(n,\"\").trim(),i=Twison.extractPropsFromText(t);r.topic=s,r.text=o,i&&Object.assign(r,i),a.push(r)})}),a},extractPropsFromText:function(t){var e,n={},r=!1;const a=/\\{\\{((\\s|\\S)+?)\\}\\}((\\s|\\S)+?)\\{\\{\\/\\1\\}\\}/gm;for(;null!==(e=a.exec(t));){const s=e[1],o=e[3].replace(/(\\r\\n|\\n|\\r)/gm,\"\"),i=this.extractPropsFromText(o);n[s]=null!==i?i:o,r=!0}return r?n:null},convertPassage:function(t){var e={text:t.innerHTML};if(e.topic=\"talk_topic\",[\"name\",\"tags\"].forEach(function(n){var r=t.attributes[n].value;r&&(e[n]=r)}),e.name&&(e.id=e.name,delete e.name),e.text){for(var n=e.text.split(\"\\n\"),r=[],a=0;a<n.length;a++){var s=n[a].trim();if(s.match(/\\[\\[.+?\\]\\]/))break;r.push(s)}e.dynamic_line=r.join(\"\\n\").trim();const o=/\\{\\{((\\s|\\S)+?)\\}\\}((\\s|\\S)+?)\\{\\{\\/\\1\\}\\}/gm;var i=Twison.extractPropsFromText(e.dynamic_line);e.dynamic_line=i||e.dynamic_line.replace(o,\"\").trim()}var c=Twison.extractLinksFromText(e.text);return c&&(e.responses=c),e.tags&&(e.tags=e.tags.split(\" \")),e},convertStory:function(t){var e=t.getElementsByTagName(\"tw-passagedata\"),n=Array.prototype.slice.call(e).map(Twison.convertPassage).filter(function(t){return t&&\"TALK_DONE\"!==t.id&&\"TALK_NONE\"!==t.id}),r={passages:n};return r.passages.forEach(function(t){t.text&&delete t.text}),r.passages},convert:function(){var t=document.getElementsByTagName(\"tw-storydata\")[0],e=JSON.stringify(Twison.convertStory(t),null,2);document.getElementById(\"output\").innerHTML=e}};window.Twison=Twison;\r\n    </script>\r\n  </head>\r\n  <body>\r\n    <pre id=\"output\"></pre>\r\n    <div id=\"storyData\" style=\"display: none;\">\r\n      {{STORY_DATA}}\r\n    </div>\r\n    <script>\r\n      Twison.convert();\r\n    </script>\r\n  </body>\r\n</html>\r\n"
});