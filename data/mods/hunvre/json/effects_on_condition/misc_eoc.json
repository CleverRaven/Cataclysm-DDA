[
  {
    "id": "EOC_CHANGE_FURNITURE",
    "type": "effect_on_condition",
    "//": "We're using a special terrain to orient the spawns correctly, it was the least bad option.",
    "effect": [
      { "u_location_variable": { "context_val": "offset_position" } },
      { "math": [ "_offset_position.x = _pos.x" ] },
      { "math": [ "_offset_position.y = _pos.y - 1" ] },
      {
        "if": { "map_terrain_id": "t_ret_furn_target", "loc": { "context_val": "offset_position" } },
        "else": [
          { "math": [ "_offset_position.x += 1" ] },
          { "math": [ "_offset_position.y += 1" ] },
          {
            "if": { "map_terrain_id": "t_ret_furn_target", "loc": { "context_val": "offset_position" } },
            "else": [
              { "math": [ "_offset_position.x -= 1" ] },
              { "math": [ "_offset_position.y += 1" ] },
              {
                "if": { "map_terrain_id": "t_ret_furn_target", "loc": { "context_val": "offset_position" } },
                "else": [ { "math": [ "_offset_position.x -= 1" ] }, { "math": [ "_offset_position.y -= 1" ] } ]
              }
            ]
          }
        ]
      },
      { "run_eocs": [ "EOC_CHANGE_FURNITURE1" ] }
    ]
  },
  {
    "id": "EOC_CHANGE_FURNITURE1",
    "type": "effect_on_condition",
    "effect": [ { "run_eoc_selector": [ "EOC_CHANGE_TO_BED", "EOC_CHANGE_TO_SHOWER" ] } ]
  },
  {
    "id": "EOC_CHANGE_TO_BED",
    "type": "effect_on_condition",
    "effect": [
      { "target_var": { "context_val": "pos" }, "u_transform_radius": 0, "ter_furn_transform": "furn_to_bed" },
      {
        "target_var": { "context_val": "offset_position" },
        "u_transform_radius": 0,
        "ter_furn_transform": "furn_to_bed"
      }
    ]
  },
  {
    "id": "EOC_CHANGE_TO_SHOWER",
    "type": "effect_on_condition",
    "effect": [
      { "target_var": { "context_val": "pos" }, "u_transform_radius": 0, "ter_furn_transform": "furn_to_shower" },
      {
        "target_var": { "context_val": "offset_position" },
        "u_transform_radius": 0,
        "ter_furn_transform": "furn_to_null"
      }
    ]
  },
  {
    "type": "ter_furn_transform",
    "id": "furn_to_bed",
    "furniture": [ { "result": "f_bed_retractable", "valid_furniture": [ "f_null", "f_shower_retractable", "f_bed_retractable" ] } ]
  },
  {
    "type": "ter_furn_transform",
    "id": "furn_to_shower",
    "furniture": [ { "result": "f_shower_retractable", "valid_furniture": [ "f_null", "f_shower_retractable", "f_bed_retractable" ] } ]
  },
  {
    "type": "ter_furn_transform",
    "id": "furn_to_null",
    "furniture": [ { "result": "f_null", "valid_furniture": [ "f_null", "f_shower_retractable", "f_bed_retractable" ] } ]
  },
  {
    "id": "EOC_INTERACT_AIRLOCK",
    "type": "effect_on_condition",
    "effect": [
      { "u_query_tile": "anywhere", "target_var": { "context_val": "piratable_tile" } },
      {
        "if": { "map_terrain_id": "t_airlock_control", "loc": { "context_val": "piratable_tile" } },
        "then": { "mapgen_update": "open_airlock", "target_var": { "context_val": "piratable_tile" } },
        "else": { "u_message": "ERROR" }
      }
    ]
  },
  {
    "type": "mapgen",
    "update_mapgen_id": "open_airlock",
    "object": { "place_nested": [ { "chunks": [ "24x24_sidewalk_airlock_open" ], "x": 0, "y": 0 } ] }
  }
]
