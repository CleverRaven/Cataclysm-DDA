[
  {
    "type": "effect_on_condition",
    "id": "EOC_ISO_GRABBED_ARMS_MAKES_SOMATIC_SPELLS_HARDER",
    "eoc_type": "EVENT",
    "required_event": "opens_spellbook",
    "condition": {
      "and": [
        { "or": [ { "u_has_effect": "grabbed", "bodypart": "arm_r" }, { "u_has_effect": "grabbed", "bodypart": "arm_l" } ] },
        { "not": { "u_has_flag": "SUBTLE_SPELL" } }
      ]
    },
    "effect": [
      {
        "math": [
          "u_spellcasting_adjustment('difficulty', 'school': 'iso_eldritch_sorcery', 'flag_whitelist': 'SOMATIC' )",
          "=",
          "(u_effect_intensity('grabbed', 'bodypart': 'arm_l') + u_effect_intensity('grabbed', 'bodypart': 'arm_r') ) / 10"
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ISO_GRABBED_HANDS_MAKES_SOMATIC_SPELLS_HARDER",
    "eoc_type": "EVENT",
    "required_event": "opens_spellbook",
    "condition": {
      "and": [
        { "or": [ { "u_has_effect": "grabbed", "bodypart": "hand_r" }, { "u_has_effect": "grabbed", "bodypart": "hand_l" } ] },
        { "not": { "u_has_flag": "SUBTLE_SPELL" } }
      ]
    },
    "effect": [
      {
        "math": [
          "u_spellcasting_adjustment('difficulty', 'school': 'iso_eldritch_sorcery', 'flag_whitelist': 'SOMATIC' )",
          "=",
          "(u_effect_intensity('grabbed', 'bodypart': 'hand_l') + u_effect_intensity('grabbed', 'bodypart': 'hand_r') ) / 5"
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ISO_NOT_WIELDING_STAFF_MAKES_SORCERY_HARDER",
    "eoc_type": "EVENT",
    "required_event": "opens_spellbook",
    "condition": { "not": { "u_has_wielded_with_flag": "MAGIC_FOCUS" } },
    "effect": [
      { "math": [ "u_spellcasting_adjustment('cost', 'school': 'iso_eldritch_sorcery'", "=", "0.5" ] },
      { "math": [ "u_spellcasting_adjustment('casting_time', 'school': 'iso_eldritch_sorcery'", "=", "1" ] }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_LAST_SCION_RETURN_STAFF",
    "condition": { "u_has_trait": "iso_eldritch_sorcery" },
    "effect": [
      {
        "u_run_inv_eocs": "all",
        "search_data": [ { "id": [ "iso_sorcerers_staff" ] } ],
        "false_eocs": [
          {
            "id": "EOC_LAST_SCION_RETURN_STAFF_2",
            "effect": [
              { "u_spawn_item": "iso_sorcerers_staff", "suppress_message": true },
              { "u_message": "Your lost staff has returned to you.", "type": "good" }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ISO_LAST_SCION_SPELL_GAINING_WHEN_PICK_UP_GUN",
    "eoc_type": "EVENT",
    "required_event": "character_wields_item",
    "condition": { "and": [ { "u_has_wielded_with_skill": "gun" }, { "u_has_trait": "iso_eldritch_sorcery" } ] },
    "effect": [
      {
        "if": { "u_has_wielded_with_ammotype": "10mm" },
        "then": [
          { "set_string_var": "iso_eldritch_cone_lightning", "target_var": { "global_val": "new_last_scion_spell_id" } },
          {
            "set_string_var": "Stormtenders' Fulminating Fury",
            "target_var": { "global_val": "new_last_scion_spell_name" }
          },
          { "run_eocs": "EOC_ISO_LAST_SCION_SPELL_GAINING_CHOOSE_SLOT" }
        ]
      },
      {
        "if": { "u_has_wielded_with_ammotype": "223" },
        "then": [
          { "set_string_var": "iso_eldritch_cold_damage_blast", "target_var": { "global_val": "new_last_scion_spell_id" } },
          {
            "set_string_var": "The Frozen Heart of R'shothai",
            "target_var": { "global_val": "new_last_scion_spell_name" }
          }
        ]
      },
      {
        "if": { "u_has_wielded_with_ammotype": "9mm" },
        "then": [
          { "set_string_var": "iso_eldritch_blink", "target_var": { "global_val": "new_last_scion_spell_id" } },
          {
            "set_string_var": "The Transportations of Immenar",
            "target_var": { "global_val": "new_last_scion_spell_name" }
          },
          { "run_eocs": "EOC_ISO_LAST_SCION_SPELL_GAINING_CHOOSE_SLOT" }
        ]
      },
      {
        "if": { "u_has_wielded_with_ammotype": "3006" },
        "then": [
          { "set_string_var": "iso_eldritch_polymorph", "target_var": { "global_val": "new_last_scion_spell_id" } },
          {
            "set_string_var": "Tsath's Horrific Metamorphosis",
            "target_var": { "global_val": "new_last_scion_spell_name" }
          },
          { "run_eocs": "EOC_ISO_LAST_SCION_SPELL_GAINING_CHOOSE_SLOT" }
        ]
      },
      {
        "if": { "or": [ { "u_has_wielded_with_ammotype": "45" }, { "u_has_wielded_with_ammotype": "45colt" } ] },
        "then": [
          { "set_string_var": "iso_eldritch_imprisonment", "target_var": { "global_val": "new_last_scion_spell_id" } },
          {
            "set_string_var": "The Adamantine Gaol of Emthys",
            "target_var": { "global_val": "new_last_scion_spell_name" }
          },
          { "run_eocs": "EOC_ISO_LAST_SCION_SPELL_GAINING_CHOOSE_SLOT" }
        ]
      },
      {
        "if": { "u_has_wielded_with_ammotype": "50" },
        "then": [
          { "set_string_var": "iso_eldritch_polymorph", "target_var": { "global_val": "new_last_scion_spell_id" } },
          {
            "set_string_var": "Tsath's Horrific Metamorphosis",
            "target_var": { "global_val": "new_last_scion_spell_name" }
          },
          { "run_eocs": "EOC_ISO_LAST_SCION_SPELL_GAINING_CHOOSE_SLOT" }
        ]
      },
      {
        "u_run_inv_eocs": "all",
        "search_data": [ { "wielded_only": true } ],
        "true_eocs": [ { "id": "EOC_ISO_LAST_SCION_DESTROY_GUN_WHEN_PICK_UP_GUN", "effect": [ "npc_die" ] } ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ISO_LAST_SCION_SPELL_GAINING_CHOOSE_SLOT",
    "effect": [
      {
        "run_eoc_selector": [ "EOC_ISO_LAST_SCION_SPELL_GAINING_CHOOSE_SLOT_1", "EOC_ISO_LAST_SCION_SPELL_GAINING_CHOOSE_SLOT_2" ],
        "names": [ "Add <global_val:new_last_scion_spell_name> to Slot 1", "Add <global_val:new_last_scion_spell_name> to Slot 2" ],
        "keys": [ "1", "2" ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ISO_LAST_SCION_SPELL_GAINING_CHOOSE_SLOT_1",
    "condition": {
      "u_query": "This will teleport you back to your sky island.  Any items inside the room will be teleported home alongside you.  Are you ready to leave?",
      "default": false
    },
    "effect": [  ]
  }
]
