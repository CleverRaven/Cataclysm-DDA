[
  {
    "type": "effect_on_condition",
    "id": "EOC_CONDITION_BANNED_DREAM_MAGIC_TRAITS",
    "condition": {
      "not": {
        "u_has_any_trait": [
          "CHANGELING_MAGIC",
          "NATIVE_SHAPESHIFTER",
          "BLOODTHORNE_DRUID_SYMBIOTIC_PLANT",
          "LILIN_TRAITS",
          "GRACKEN",
          "ARVORE",
          "IERDE",
          "HOMULLUS",
          "SALAMANDER",
          "SYLPH",
          "UNDINE",
          "VAMPIRE"
        ]
      }
    },
    "effect": [  ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CONDITIONS_VAMPIRE_DRINK_BLOOD_WITH_FANGS_MOM",
    "condition": { "math": [ "0 == 1" ] },
    "effect": [  ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CONDITIONS_WEREWOLF_HUNT_TARGETS",
    "condition": {
      "or": [
        { "npc_has_species": "NETHER" },
        { "npc_has_species": "NETHER_BURROWING" },
        { "npc_has_species": "NETHER_EMANATION" },
        { "npc_has_species": "PLANT" },
        { "npc_has_species": "ARVORE" },
        { "npc_has_species": "CHANGELING" },
        { "npc_has_species": "CHANGELING_NOBLE" },
        { "npc_has_species": "IERDE" },
        { "npc_has_species": "HOMULLUS" },
        { "npc_has_species": "SALAMANDER" },
        { "npc_has_species": "SYLPH" },
        { "npc_has_species": "UNDINE" },
        { "npc_has_species": "VAMPIRE" },
        { "npc_has_species": "VAMPIRE_ANATHEMA" },
        { "npc_has_trait": "VAMPIRE" }
      ]
    },
    "effect": [  ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CONDITIONS_YOU_ARE_A_PLAYABLE_CHANGELING",
    "condition": {
      "u_has_any_trait": [
        "UNKNOWING_CHANGELING_NOBLE",
        "UNKNOWING_CHANGELING_COMMONER_BROWNIE",
        "UNKNOWING_CHANGELING_COMMONER_POOKA",
        "UNKNOWING_CHANGELING_COMMONER_SELKIE",
        "UNKNOWING_CHANGELING_COMMONER_TROW"
      ]
    },
    "effect": [  ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CONDITION_XE_VAMPIRE_AVOID_BURNING_IN_SUNLIGHT",
    "condition": { "and": [ { "not": { "u_has_effect": "vampire_blind_the_sun" } } ] },
    "effect": [  ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_DREAMS_AND_NIGHTMARES",
    "eoc_type": "EVENT",
    "required_event": "character_wakes_up",
    "condition": {
      "and": [
        { "math": [ "dream_counter == 0" ] },
        { "not": { "u_has_trait": "VAMPIRE4" } },
        { "not": { "u_has_trait": "LILIN_TRAITS" } },
        { "not": { "u_has_trait": "IERDE" } },
        { "not": { "u_has_trait": "ARVORE" } },
        { "not": { "u_has_trait": "SALAMANDER" } },
        { "not": { "u_has_trait": "UNDINE" } },
        { "not": { "u_has_trait": "SYLPH" } },
        { "not": { "u_has_trait": "HOMULLUS" } },
        { "not": { "u_has_trait": "THRESH_FAIR_FOLK_COMMONER_POOKA" } },
        { "not": { "u_has_trait": "THRESH_FAIR_FOLK_COMMONER_BROWNIE" } },
        { "not": { "u_has_trait": "THRESH_FAIR_FOLK_COMMONER_TROW" } },
        { "not": { "u_has_trait": "THRESH_FAIR_FOLK_COMMONER_SELKIE" } },
        { "not": { "u_has_trait": "THRESH_FAIR_FOLK_NOBLE" } },
        { "not": { "u_has_trait": "GRACKEN" } }
      ]
    },
    "effect": [ { "run_eocs": "EOC_DREAMS_OR_NIGHTMARES_EDGE_CASES" } ],
    "false_effect": [ { "run_eocs": "EOC_DREAMS_OR_NIGHTMARES_MANA?" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_DREAMS_OR_NIGHTMARES_EDGE_CASES",
    "condition": { "or": [ { "u_has_trait": "VAMPIRE4" }, { "u_has_trait": "LILIN_TRAITS" } ] },
    "effect": [ { "u_message": "undead_wake_up", "snippet": true, "type": "neutral" } ],
    "false_effect": [ { "u_message": "fae_wake_up", "snippet": true, "type": "neutral" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_DREAMS_OR_NIGHTMARES_MANA?",
    "condition": { "or": [ { "u_has_trait": "DREAMER" }, { "u_has_trait": "EATER" } ] },
    "effect": [ { "run_eocs": "EOC_DREAMS_OR_NIGHTMARES_MANA" } ],
    "false_effect": [ { "run_eocs": "EOC_DREAMS_OR_NIGHTMARES_NO_MANA" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_DREAMS_OR_NIGHTMARES_MANA",
    "condition": { "or": [ { "one_in_chance": 2 }, { "u_has_effect": "effect_hedge_no_nightmares" } ] },
    "effect": [
      { "u_message": "sweet_dreams", "snippet": true, "type": "bad" },
      { "u_add_morale": "morale_sweet_dreams", "bonus": [ 15, 40 ], "max_bonus": 40 },
      { "math": [ "dream_counter = 1" ] },
      { "u_cast_spell": { "id": "dream_mana_gain" } },
      { "run_eocs": "EOC_RESET_DREAM_COUNTER", "time_in_future": 1 }
    ],
    "false_effect": [
      { "u_message": "nightmares", "snippet": true, "type": "bad" },
      { "u_add_morale": "morale_nightmare", "bonus": [ -15, -40 ], "max_bonus": -40 },
      { "math": [ "dream_counter = 1" ] },
      { "u_cast_spell": { "id": "nightmare_mana_gain" } },
      { "run_eocs": "EOC_RESET_DREAM_COUNTER", "time_in_future": 1 }
    ]
  },
  {
    "id": "dream_mana_gain",
    "type": "SPELL",
    "name": { "str": "Mana gain from dreams", "//~": "NO_I18N" },
    "description": "You consume dreamdross to regain mana.  Pretty tasty.",
    "valid_targets": [ "self" ],
    "min_damage": 75,
    "damage_increment": 1,
    "max_damage": 110,
    "max_level": { "math": [ "max(eater_level(1), dreamer_level(1))" ] },
    "effect": "recover_energy",
    "effect_str": "MANA",
    "shape": "blast",
    "spell_class": "CLASSLESS",
    "skill": "deduction",
    "base_casting_time": 0,
    "base_energy_cost": 0,
    "extra_effects": [ { "id": "lucid_dreaming_bonus" } ],
    "flags": [ "SILENT", "NO_LEGS", "NO_HANDS", "NO_EXPLOSION_SFX" ]
  },
  {
    "id": "nightmare_mana_gain",
    "type": "SPELL",
    "name": { "str": "Mana gain from nightmares", "//~": "NO_I18N" },
    "description": "You consume dreamdross to regain mana.  Pretty tasty.",
    "valid_targets": [ "self" ],
    "min_damage": 35,
    "damage_increment": 1,
    "max_damage": 76,
    "effect": "recover_energy",
    "effect_str": "MANA",
    "max_level": { "math": [ "max(max(eater_level(1), dreamer_level(1))" ] },
    "shape": "blast",
    "spell_class": "CLASSLESS",
    "skill": "deduction",
    "base_casting_time": 0,
    "base_energy_cost": 0,
    "extra_effects": [ { "id": "lucid_dreaming_bonus" } ],
    "flags": [ "SILENT", "NO_LEGS", "NO_HANDS", "NO_EXPLOSION_SFX" ]
  },
  {
    "id": "lucid_dreaming_bonus",
    "type": "SPELL",
    "name": { "str": "Lucid Dreaming Bonus Mana", "//~": "NO_I18N" },
    "description": { "str": "Bonus mana from lucid dreaming proficiency.", "//~": "NO_I18N" },
    "valid_targets": [ "self" ],
    "effect": "effect_on_condition",
    "shape": "blast",
    "flags": [ "SILENT", "NO_EXPLOSION_SFX", "RANDOM_DAMAGE" ],
    "min_damage": { "math": [ "lucid_dreaming_proficiency_modifier(4)" ] },
    "max_damage": { "math": [ "lucid_dreaming_proficiency_modifier(8)" ] }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_DREAMS_OR_NIGHTMARES_NO_MANA",
    "condition": { "or": [ { "one_in_chance": 2 }, { "u_has_effect": "effect_hedge_no_nightmares" } ] },
    "effect": [
      { "u_message": "sweet_dreams", "snippet": true, "type": "bad" },
      { "u_add_morale": "morale_sweet_dreams", "bonus": [ 15, 40 ], "max_bonus": 40 },
      { "math": [ "dream_counter = 1" ] },
      { "run_eocs": "EOC_RESET_DREAM_COUNTER", "time_in_future": 1 }
    ],
    "false_effect": [
      { "u_message": "XE_BAD_DREAMS", "snippet": true, "type": "bad" },
      { "u_add_morale": "morale_nightmare", "bonus": [ -15, -40 ], "max_bonus": -40 },
      { "math": [ "dream_counter = 1" ] },
      { "run_eocs": "EOC_RESET_DREAM_COUNTER", "time_in_future": 1 }
    ]
  }
]
