[
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_PREVENT_TOO_MANY_DREAMS",
    "eoc_type": "EVENT",
    "required_event": "character_falls_asleep",
    "condition": { "math": [ "u_fae_dream_count", ">", "0" ] },
    "effect": [ { "math": [ "u_fae_dream_count", "--" ] } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_COMMONER_CHOOSE_HERITAGE",
    "eoc_type": "EVENT",
    "required_event": "character_wakes_up",
    "condition": { "test_eoc": "EOC_TEST_CHANGELING_COMMONER_INITIAL_CONDITIONS" },
    "effect": [
      {
        "u_message": "That night, you dream of your parents and the unknown place of your birth.  Who were they?",
        "type": "info"
      },
      {
        "run_eoc_selector": [
          "EOC_PLAYABLE_CHANGELING_COMMONER_CHOOSE_HERITAGE_BROWNIE",
          "EOC_PLAYABLE_CHANGELING_COMMONER_CHOOSE_HERITAGE_POOKA",
          "EOC_PLAYABLE_CHANGELING_COMMONER_CHOOSE_HERITAGE_SELKIE",
          "EOC_PLAYABLE_CHANGELING_COMMONER_CHOOSE_HERITAGE_TROW"
        ],
        "names": [ "Brownie", "Pooka", "Selkie", "Trow" ],
        "title": "What is your heritage?",
        "descriptions": [
          "Your parents were brownies, the simple, down-to-earth crafters of the fae.",
          "Your parents were pookas, shapechangers that can take animal forms.",
          "Your parents were selkies, who spend part of the time upon land and part of the time as a seal in the sea",
          "Your parents were trow, tough as stone, who dwell beneath the earth."
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_COMMONER_CHOOSE_HERITAGE_BROWNIE",
    "condition": { "test_eoc": "EOC_TEST_CHANGELING_COMMONER_INITIAL_CONDITIONS" },
    "effect": [
      { "u_add_trait": "FAIR_FOLK_COMMONER_BROWNIE" },
      { "u_add_trait": "UNKNOWING_CHANGELING_COMMONER_CHOICE" },
      { "u_message": "XE_CHANGELING_COMMONER_BROWNIE", "type": "neutral", "snippet": true }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_COMMONER_CHOOSE_HERITAGE_POOKA",
    "condition": { "test_eoc": "EOC_TEST_CHANGELING_COMMONER_INITIAL_CONDITIONS" },
    "effect": [
      { "u_add_trait": "FAIR_FOLK_COMMONER_POOKA" },
      { "u_add_trait": "UNKNOWING_CHANGELING_COMMONER_CHOICE" },
      { "u_message": "XE_CHANGELING_COMMONER_POOKA", "type": "neutral", "snippet": true }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_COMMONER_CHOOSE_HERITAGE_SELKIE",
    "condition": { "test_eoc": "EOC_TEST_CHANGELING_COMMONER_INITIAL_CONDITIONS" },
    "effect": [
      { "u_add_trait": "FAIR_FOLK_COMMONER_SELKIE" },
      { "u_add_trait": "UNKNOWING_CHANGELING_COMMONER_CHOICE" },
      { "u_message": "XE_CHANGELING_COMMONER_SELKIE", "type": "neutral", "snippet": true }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_COMMONER_CHOOSE_HERITAGE_TROW",
    "condition": { "test_eoc": "EOC_TEST_CHANGELING_COMMONER_INITIAL_CONDITIONS" },
    "effect": [
      { "u_add_trait": "FAIR_FOLK_COMMONER_TROW" },
      { "u_add_trait": "UNKNOWING_CHANGELING_COMMONER_CHOICE" },
      { "u_message": "XE_CHANGELING_COMMONER_TROW", "type": "neutral", "snippet": true }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_NOBLE_NEW_POWERS",
    "eoc_type": "EVENT",
    "required_event": "character_wakes_up",
    "condition": {
      "and": [ { "u_has_trait": "UNKNOWING_CHANGELING_NOBLE" }, { "math": [ "u_vitamin('changeling_dreams')", ">=", "1" ] } ]
    },
    "effect": [ { "run_eocs": "EOC_PLAYABLE_CHANGELING_NOBLE_NEW_POWERS_REAL" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_BROWNIE_NEW_POWERS",
    "eoc_type": "EVENT",
    "required_event": "character_wakes_up",
    "condition": {
      "and": [
        { "u_has_trait": "UNKNOWING_CHANGELING_COMMONER" },
        { "u_has_trait": "FAIR_FOLK_COMMONER_BROWNIE" },
        { "math": [ "u_vitamin('changeling_dreams')", ">=", "1" ] }
      ]
    },
    "effect": [ { "run_eocs": "EOC_PLAYABLE_CHANGELING_BROWNIE_NEW_POWERS_REAL" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_POOKA_NEW_POWERS",
    "eoc_type": "EVENT",
    "required_event": "character_wakes_up",
    "condition": {
      "and": [
        { "u_has_trait": "UNKNOWING_CHANGELING_COMMONER" },
        { "u_has_trait": "FAIR_FOLK_COMMONER_POOKA" },
        { "math": [ "u_vitamin('changeling_dreams')", ">=", "1" ] }
      ]
    },
    "effect": [ { "run_eocs": "EOC_PLAYABLE_CHANGELING_POOKA_NEW_POWERS_REAL" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_SELKIE_NEW_POWERS",
    "eoc_type": "EVENT",
    "required_event": "character_wakes_up",
    "condition": {
      "and": [
        { "u_has_trait": "UNKNOWING_CHANGELING_COMMONER" },
        { "u_has_trait": "FAIR_FOLK_COMMONER_SELKIE" },
        { "math": [ "u_vitamin('changeling_dreams')", ">=", "1" ] }
      ]
    },
    "effect": [ { "run_eocs": "EOC_PLAYABLE_CHANGELING_SELKIE_NEW_POWERS_REAL" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_TROW_NEW_POWERS",
    "eoc_type": "EVENT",
    "required_event": "character_wakes_up",
    "condition": {
      "and": [
        { "u_has_trait": "UNKNOWING_CHANGELING_COMMONER" },
        { "u_has_trait": "FAIR_FOLK_COMMONER_TROW" },
        { "math": [ "u_vitamin('changeling_dreams')", ">=", "1" ] }
      ]
    },
    "effect": [ { "run_eocs": "EOC_PLAYABLE_CHANGELING_TROW_NEW_POWERS_REAL" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_NOBLE_NEW_POWERS_REAL",
    "//": "all of the below is necessary because u_roll_remainder does not respect prerequisites, and it also allows the mixing of spells and traits",
    "//2": "It is intended that 0 does nothing but dreams.",
    "effect": [
      {
        "switch": { "math": [ "rand(4)" ] },
        "cases": [
          {
            "case": 0,
            "effect": {
              "if": { "math": [ "u_fae_dream_count", "==", "0" ] },
              "then": [ { "u_message": "XE_CHANGELING_NOBLE", "type": "neutral", "snippet": true } ],
              "else": [ { "math": [ "u_fae_dream_count", "--" ] } ]
            }
          },
          {
            "case": 3,
            "effect": {
              "if": { "test_eoc": "EOC_TEST_CHANGELING_COMMON_POOL_TRAIT_LIST" },
              "then": { "run_eocs": "EOC_PLAYABLE_CHANGELING_NOBLE_NEW_POWERS_REAL" },
              "else": [
                { "run_eocs": "EOC_PLAYABLE_CHANGELING_COMMON_POOL" },
                { "u_message": "XE_CHANGELING_NOBLE", "type": "neutral", "snippet": true }
              ]
            }
          },
          {
            "case": 4,
            "effect": {
              "if": { "u_has_trait": "BEAUTIFUL3" },
              "then": { "run_eocs": "EOC_PLAYABLE_CHANGELING_NOBLE_NEW_POWERS_REAL" },
              "else": [
                { "run_eocs": "EOC_PLAYABLE_CHANGELING_GAIN_BEAUTY_TRAITS" },
                { "u_message": "XE_CHANGELING_NOBLE", "type": "neutral", "snippet": true }
              ]
            }
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_BROWNIE_NEW_POWERS_REAL",
    "effect": [
      {
        "switch": { "math": [ "rand(3)" ] },
        "cases": [
          {
            "case": 0,
            "effect": {
              "if": { "math": [ "u_fae_dream_count", "==", "0" ] },
              "then": [
                { "u_message": "XE_CHANGELING_COMMONER_BROWNIE", "type": "neutral", "snippet": true },
                { "math": [ "u_fae_dream_count", "+=", "rand(8) + 2" ] }
              ]
            }
          },
          {
            "case": 3,
            "effect": {
              "if": { "test_eoc": "EOC_TEST_CHANGELING_COMMON_POOL_TRAIT_LIST" },
              "then": { "run_eocs": "EOC_PLAYABLE_CHANGELING_BROWNIE_NEW_POWERS_REAL" },
              "else": [
                { "run_eocs": "EOC_PLAYABLE_CHANGELING_COMMON_POOL" },
                { "u_message": "XE_CHANGELING_COMMONER_BROWNIE", "type": "neutral", "snippet": true }
              ]
            }
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_POOKA_NEW_POWERS_REAL",
    "effect": [
      {
        "switch": { "math": [ "rand(3)" ] },
        "cases": [
          {
            "case": 0,
            "effect": {
              "if": { "math": [ "u_fae_dream_count", "==", "0" ] },
              "then": [
                { "u_message": "XE_CHANGELING_COMMONER_POOKA", "type": "neutral", "snippet": true },
                { "math": [ "u_fae_dream_count", "+=", "rand(8) + 2" ] }
              ]
            }
          },
          {
            "case": 3,
            "effect": {
              "if": { "test_eoc": "EOC_TEST_CHANGELING_COMMON_POOL_TRAIT_LIST" },
              "then": { "run_eocs": "EOC_PLAYABLE_CHANGELING_POOKA_NEW_POWERS_REAL" },
              "else": [
                { "run_eocs": "EOC_PLAYABLE_CHANGELING_COMMON_POOL" },
                { "u_message": "XE_CHANGELING_COMMONER_POOKA", "type": "neutral", "snippet": true }
              ]
            }
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_SELKIE_NEW_POWERS_REAL",
    "effect": [
      {
        "switch": { "math": [ "rand(4)" ] },
        "cases": [
          {
            "case": 0,
            "effect": {
              "if": { "math": [ "u_fae_dream_count", "==", "0" ] },
              "then": [
                { "u_message": "XE_CHANGELING_COMMONER_SELKIE", "type": "neutral", "snippet": true },
                { "math": [ "u_fae_dream_count", "+=", "rand(8) + 2" ] }
              ]
            }
          },
          {
            "case": 3,
            "effect": {
              "if": { "test_eoc": "EOC_TEST_CHANGELING_COMMON_POOL_TRAIT_LIST" },
              "then": { "run_eocs": "EOC_PLAYABLE_CHANGELING_SELKIE_NEW_POWERS_REAL" },
              "else": [
                { "run_eocs": "EOC_PLAYABLE_CHANGELING_COMMON_POOL" },
                { "u_message": "XE_CHANGELING_COMMONER_SELKIE", "type": "neutral", "snippet": true }
              ]
            }
          },
          {
            "case": 4,
            "effect": {
              "if": { "u_has_trait": "BEAUTIFUL3" },
              "then": { "run_eocs": "EOC_PLAYABLE_CHANGELING_SELKIE_NEW_POWERS_REAL" },
              "else": [
                { "run_eocs": "EOC_PLAYABLE_CHANGELING_GAIN_BEAUTY_TRAITS" },
                { "u_message": "XE_CHANGELING_COMMONER_SELKIE", "type": "neutral", "snippet": true }
              ]
            }
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_TROW_NEW_POWERS_REAL",
    "effect": [
      {
        "switch": { "math": [ "rand(3)" ] },
        "cases": [
          {
            "case": 0,
            "effect": {
              "if": { "math": [ "u_fae_dream_count", "==", "0" ] },
              "then": [
                { "u_message": "XE_CHANGELING_COMMONER_TROW", "type": "neutral", "snippet": true },
                { "math": [ "u_fae_dream_count", "+=", "rand(8) + 2" ] }
              ]
            }
          },
          {
            "case": 3,
            "effect": {
              "if": { "test_eoc": "EOC_TEST_CHANGELING_COMMON_POOL_TRAIT_LIST" },
              "then": { "run_eocs": "EOC_PLAYABLE_CHANGELING_TROW_NEW_POWERS_REAL" },
              "else": [
                { "run_eocs": "EOC_PLAYABLE_CHANGELING_COMMON_POOL" },
                { "u_message": "XE_CHANGELING_COMMONER_TROW", "type": "neutral", "snippet": true }
              ]
            }
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_COMMON_POOL",
    "effect": [
      {
        "switch": { "math": [ "rand(2)" ] },
        "cases": [
          {
            "case": 0,
            "effect": {
              "if": { "u_has_trait": "PARACLESIAN_FAE_SIGHT_2" },
              "then": { "run_eocs": "EOC_PLAYABLE_CHANGELING_COMMON_POOL" },
              "else": [ { "run_eocs": "EOC_PLAYABLE_CHANGELING_GAIN_FAE_SIGHT_TRAITS" } ]
            }
          },
          {
            "case": 1,
            "effect": {
              "if": { "and": [ { "u_has_trait": "PARACLESIAN_STR_DEX_2" }, { "u_has_trait": "PARACLESIAN_INT_PER_2" } ] },
              "then": { "run_eocs": "EOC_PLAYABLE_CHANGELING_COMMON_POOL" },
              "else": [ { "run_eocs": "EOC_PLAYABLE_CHANGELING_GAIN_ATTRIBUTE_TRAITS" } ]
            }
          },
          {
            "case": 2,
            "effect": {
              "if": { "u_has_trait": "PARACLESIAN_MAKE_GOSSAMER" },
              "then": { "run_eocs": "EOC_PLAYABLE_CHANGELING_COMMON_POOL" },
              "else": [ { "run_eocs": "EOC_PLAYABLE_CHANGELING_GAIN_GOSSAMER_MAKING_TRAITS" } ]
            }
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_GAIN_BEAUTY_TRAITS",
    "effect": [
      {
        "if": { "u_has_trait": "BEAUTIFUL2" },
        "then": [ { "u_add_trait": "BEAUTIFUL3" }, { "u_lose_trait": "BEAUTIFUL2" } ],
        "else": {
          "if": { "u_has_trait": "BEAUTIFUL" },
          "then": [ { "u_add_trait": "BEAUTIFUL2" }, { "u_lose_trait": "BEAUTIFUL" } ],
          "else": {
            "if": { "u_has_trait": "PRETTY" },
            "then": [ { "u_add_trait": "BEAUTIFUL" }, { "u_lose_trait": "PRETTY" } ],
            "else": {
              "if": { "not": { "u_has_any_trait": [ "PRETTY", "BEAUTIFUL", "BEAUTIFUL2", "BEAUTIFUL3" ] } },
              "then": [ { "u_add_trait": "PRETTY" } ]
            }
          }
        }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_GAIN_ATTRIBUTE_TRAITS",
    "effect": [
      {
        "switch": { "math": [ "rand(1)" ] },
        "cases": [
          {
            "case": 0,
            "effect": {
              "if": { "u_has_trait": "PARACLESIAN_STR_DEX_2" },
              "then": { "run_eocs": "EOC_PLAYABLE_CHANGELING_GAIN_ATTRIBUTE_TRAITS" },
              "else": {
                "if": { "u_has_trait": "PARACLESIAN_STR_DEX_1" },
                "then": [ { "u_add_trait": "PARACLESIAN_STR_DEX_2" }, { "u_lose_trait": "PARACLESIAN_STR_DEX_1" } ],
                "else": {
                  "if": { "not": { "u_has_any_trait": [ "PARACLESIAN_STR_DEX_1", "PARACLESIAN_STR_DEX_2" ] } },
                  "then": [ { "u_add_trait": "PARACLESIAN_STR_DEX_1" } ]
                }
              }
            }
          },
          {
            "case": 1,
            "effect": {
              "if": { "u_has_trait": "PARACLESIAN_INT_PER_2" },
              "then": { "run_eocs": "EOC_PLAYABLE_CHANGELING_GAIN_ATTRIBUTE_TRAITS" },
              "else": {
                "if": { "u_has_trait": "PARACLESIAN_INT_PER_1" },
                "then": [ { "u_add_trait": "PARACLESIAN_INT_PER_2" }, { "u_lose_trait": "PARACLESIAN_INT_PER_1" } ],
                "else": {
                  "if": { "not": { "u_has_any_trait": [ "PARACLESIAN_INT_PER_1", "PARACLESIAN_INT_PER_2" ] } },
                  "then": [ { "u_add_trait": "PARACLESIAN_INT_PER_1" } ]
                }
              }
            }
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_GAIN_FAE_SIGHT_TRAITS",
    "effect": [
      {
        "if": { "u_has_trait": "PARACLESIAN_FAE_SIGHT_1" },
        "then": [ { "u_add_trait": "PARACLESIAN_FAE_SIGHT_2" }, { "u_lose_trait": "PARACLESIAN_FAE_SIGHT_1" } ],
        "else": { "u_add_trait": "PARACLESIAN_FAE_SIGHT_1" }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PLAYABLE_CHANGELING_GAIN_GOSSAMER_MAKING_TRAITS",
    "effect": [
      {
        "if": { "u_has_trait": "PARACLESIAN_LEARN_GOSSAMER_RECIPES" },
        "then": [ { "u_add_trait": "PARACLESIAN_MAKE_GOSSAMER" } ],
        "else": { "u_add_trait": "PARACLESIAN_LEARN_GOSSAMER_RECIPES" }
      }
    ]
  }
]
