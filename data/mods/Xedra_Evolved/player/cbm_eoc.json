[
  {
    "type": "effect_on_condition",
    "id": "EOC_SUMMON_BAT_SWARM",
    "effect": [
      {
        "u_cast_spell": {
          "id": "spell_summon_bat_swarm",
          "min_level": 1,
          "max_level": 6,
          "message": "There is a loud clicking sound as you commune with any nearby bats."
        },
        "targeted": true
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SUMMON_XL_BAT",
    "effect": [
      {
        "u_cast_spell": {
          "id": "spell_summon_bat_giant",
          "min_level": 1,
          "max_level": 6,
          "message": "A click fires out of the back of your throat like a gunshot.  What could this possibly be speaking to?"
        },
        "targeted": true
      }
    ]
  },
    {
    "id": "EOC_xe_bio_start_shell",
    "type": "effect_on_condition",
    "effect": [
      {
        "if": { "not": { "u_has_worn_with_flag": "ENERGY_SHIELD" } },
        "then": [
          { "u_cast_spell": { "id": "spawn_shell", "hit_self": true } },
          { "u_message": { "context_val": "success_message" } },
          { "math": [ "_shield_uid = rand(1200)" ] },
          { "math": [ "u_shield_gen_uid = _shield_uid" ] },
          { "math": [ "u_shield_power_ratio = u_val('power_percentage')" ] },
          {
            "u_run_inv_eocs": "all",
            "search_data": [ { "id": [ "afs_energy_shield" ] } ],
            "true_eocs": [
              {
                "id": "_BIO_SHIELD_SETUP",
                "effect": [
                  { "math": [ "n_shield_uid = _shield_uid" ] },
                  { "math": [ "n_shield_is_bionic = 1" ] },
                  { "math": [ "n_shield_turn = 0" ] },
                  { "math": [ "n_SHIELD_REGEN = 0" ] },
                  { "math": [ "n_SHIELD_REGEN_RATE = 0" ] },
                  { "math": [ "n_ENERGY_SHIELD_HP = _shield_max_hp*0.1" ] },
                  { "math": [ "n_ENERGY_SHIELD_MAX_HP = _shield_max_hp" ] },
                  { "math": [ "n_SHIELD_REGEN = _shield_regen" ] },
                  { "math": [ "n_SHIELD_REGEN_RATE = shield_regen_rate" ] },
                  { "math": [ "u_shield_ratio = n_ENERGY_SHIELD_HP/n_ENERGY_SHIELD_MAX_HP" ] }
                ]
              }
            ]
          }
        ],
        "else": { "u_message": { "context_val": "failure_message" } }
      }
    ]
  },
  {
    "id": "EOC_bio_stop_shell",
    "type": "effect_on_condition",
    "effect": [ { "u_remove_item_with": "afs_energy_shield" }, { "math": [ "u_shield_ratio = -1" ] } ]
  },
  {
    "id": "EOC_bio_update_ui",
    "type": "effect_on_condition",
    "effect": { "math": [ "u_shield_power_ratio = u_val('power_percentage')" ] }
  }
]
