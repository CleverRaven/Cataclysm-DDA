[
  {
    "type": "effect_on_condition",
    "id": "EOC_LILIN_RUACH_DRAIN",
    "recurrence": [ "6 minutes", "6 minutes" ],
    "condition": { "and": [ { "u_has_trait": "LILIN_TRAITS" }, { "math": [ "u_vitamin('lilin_ruach_vitamin')", ">=", "1" ] } ] },
    "deactivate_condition": { "not": { "u_has_trait": "LILIN_TRAITS" } },
    "effect": [
      { "u_lose_effect": "effect_lilin_no_ruach" },
      { "math": [ "u_vitamin('lilin_ruach_vitamin')", "--" ] },
      {
        "if": { "math": [ "u_vitamin('lilin_ruach_vitamin')", "==", "0" ] },
        "then": { "u_add_effect": "effect_lilin_no_ruach" }
      },
      {
        "if": {
          "math": [
            "u_vitamin('lilin_ruach_vitamin')",
            ">=",
            "1680 + (u_has_trait('LILIN_HOLD_MORE_RUACH') * 1680) + (u_has_trait('LILIN_HOLD_MORE_RUACH_2') * 3360) + (u_has_trait('LILIN_HOLD_MORE_RUACH_3') * 5040)"
          ]
        },
        "then": {
          "if": { "u_has_trait": "LILIN_HOLD_MORE_RUACH_3" },
          "then": { "math": [ "u_vitamin('lilin_ruach_vitamin')", "=", "6720" ] },
          "else": {
            "if": { "u_has_trait": "LILIN_HOLD_MORE_RUACH_2" },
            "then": { "math": [ "u_vitamin('lilin_ruach_vitamin')", "=", "5040" ] },
            "else": {
              "if": { "u_has_trait": "LILIN_HOLD_MORE_RUACH" },
              "then": { "math": [ "u_vitamin('lilin_ruach_vitamin')", "=", "3360" ] },
              "else": { "math": [ "u_vitamin('lilin_ruach_vitamin')", "=", "1680" ] }
            }
          }
        }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_LILIN_SPEND_RUACH_FOR_POWERS",
    "condition": { "math": [ "u_vitamin('lilin_ruach_vitamin')", ">=", "240" ] },
    "effect": [
      { "math": [ "u_vitamin('lilin_ruach_vitamin')", "-=", "240" ] },
      { "math": [ "u_lilin_amount_of_ruach_spent_for_powers_increaser", "+=", "1" ] },
      {
        "math": [ "u_lilin_amount_of_ruach_spent_for_powers", "+=", "u_lilin_amount_of_ruach_spent_for_powers_increaser" ]
      }
    ],
    "false_effect": [ { "u_message": "You don't have enough ruach to dedicate any to increasing your powers!", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_LILIN_GAIN_POWERS_AT_NIGHT_SETUP",
    "recurrence": { "math": [ "time_until('sunset')" ] },
    "//": "Lilin have a small chance to gain powers if they're outside under the moon, every night. Each time they gain powers it increases the counter until the next time they can gain more powers.",
    "condition": {
      "and": [ "u_is_outside", { "u_has_trait": "LILIN_TRAITS" }, { "not": { "u_has_effect": "effect_gained_lilin_power" } } ]
    },
    "deactivate_condition": { "not": { "u_has_trait": "LILIN_TRAITS" } },
    "effect": [ { "queue_eocs": "EOC_LILIN_GAIN_POWERS_AT_NIGHT_ACTIVE", "time_in_future": [ "1 hours", "2 hours" ] } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_LILIN_GAIN_POWERS_AT_NIGHT_ACTIVE",
    "condition": {
      "and": [
        "u_is_outside",
        { "not": "is_day" },
        { "x_in_y_chance": { "x": { "math": [ "u_lilin_amount_of_ruach_spent_for_powers" ] }, "y": 250 } }
      ]
    },
    "effect": [
      {
        "if": { "math": [ "u_vitamin('lilin_ruach_vitamin')", ">=", "1" ] },
        "then": [
          { "math": [ "u_vitamin('mutagen_lilin')", "+=", "2500" ] },
          { "math": [ "u_vitamin('mutagen')", "+=", "1000" ] },
          { "u_mutate": 0 },
          { "math": [ "u_vitamin('mutagen_lilin')", "-=", "2500" ] },
          { "math": [ "u_vitamin('mutagen')", "-=", "1000" ] },
          { "math": [ "u_lilin_new_power_delay_timer", "+=", "86400" ] },
          { "u_add_effect": "effect_gained_lilin_power", "duration": { "math": [ "u_lilin_new_power_delay_timer" ] } },
          { "math": [ "u_lilin_amount_of_ruach_spent_for_powers", "=", "0" ] },
          { "math": [ "u_lilin_amount_of_ruach_spent_for_powers_increaser", "=", "1" ] }
        ]
      }
    ],
    "false_effect": [ { "queue_eocs": "EOC_LILIN_GAIN_POWERS_AT_NIGHT_ACTIVE", "time_in_future": [ "1 hours", "2 hours" ] } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_LILIN_GAINS_STRENGTH_TO_STRENGTH_CHOOSE_INITIAL",
    "required_event": "gains_mutation",
    "eoc_type": "EVENT",
    "condition": { "compare_string": [ "LILIN_ATTRIBUTE_BONUSES", { "context_val": "trait" } ] },
    "effect": [
      {
        "run_eoc_selector": [
          "EOC_LILIN_GAINS_STRENGTH_TO_STRENGTH_CHOOSE_STRENGTH",
          "EOC_LILIN_GAINS_STRENGTH_TO_STRENGTH_CHOOSE_DEXTERITY",
          "EOC_LILIN_GAINS_STRENGTH_TO_STRENGTH_CHOOSE_PERCEPTION"
        ],
        "names": [ "Empower your Strength", "Empower your Dexterity", "Empower your Perception" ],
        "title": "Pick a choice",
        "descriptions": [
          "Gain strength bonuses when using From Strength to Strength.",
          "Gain dexterity and dodge bonuses when using From Strength to Strength.",
          "Gain perception bonuses when using From Strength to Strength."
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_LILIN_GAINS_STRENGTH_TO_STRENGTH_CHOOSE_STRENGTH",
    "effect": [ { "u_add_trait": "LILIN_ATTRIBUTE_BONUSES_STRENGTH" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_LILIN_GAINS_STRENGTH_TO_STRENGTH_CHOOSE_DEXTERITY",
    "effect": [ { "u_add_trait": "LILIN_ATTRIBUTE_BONUSES_DEXTERITY" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_LILIN_GAINS_STRENGTH_TO_STRENGTH_CHOOSE_PERCEPTION",
    "effect": [ { "u_add_trait": "LILIN_ATTRIBUTE_BONUSES_PERCEPTION" } ]
  }
]
