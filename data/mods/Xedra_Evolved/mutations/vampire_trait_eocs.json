[
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_BLOOD_DRINKING_DIRECTLY",
    "eoc_type": "EVENT",
    "required_event": "character_eats_item",
    "condition": {
      "and": [
        {
          "or": [
            { "compare_string": [ "blood", { "context_val": "itype" } ] },
            { "compare_string": [ "demihuman_blood", { "context_val": "itype" } ] },
            { "compare_string": [ "mutant_human_blood", { "context_val": "itype" } ] }
          ]
        },
        { "or": [ { "u_has_trait": "VAMPIRE" }, { "u_has_effect": "vampire_virus" } ] }
      ]
    },
    "effect": [
      { "math": [ "u_vitamin('human_blood_vitamin')", "+=", "400 + rand(100)" ] },
      { "u_add_effect": "effect_drank_blood_recently", "intensity": 1, "duration": { "math": [ "600 + rand(600)" ] } }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_BLOOD_DRINKING_FAE_BLOOD",
    "eoc_type": "EVENT",
    "required_event": "character_eats_item",
    "//": "Fae blood causes hallucinations when drank by vampires, so it need its own EoC.",
    "condition": {
      "and": [
        { "compare_string": [ "fae_blood", { "context_val": "itype" } ] },
        { "or": [ { "u_has_trait": "VAMPIRE" }, { "u_has_effect": "vampire_virus" } ] }
      ]
    },
    "effect": [
      { "math": [ "u_vitamin('human_blood_vitamin')", "+=", "400 + rand(100)" ] },
      { "math": [ "u_vitamin('drank_fae_blood')", "+=", "5" ] },
      { "u_add_effect": "effect_drank_blood_recently", "intensity": 1, "duration": { "math": [ "600 + rand(600)" ] } }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_BLOOD_DRINKING_INEDIBLE",
    "eoc_type": "EVENT",
    "required_event": "character_eats_item",
    "condition": {
      "and": [
        {
          "or": [
            { "compare_string": [ "animal_blood", { "context_val": "itype" } ] },
            { "compare_string": [ "blood_tainted", { "context_val": "itype" } ] }
          ]
        },
        { "or": [ { "u_has_trait": "VAMPIRE" }, { "u_has_effect": "vampire_virus" } ] }
      ]
    },
    "effect": [ { "u_message": "You still feel as hungry as before.  This blood cannot sustain you.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CONSUME_VAMPIRE_BLOOD",
    "eoc_type": "EVENT",
    "required_event": "character_eats_item",
    "condition": {
      "and": [
        { "compare_string": [ "vampire_blood", { "context_val": "itype" } ] },
        { "or": [ { "u_has_trait": "VAMPIRE" }, { "u_has_effect": "vampire_virus" } ] }
      ]
    },
    "effect": [ { "u_message": "You need the blood of the living, not the blood of the dead.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CONSUME_VAMPIRE_BLOOD_NON_VAMPIRE",
    "eoc_type": "EVENT",
    "required_event": "character_eats_item",
    "condition": {
      "and": [
        { "compare_string": [ "vampire_blood", { "context_val": "itype" } ] },
        { "not": { "u_has_effect": "vampire_virus" } }
      ]
    },
    "effect": [
      { "u_message": "As you drink, some of the vampire blood enters your gums.", "type": "mixed" },
      { "u_add_effect": "vampire_virus", "intensity": 1, "duration": "PERMANENT" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_WEAKNESS_NEED_HUMAN_BLOOD_HALVING",
    "eoc_type": "EVENT",
    "required_event": "character_eats_item",
    "condition": {
      "and": [
        {
          "or": [
            { "compare_string": [ "fae_blood", { "context_val": "itype" } ] },
            { "compare_string": [ "demihuman_blood", { "context_val": "itype" } ] },
            { "compare_string": [ "mutant_human_blood", { "context_val": "itype" } ] }
          ]
        },
        { "u_has_trait": "VAMPIRE_WEAKNESS_NEED_HUMAN_BLOOD" }
      ]
    },
    "effect": [ { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "200 + rand(50)" ] } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_BLOOD_FUN",
    "eoc_type": "EVENT",
    "required_event": "character_eats_item",
    "condition": {
      "and": [
        {
          "or": [
            { "compare_string": [ "blood", { "context_val": "itype" } ] },
            { "compare_string": [ "demihuman_blood", { "context_val": "itype" } ] },
            { "compare_string": [ "mutant_human_blood", { "context_val": "itype" } ] },
            { "compare_string": [ "fae_blood", { "context_val": "itype" } ] }
          ]
        },
        { "u_has_trait": "BLOOD_FUN" }
      ]
    },
    "effect": [ { "u_add_morale": "morale_drank_blood", "bonus": 30, "max_bonus": 60, "duration": "20 m", "decay_start": "10 m" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_BLOOD_NUMBER_UI",
    "//": "Until the day UI widgets can directly access vitamin levels, this will have to be.",
    "recurrence": 1,
    "condition": { "u_has_effect": "vampire_virus" },
    "deactivate_condition": { "not": { "u_has_effect": "vampire_virus" } },
    "effect": [ { "math": [ "u_blood_amount_for_graph = u_vitamin('human_blood_vitamin')" ] } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_ADD_WEAKNESSES",
    "//": "This EOC checks how many weaknesses the player should gain when reshuffling.  Gaining the traits run the weakness-giving EOC directly.",
    "//2": "Tier 3 grants 1 weakness, Tier 4 grants 1 more, Tier 5 grants two more.",
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_ADD_WEAKNESSES_TIER_3",
            "condition": { "u_has_trait": "VAMPIRE3" },
            "effect": [ { "run_eocs": [ "EOC_VAMPIRE_ADD_ONE_WEAKNESS" ] } ]
          },
          {
            "id": "EOC_VAMPIRE_ADD_WEAKNESSES_TIER_4",
            "condition": { "u_has_trait": "VAMPIRE4" },
            "effect": [ { "run_eocs": [ "EOC_VAMPIRE_ADD_ONE_WEAKNESS" ] } ]
          },
          {
            "id": "EOC_VAMPIRE_ADD_WEAKNESSES_TIER_5",
            "condition": { "u_has_trait": "BLOOD_DRINKER" },
            "effect": [ { "run_eocs": [ "EOC_VAMPIRE_ADD_ONE_WEAKNESS" ] }, { "run_eocs": [ "EOC_VAMPIRE_ADD_ONE_WEAKNESS" ] } ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_ADD_ONE_WEAKNESS",
    "//": "This EOC adds a single vampiric weakness when ran.",
    "//2": "This EOC is intended to be ran multiple times, to properly assign the intended amount of weaknesses to the player.",
    "//3": "When adding new weaknesses, make sure to also add them to the roll_remainder below so the player can obtain them.",
    "effect": [
      {
        "u_roll_remainder": [
          "VAMPIRE_WEAKNESS_MORE_BLOOD",
          "VAMPIRE_WEAKNESS_GROTESQUE",
          "VAMPIRE_WEAKNESS_EARTH_SLEEP",
          "VAMPIRE_WEAKNESS_HOLY_BURN",
          "VAMPIRE_WEAKNESS_VAST_WATER_BURN",
          "VAMPIRE_WEAKNESS_ANIMAL_HATE",
          "VAMPIRE_WEAKNESS_FIRE_VULNERABLE",
          "VAMPIRE_WEAKNESS_COLD_BLOODED",
          "VAMPIRE_WEAKNESS_NEED_LIVING_BLOOD",
          "VAMPIRE_WEAKNESS_NEED_HUMAN_BLOOD",
          "VAMPIRE_WEAKNESS_BLOOD_CRAVING"
        ],
        "type": "mutation",
        "true_eocs": [ "EOC_VAMPIRE_ADD_ONE_WEAKNESS_SUCCESS" ],
        "false_eocs": [ "EOC_VAMPIRE_ADD_ONE_WEAKNESS_FAIL" ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_ADD_ONE_WEAKNESS_SUCCESS",
    "//": "Workaround to the below not working due to the roll_remainder used.  When this will be fixed, remove this EOC as the others give a message informing the player of the new weakness.",
    "effect": [ { "u_message": "You gain a new vampiric weakness.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_ADD_ONE_WEAKNESS_FAIL",
    "effect": [ { "u_message": "The EOC failed to give you a weakness.  Please report this on Github.", "popup": true } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VW_MORE_BLOOD_MESSAGE",
    "eoc_type": "EVENT",
    "required_event": "gains_mutation",
    "condition": { "compare_string": [ "VAMPIRE_WEAKNESS_MORE_BLOOD", { "context_val": "trait" } ] },
    "effect": [ { "u_message": "Your thirst for blood intensifies.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VW_EARTH_SLEEP_MESSAGE",
    "eoc_type": "EVENT",
    "required_event": "gains_mutation",
    "condition": { "compare_string": [ "VAMPIRE_WEAKNESS_EARTH_SLEEP", { "context_val": "trait" } ] },
    "effect": [ { "u_message": "You long for a good day of sleep surrounded by the earth.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VW_HOLY_BURN_MESSAGE",
    "eoc_type": "EVENT",
    "required_event": "gains_mutation",
    "condition": { "compare_string": [ "VAMPIRE_WEAKNESS_HOLY_BURN", { "context_val": "trait" } ] },
    "effect": [ { "u_message": "You feel unholy, as if your presence wouldn't be tolerated by holy ground.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VW_VAST_WATER_BURN_MESSAGE",
    "eoc_type": "EVENT",
    "required_event": "gains_mutation",
    "condition": { "compare_string": [ "VAMPIRE_WEAKNESS_VAST_WATER_BURN", { "context_val": "trait" } ] },
    "effect": [ { "u_message": "You think about crossing a river, but visions of your flesh melting disturb you.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VW_ANIMAL_HATE_MESSAGE",
    "eoc_type": "EVENT",
    "required_event": "gains_mutation",
    "condition": { "compare_string": [ "VAMPIRE_WEAKNESS_ANIMAL_HATE", { "context_val": "trait" } ] },
    "effect": [ { "u_message": "Nearby animals start looking at you with eyes filled with hate.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VW_FIRE_VULNERABLE_MESSAGE",
    "eoc_type": "EVENT",
    "required_event": "gains_mutation",
    "condition": { "compare_string": [ "VAMPIRE_WEAKNESS_FIRE_VULNERABLE", { "context_val": "trait" } ] },
    "effect": [ { "u_message": "Your body feels much more vulnerable to fire.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VW_COLD_BLOODED_MESSAGE",
    "eoc_type": "EVENT",
    "required_event": "gains_mutation",
    "condition": { "compare_string": [ "VAMPIRE_WEAKNESS_COLD_BLOODED", { "context_val": "trait" } ] },
    "effect": [ { "u_message": "Your body grows cold.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VW_NEED_LIVING_BLOOD_MESSAGE",
    "eoc_type": "EVENT",
    "required_event": "gains_mutation",
    "condition": { "compare_string": [ "VAMPIRE_WEAKNESS_NEED_LIVING_BLOOD", { "context_val": "trait" } ] },
    "effect": [ { "u_message": "You daydream of drinking blood directly from the veins of the living for a moment.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VW_NEED_HUMAN_BLOOD_MESSAGE",
    "eoc_type": "EVENT",
    "required_event": "gains_mutation",
    "condition": { "compare_string": [ "VAMPIRE_WEAKNESS_NEED_HUMAN_BLOOD", { "context_val": "trait" } ] },
    "effect": [ { "u_message": "All bloods, except the blood of regular humans, suddenly feel far less appealing.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VW_BLOOD_CRAVING_MESSAGE",
    "eoc_type": "EVENT",
    "required_event": "gains_mutation",
    "condition": { "compare_string": [ "VAMPIRE_WEAKNESS_BLOOD_CRAVING", { "context_val": "trait" } ] },
    "effect": [ { "u_message": "You feel a painful craving for blood for a second, then it passes.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SET_VAMPIRE_TRAIT_NUMBERS_FOR_NPC_USE",
    "//": "This is necessary for powers whose effect on NPCs is variable, since the jmath equations return the avatar's traits",
    "eoc_type": "EVENT",
    "required_event": "opens_spellbook",
    "condition": { "or": [ { "u_has_trait": "VAMPIRE" }, { "u_has_trait": "VAMPIRE2" }, { "u_has_trait": "VAMPIRE3" } ] },
    "effect": [
      { "math": [ "u_vampire_total_tier_one_traits = vampire_total_tier_one_traits()" ] },
      { "math": [ "u_vampire_total_tier_two_traits = vampire_total_tier_two_traits()" ] },
      { "math": [ "u_vampire_total_tier_three_traits = vampire_total_tier_three_traits()" ] },
      { "math": [ "u_vampire_total_tier_four_traits = vampire_total_tier_four_traits_plus_potence()" ] },
      { "math": [ "u_vampire_total_tier_five_traits = vampire_total_tier_five_traits()" ] }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_EYEGLEAM_activated",
    "condition": { "not": { "u_has_effect": "eyegleam" } },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_EYEGLEAM_activated_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "u_assign_activity": "ACT_GENERIC_EOC", "duration": 0.25 },
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "100" ] },
              { "u_add_effect": "eyegleam", "duration": "PERMANENT" },
              { "u_message": "Your eyes gleam red momentarily as they drink in all available light.", "type": "good" },
              {
                "run_eocs": [ "EOC_EYEGLEAM_maintenance" ],
                "time_in_future": {
                  "math": [
                    "rng(0.75,1.25) * (1000 + (vampire_total_tier_one_traits() * 100) + (vampire_total_tier_two_traits() * 225) + (vampire_total_tier_three_traits() * 350) + (vampire_total_tier_four_traits_plus_potence() * 500) + (vampire_total_tier_five_traits() * 750))"
                  ]
                }
              },
              {
                "run_eocs": [
                  {
                    "id": "EOC_EYEGLEAM_activated_3",
                    "condition": {
                      "or": [
                        {
                          "and": [
                            { "u_has_effect": "vampire_virus_ascendant", "intensity": 1 },
                            { "math": [ "u_effect_intensity('vampire_virus_ascendant') == 1" ] }
                          ]
                        },
                        {
                          "and": [
                            { "u_has_effect": "vampire_virus_post_mortal", "intensity": 1 },
                            { "math": [ "u_effect_intensity('vampire_virus_post_mortal') == 1" ] }
                          ]
                        }
                      ]
                    },
                    "effect": [ { "u_add_effect": "eyegleam_craft_in_darkness", "duration": "PERMANENT" } ]
                  }
                ]
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to activate your gleaming eyes.", "type": "bad" },
              { "run_eocs": "EOC_EYEGLEAM_deactivate_future", "time_in_future": 0 }
            ]
          }
        ]
      }
    ],
    "false_effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_EYEGLEAM_deactivated",
            "condition": { "u_has_effect": "eyegleam" },
            "effect": [
              { "u_message": "Your eyes lose their reddish glint as the darkness rolls back in.", "type": "neutral" },
              { "u_lose_effect": [ "eyegleam", "eyegleam_craft_in_darkness" ] }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_EYEGLEAM_deactivate_future",
    "//": "This is necessary because calling u_deactivate_trait from within the trait EoC does not work",
    "effect": { "u_deactivate_trait": "EYEGLEAM" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_EYEGLEAM_maintenance",
    "condition": { "u_has_effect": "eyegleam" },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_EYEGLEAM_maintenance_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "50" ] },
              {
                "u_message": "You feel a momentary warmth as you channel stolen blood into your eyes.",
                "type": "mixed"
              },
              {
                "run_eocs": [ "EOC_EYEGLEAM_maintenance" ],
                "time_in_future": {
                  "math": [
                    "rng(0.75,1.25) * (1000 + (vampire_total_tier_one_traits() * 100) + (vampire_total_tier_two_traits() * 225) + (vampire_total_tier_three_traits() * 350) + (vampire_total_tier_four_traits_plus_potence() * 500) + (vampire_total_tier_five_traits() * 750))"
                  ]
                }
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to maintain your gleaming eyes.", "type": "bad" },
              { "u_lose_effect": [ "eyegleam", "eyegleam_craft_in_darkness" ] },
              { "u_deactivate_trait": "EYEGLEAM" }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRIC_STRENGTH_activated",
    "condition": { "not": { "u_has_effect": "effect_vampiric_strength" } },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRIC_STRENGTH_activated_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "u_assign_activity": "ACT_GENERIC_EOC", "duration": 0.25 },
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "150" ] },
              { "u_add_effect": "effect_vampiric_strength", "duration": "PERMANENT" },
              { "u_message": "You feel a surge of power as blood floods your muscles.", "type": "good" },
              {
                "run_eocs": [ "EOC_VAMPIRIC_STRENGTH_maintenance" ],
                "time_in_future": {
                  "math": [
                    "rng(0.75,1.25) * (750 + (vampire_total_tier_one_traits() * 100) + (vampire_total_tier_two_traits() * 200) + (vampire_total_tier_three_traits() * 300) + (vampire_total_tier_four_traits_plus_potence() * 400) + (vampire_total_tier_five_traits() * 500))"
                  ]
                }
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to activate vigor mortis.", "type": "bad" },
              { "run_eocs": "EOC_VAMPIRIC_STRENGTH_deactivate_future", "time_in_future": 0 }
            ]
          }
        ]
      }
    ],
    "false_effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRIC_STRENGTH_deactivated",
            "condition": { "u_has_effect": "effect_vampiric_strength" },
            "effect": [
              { "u_message": "Your muscles weaken as the stolen blood leaves them.", "type": "neutral" },
              { "u_lose_effect": "effect_vampiric_strength" }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRIC_STRENGTH_deactivate_future",
    "//": "This is necessary because calling u_deactivate_trait from within the trait EoC does not work",
    "effect": { "u_deactivate_trait": "VAMPIRIC_STRENGTH" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRIC_STRENGTH_maintenance",
    "condition": { "u_has_effect": "effect_vampiric_strength" },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRIC_STRENGTH_maintenance_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "75" ] },
              {
                "u_message": "You feel a momentary warmth as you channel stolen blood into your muscles.",
                "type": "mixed"
              },
              {
                "run_eocs": [ "EOC_VAMPIRIC_STRENGTH_maintenance" ],
                "time_in_future": {
                  "math": [
                    "rng(0.75,1.25) * (750 + (vampire_total_tier_one_traits() * 100) + (vampire_total_tier_two_traits() * 200) + (vampire_total_tier_three_traits() * 300) + (vampire_total_tier_four_traits_plus_potence() * 400) + (vampire_total_tier_five_traits() * 500))"
                  ]
                }
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to maintain your vigor mortis.", "type": "bad" },
              { "u_lose_effect": "effect_vampiric_strength" },
              { "u_deactivate_trait": "VAMPIRIC_STRENGTH" }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRIC_RESILIENCE_activated",
    "condition": { "not": { "u_has_effect": "effect_vampiric_resilience" } },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRIC_RESILIENCE_activated_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "u_assign_activity": "ACT_GENERIC_EOC", "duration": 0.25 },
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "150" ] },
              { "u_add_effect": "effect_vampiric_resilience", "duration": "PERMANENT" },
              { "u_message": "You feel a surge of power as blood fortifies your flesh.", "type": "good" },
              {
                "run_eocs": [ "EOC_VAMPIRIC_RESILIENCE_maintenance" ],
                "time_in_future": {
                  "math": [
                    "rng(0.75,1.25) * (750 + (vampire_total_tier_one_traits() * 100) + (vampire_total_tier_two_traits() * 200) + (vampire_total_tier_three_traits() * 300) + (vampire_total_tier_four_traits_plus_potence() * 400) + (vampire_total_tier_five_traits() * 500))"
                  ]
                }
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to activate sanguine resilience.", "type": "bad" },
              { "run_eocs": "EOC_VAMPIRIC_RESILIENCE_deactivate_future", "time_in_future": 0 }
            ]
          }
        ]
      }
    ],
    "false_effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRIC_RESILIENCE_deactivated",
            "condition": { "u_has_effect": "effect_vampiric_resilience" },
            "effect": [
              { "u_message": "Your muscles weaken as the stolen blood leaves them.", "type": "neutral" },
              { "u_lose_effect": "effect_vampiric_resilience" }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRIC_RESILIENCE_deactivate_future",
    "//": "This is necessary because calling u_deactivate_trait from within the trait EoC does not work",
    "effect": { "u_deactivate_trait": "VAMPIRIC_RESILIENCE" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRIC_RESILIENCE_maintenance",
    "condition": { "u_has_effect": "effect_vampiric_resilience" },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRIC_RESILIENCE_maintenance_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "75" ] },
              {
                "u_message": "You feel a momentary warmth as you channel stolen blood into your flesh.",
                "type": "mixed"
              },
              {
                "run_eocs": [ "EOC_VAMPIRIC_RESILIENCE_maintenance" ],
                "time_in_future": {
                  "math": [
                    "rng(0.75,1.25) * (750 + (vampire_total_tier_one_traits() * 100) + (vampire_total_tier_two_traits() * 200) + (vampire_total_tier_three_traits() * 300) + (vampire_total_tier_four_traits_plus_potence() * 400) + (vampire_total_tier_five_traits() * 500))"
                  ]
                }
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to maintain your sanguine resilience.", "type": "bad" },
              { "u_lose_effect": "effect_vampiric_resilience" },
              { "u_deactivate_trait": "VAMPIRIC_RESILIENCE" }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_SCENT_BLOOD_activated",
    "condition": {
      "math": [
        "(u_characters_nearby('radius': 30, 'attitude': 'any') + u_monsters_nearby('mon_feral_cop', 'mon_feral_human_pipe', 'mon_feral_human_crowbar', 'mon_feral_jackboot', 'mon_feral_marine_bayonet', 'mon_feral_soldier', 'mon_feral_prepper_knife', 'mon_feral_sailor_axe', 'mon_feral_maid_knife', 'mon_feral_maid_candlestick', 'mon_feral_officer', 'mon_feral_sailor_lug_wrench', 'mon_feral_sailor_mop', 'mon_feral_maid_broom', 'mon_feral_sailor_wrench', 'mon_feral_swimmer_kickboard', 'mon_feral_armored_battleaxe', 'mon_feral_sapien_spear', 'mon_feral_armored_mace', 'mon_feral_human_tool', 'mon_feral_militia', 'mon_feral_fancy_rapier_fake', 'mon_feral_fancy_rapier', 'mon_feral_human_axe', 'mon_feral_labsecurity_flashlight', 'mon_feral_labsecurity_9mm',  'mon_feral_survivalist', 'mon_feral_scientist_scalpel', 'mon_feral_zebra_agent', 'mon_renfield', 'mon_renfield_9mm', 'mon_renfield_shotgun', 'mon_renfield_flamethrower', 'radius': 30, 'attitude': 'both'))",
        ">=",
        "1"
      ]
    },
    "effect": [ { "u_message": "The scent of fresh blood fills your nostrils.  There is a human nearby.", "type": "good" } ],
    "false_effect": [ { "u_message": "You do not smell any nearby human blood.", "type": "neutral" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_STAMINAFORBLOOD_activated",
    "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
    "effect": [
      { "u_assign_activity": "ACT_GENERIC_EOC", "duration": "1 seconds" },
      { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "100" ] },
      {
        "u_message": "Your veins pulse as your body pushes some of your blood reserves to exhaustion and early dissolution.",
        "type": "good"
      },
      {
        "math": [
          "u_val('stamina')",
          "+=",
          "min((1500 + (vampire_total_tier_one_traits() * 200) + (vampire_total_tier_two_traits() * 450) + (vampire_total_tier_three_traits() * 900) + (vampire_total_tier_four_traits_plus_potence() * 1500) + (vampire_total_tier_five_traits() * 2000)), 15000)"
        ]
      }
    ],
    "false_effect": [ { "u_message": "You don't have enough blood to recover any stamina.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_COMMUNE_NIGHT_MAP",
    "condition": { "and": [ { "math": [ "u_val('pos_z') >= 0" ] }, { "not": "is_day" }, "u_is_outside" ] },
    "effect": [
      { "u_cast_spell": { "id": "vampire_map_real" } },
      { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "100" ] },
      { "u_message": "The children of the night tell you what features of the map are nearby." }
    ],
    "false_effect": [ { "u_message": "Without the ability to howl into the wilds of the night, there is no response." } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_COAGULANTWEAVE_activated",
    "condition": { "not": { "u_has_effect": "blood_weave" } },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_COAGULANTWEAVE_activated_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "u_assign_activity": "ACT_GENERIC_EOC", "duration": 0.75 },
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "500" ] },
              { "u_add_effect": "blood_weave", "duration": "PERMANENT" },
              { "u_message": "You hold tightly to your blood, preventing it from leaving your body.", "type": "good" },
              { "u_lose_effect": "bleed", "target_part": "ALL" },
              {
                "run_eocs": [ "EOC_COAGULANTWEAVE_maintenance" ],
                "time_in_future": {
                  "math": [
                    "rng(0.75,1.25) * (300 + (vampire_total_tier_one_traits() * 33) + (vampire_total_tier_two_traits() * 75) + (vampire_total_tier_three_traits() * 125) + (vampire_total_tier_four_traits_plus_potence() * 200) + (vampire_total_tier_five_traits() * 275))"
                  ]
                }
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to activate coagulant weave.", "type": "bad" },
              { "run_eocs": "EOC_COAGULANTWEAVE_deactivate_future", "time_in_future": 0 }
            ]
          }
        ]
      }
    ],
    "false_effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_COAGULANTWEAVE_deactivated",
            "condition": { "u_has_effect": "blood_weave" },
            "effect": [
              { "u_message": "Your blood flows more freely as your grip on it relaxes.", "type": "neutral" },
              { "u_lose_effect": "blood_weave" }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_COAGULANTWEAVE_deactivate_future",
    "//": "This is necessary because calling u_deactivate_trait from within the trait EoC does not work",
    "effect": { "u_deactivate_trait": "COAGULANTWEAVE" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_COAGULANTWEAVE_maintenance",
    "condition": { "u_has_effect": "blood_weave" },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_COAGULANTWEAVE_maintenance_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "250" ] },
              {
                "u_message": "You feel a momentary warmth as you maintain your grip on your stolen blood.",
                "type": "mixed"
              },
              {
                "run_eocs": [ "EOC_COAGULANTWEAVE_maintenance" ],
                "time_in_future": {
                  "math": [
                    "rng(0.75,1.25) * (300 + (vampire_total_tier_one_traits() * 33) + (vampire_total_tier_two_traits() * 75) + (vampire_total_tier_three_traits() * 125) + (vampire_total_tier_four_traits_plus_potence() * 200) + (vampire_total_tier_five_traits() * 275))"
                  ]
                }
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to maintain your coagulant weave.", "type": "bad" },
              { "u_lose_effect": "blood_weave" },
              { "u_deactivate_trait": "COAGULANTWEAVE" }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_BLOODHEAL_activated",
    "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
    "effect": [
      { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "750" ] },
      { "u_message": "Blood suffuses your flesh, repairing any damage it comes across.", "type": "good" },
      {
        "math": [
          "u_hp('arm_l')",
          "+=",
          "min((5 + (vampire_total_tier_one_traits() * 0.75) + (vampire_total_tier_two_traits() * 1) + (vampire_total_tier_three_traits() * 1.25) + (vampire_total_tier_four_traits_plus_potence() * 2.5) + (vampire_total_tier_five_traits() * 3.5)), 25)"
        ]
      },
      {
        "math": [
          "u_hp('arm_r')",
          "+=",
          "min((5 + (vampire_total_tier_one_traits() * 0.75) + (vampire_total_tier_two_traits() * 1) + (vampire_total_tier_three_traits() * 1.25) + (vampire_total_tier_four_traits_plus_potence() * 2.5) + (vampire_total_tier_five_traits() * 3.5)), 25)"
        ]
      },
      {
        "math": [
          "u_hp('leg_l')",
          "+=",
          "min((5 + (vampire_total_tier_one_traits() * 0.75) + (vampire_total_tier_two_traits() * 1) + (vampire_total_tier_three_traits() * 1.25) + (vampire_total_tier_four_traits_plus_potence() * 2.5) + (vampire_total_tier_five_traits() * 3.5)), 25)"
        ]
      },
      {
        "math": [
          "u_hp('leg_r')",
          "+=",
          "min((5 + (vampire_total_tier_one_traits() * 0.75) + (vampire_total_tier_two_traits() * 1) + (vampire_total_tier_three_traits() * 1.25) + (vampire_total_tier_four_traits_plus_potence() * 2.5) + (vampire_total_tier_five_traits() * 3.5)), 25)"
        ]
      },
      {
        "math": [
          "u_hp('torso')",
          "+=",
          "min((5 + (vampire_total_tier_one_traits() * 0.75) + (vampire_total_tier_two_traits() * 1) + (vampire_total_tier_three_traits() * 1.25) + (vampire_total_tier_four_traits_plus_potence() * 2.5) + (vampire_total_tier_five_traits() * 3.5)), 25)"
        ]
      },
      {
        "math": [
          "u_hp('head')",
          "+=",
          "min((5 + (vampire_total_tier_one_traits() * 0.75) + (vampire_total_tier_two_traits() * 1) + (vampire_total_tier_three_traits() * 1.25) + (vampire_total_tier_four_traits_plus_potence() * 2.5) + (vampire_total_tier_five_traits() * 3.5)), 25)"
        ]
      }
    ],
    "false_effect": [ { "u_message": "You don't have enough blood to heal your wounds.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRIC_DODGE_activated",
    "condition": { "not": { "u_has_effect": "effect_vampiric_dodge" } },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRIC_DODGE_activated_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "u_assign_activity": "ACT_GENERIC_EOC", "duration": 0.75 },
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "250" ] },
              { "u_add_effect": "effect_vampiric_dodge", "duration": "PERMANENT" },
              { "u_message": "You begin dodging with preternatural agility.", "type": "good" },
              {
                "run_eocs": [ "EOC_VAMPIRIC_DODGE_maintenance" ],
                "time_in_future": {
                  "math": [
                    "rng(0.75,1.25) * (60 + (vampire_total_tier_one_traits() * 5) + (vampire_total_tier_two_traits() * 12) + (vampire_total_tier_three_traits() * 20) + (vampire_total_tier_four_traits_plus_potence() * 30) + (vampire_total_tier_five_traits() * 40))"
                  ]
                }
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to activate flow like blood.", "type": "bad" },
              { "run_eocs": "EOC_VAMPIRIC_DODGE_deactivate_future", "time_in_future": 0 }
            ]
          }
        ]
      }
    ],
    "false_effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRIC_DODGE_deactivate",
            "condition": { "u_has_effect": "effect_vampiric_dodge" },
            "effect": [
              { "u_message": "Your movements slow as your lose your preternatural avoidance.", "type": "neutral" },
              { "u_lose_effect": "effect_vampiric_dodge" }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRIC_DODGE_deactivate_future",
    "//": "This is necessary because calling u_deactivate_trait from within the trait EoC does not work",
    "effect": { "u_deactivate_trait": "VAMPIRIC_DODGE" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRIC_DODGE_maintenance",
    "condition": { "u_has_effect": "effect_vampiric_dodge" },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRIC_DODGE_maintenance_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "125" ] },
              {
                "u_message": "You feel a momentary warmth as you maintain your preternatural dodging.",
                "type": "mixed"
              },
              {
                "run_eocs": [ "EOC_VAMPIRIC_DODGE_maintenance" ],
                "time_in_future": {
                  "math": [
                    "rng(0.75,1.25) * (60 + (vampire_total_tier_one_traits() * 5) + (vampire_total_tier_two_traits() * 12) + (vampire_total_tier_three_traits() * 20) + (vampire_total_tier_four_traits_plus_potence() * 30) + (vampire_total_tier_five_traits() * 40))"
                  ]
                }
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to maintain your flow like blood.", "type": "bad" },
              { "u_lose_effect": "effect_vampiric_dodge" },
              { "u_deactivate_trait": "VAMPIRIC_DODGE" }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_FEAR_GAZE_activated",
    "condition": { "math": [ "n_vitamin('human_blood_vitamin') >= -500" ] },
    "effect": [
      {
        "math": [
          "u_vampire_fear_gaze_power_level",
          "=",
          "(n_vampire_total_tier_one_traits * 0.5) + (n_vampire_total_tier_two_traits * 0.75) + (n_vampire_total_tier_three_traits * 1) + (n_vampire_total_tier_four_traits * 2) + (n_vampire_total_tier_five_traits * 3)"
        ]
      },
      { "math": [ "n_vitamin('human_blood_vitamin')", "-=", "150" ] },
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_FEAR_GAZE_activated_2",
            "condition": { "not": { "u_has_effect": "effect_vampire_fear_gazed" } },
            "effect": [
              {
                "run_eocs": [
                  {
                    "id": "EOC_VAMPIRE_FEAR_GAZE_activated_3",
                    "condition": "u_is_npc",
                    "effect": [
                      { "math": [ "u_npc_fear()", "+=", "u_vampire_fear_gaze_power_level / 2" ] },
                      { "npc_message": "You bare your fangs and hiss at your target." },
                      { "u_add_effect": "effect_vampire_fear_gazed", "duration": "5 minutes" }
                    ],
                    "false_effect": [
                      { "math": [ "u_val('morale')", "-=", "u_vampire_fear_gaze_power_level * 5" ] },
                      { "npc_message": "You bare your fangs and hiss at your target." },
                      { "u_add_effect": "effect_vampire_fear_gazed", "duration": "5 minutes" }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ],
    "false_effect": [ { "npc_message": "You don't have enough blood to activate your predator's mien.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_BEAST_CLAWS_activated",
    "condition": { "not": { "u_has_trait": "VAMPIRE_BEAST_CLAWS_active" } },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_BEAST_CLAWS_activated_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "u_assign_activity": "ACT_GENERIC_EOC", "duration": 0.75 },
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "125" ] },
              { "u_add_trait": "VAMPIRE_BEAST_CLAWS_active" },
              { "u_message": "Your fingers twist into sharp claws.", "type": "good" },
              {
                "run_eocs": [ "EOC_VAMPIRE_BEAST_CLAWS_maintenance" ],
                "time_in_future": {
                  "math": [
                    "rng(0.75,1.25) * (800 + (vampire_total_tier_one_traits() * 60) + (vampire_total_tier_two_traits() * 100) + (vampire_total_tier_three_traits() * 150) + (vampire_total_tier_four_traits_plus_potence() * 225) + (vampire_total_tier_five_traits() * 300))"
                  ]
                }
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to activate your claws of the beast.", "type": "bad" },
              { "run_eocs": "EOC_VAMPIRE_BEAST_CLAWS_deactivate_future", "time_in_future": 0 }
            ]
          }
        ]
      }
    ],
    "false_effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_BEAST_CLAWS_deactivate",
            "condition": { "u_has_trait": "VAMPIRE_BEAST_CLAWS_active" },
            "effect": [
              { "u_message": "Your fingers warp and twist as your claws vanish.", "type": "neutral" },
              { "u_lose_trait": "VAMPIRE_BEAST_CLAWS_active" }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_BEAST_CLAWS_deactivate_future",
    "//": "This is necessary because calling u_deactivate_trait from within the trait EoC does not work",
    "effect": { "u_deactivate_trait": "VAMPIRE_BEAST_CLAWS" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_BEAST_CLAWS_maintenance",
    "condition": { "u_has_trait": "VAMPIRE_BEAST_CLAWS_active" },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_BEAST_CLAWS_maintenance_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "62" ] },
              { "u_message": "You feel a momentary warmth as you maintain your sharp claws.", "type": "mixed" },
              {
                "run_eocs": [ "EOC_VAMPIRE_BEAST_CLAWS_maintenance" ],
                "time_in_future": {
                  "math": [
                    "rng(0.75,1.25) * (800 + (vampire_total_tier_one_traits() * 60) + (vampire_total_tier_two_traits() * 100) + (vampire_total_tier_three_traits() * 150) + (vampire_total_tier_four_traits_plus_potence() * 225) + (vampire_total_tier_five_traits() * 300))"
                  ]
                }
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to maintain your claws of the beast.", "type": "bad" },
              { "u_lose_trait": "VAMPIRE_BEAST_CLAWS_active" },
              { "u_deactivate_trait": "VAMPIRE_BEAST_CLAWS" }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_MAGICFORBLOOD_activated",
    "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
    "effect": [
      { "u_assign_activity": "ACT_GENERIC_EOC", "duration": "1 seconds" },
      { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "200" ] },
      {
        "u_message": "Your veins pulse as your body pushes some of your blood reserves to exhaustion and early dissolution.",
        "type": "good"
      },
      {
        "math": [
          "u_val('mana')",
          "+=",
          "min((150 + (vampire_total_tier_one_traits() * 20) + (vampire_total_tier_two_traits() * 45) + (vampire_total_tier_three_traits() * 90) + (vampire_total_tier_four_traits_plus_potence() * 150) + (vampire_total_tier_five_traits() * 200)), 1500)"
        ]
      }
    ],
    "false_effect": [ { "u_message": "You don't have enough blood to recover any mana.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_HYPNOTIC_GAZE_activated",
    "condition": { "math": [ "n_vitamin('human_blood_vitamin') >= -500" ] },
    "effect": [
      {
        "math": [
          "u_vampire_hypnotic_gaze_power_level",
          "=",
          "2 + (n_vampire_total_tier_one_traits * 0.5) + (n_vampire_total_tier_two_traits * 0.75) + (n_vampire_total_tier_three_traits * 1.2) + (n_vampire_total_tier_four_traits * 2.5) + (n_vampire_total_tier_five_traits * 3.5)"
        ]
      },
      { "math": [ "n_vitamin('human_blood_vitamin')", "-=", "150" ] },
      {
        "run_eocs": [
          {
            "id": "EOC_HYPNOTIC_GAZE_activated_2",
            "effect": [ { "u_add_effect": "stunned", "duration": { "math": [ "u_vampire_hypnotic_gaze_power_level" ] } } ]
          }
        ]
      }
    ],
    "false_effect": [ { "npc_message": "You don't have enough blood to activate your hypnotic gaze.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_BLOODHASTE_activated",
    "condition": { "not": { "u_has_effect": "haste" } },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_BLOODHASTE_activated_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "u_assign_activity": "ACT_GENERIC_EOC", "duration": 2 },
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "750" ] },
              { "u_add_effect": "haste", "duration": "PERMANENT" },
              { "u_message": "You movements accelerate to superhuman levels.", "type": "good" },
              {
                "run_eocs": [ "EOC_BLOODHASTE_maintenance" ],
                "time_in_future": {
                  "math": [
                    "rng(0.75,1.25) * (60 + (vampire_total_tier_one_traits() * 5) + (vampire_total_tier_two_traits() * 12) + (vampire_total_tier_three_traits() * 20)  + (vampire_total_tier_four_traits_plus_potence() * 30) + (vampire_total_tier_five_traits() * 40))"
                  ]
                }
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to activate blood-driven speed.", "type": "bad" },
              { "run_eocs": "EOC_BLOODHASTE_deactivate_future", "time_in_future": 0 }
            ]
          }
        ]
      }
    ],
    "false_effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_BLOODHASTE_deactivated",
            "condition": { "u_has_effect": "haste" },
            "effect": [ { "u_message": "Your speed returns to normal.", "type": "neutral" }, { "u_lose_effect": "haste" } ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_BLOODHASTE_deactivate_future",
    "//": "This is necessary because calling u_deactivate_trait from within the trait EoC does not work",
    "effect": { "u_deactivate_trait": "BLOODHASTE" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_BLOODHASTE_maintenance",
    "condition": { "u_has_effect": "haste" },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_BLOODHASTE_maintenance_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "375" ] },
              { "u_message": "You feel a momentary warmth as you maintain your superhuman speed.", "type": "mixed" },
              {
                "run_eocs": [ "EOC_BLOODHASTE_maintenance" ],
                "time_in_future": {
                  "math": [
                    "rng(0.75,1.25) * (60 + (vampire_total_tier_one_traits() * 5) + (vampire_total_tier_two_traits() * 12) + (vampire_total_tier_three_traits() * 20)  + (vampire_total_tier_four_traits_plus_potence() * 30) + (vampire_total_tier_five_traits() * 40))"
                  ]
                }
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to maintain your blood-driven speed.", "type": "bad" },
              { "u_lose_effect": "haste" },
              { "u_deactivate_trait": "BLOODHASTE" }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_COMMAND_BEAST_activated",
    "condition": { "math": [ "n_vitamin('human_blood_vitamin') >= -500" ] },
    "effect": [
      { "math": [ "n_vitamin('human_blood_vitamin')", "-=", "500" ] },
      { "u_location_variable": { "context_val": "loc" } },
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_COMMAND_BEAST_activated_2",
            "effect": [
              { "npc_cast_spell": { "id": "vampire_command_beast_spell_real", "min_level": 1 }, "loc": { "context_val": "loc" } },
              { "npc_message": "You exert your predatory will on your target.", "type": "good" }
            ]
          }
        ]
      }
    ],
    "false_effect": [ { "npc_message": "You don't have enough blood to attempt to cow the beast.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_EARTH_SLUMBER_activated",
    "condition": {
      "or": [
        { "u_is_on_terrain_with_flag": "DIGGABLE" },
        { "u_is_on_terrain": "t_soil" },
        { "u_is_on_terrain": "t_rock" },
        { "u_is_on_terrain": "t_dirt_underground" }
      ]
    },
    "effect": [ { "run_eocs": "EOC_VAMPIRE_EARTH_SLUMBER_activated_2" } ],
    "false_effect": [ { "u_message": "You must be on diggable soil to sink into it.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_EARTH_SLUMBER_activated_2",
    "condition": { "not": { "math": [ "u_val('pos_z') == -9" ] } },
    "effect": [
      {
        "run_eocs": {
          "id": "EOC_VAMPIRE_EARTH_SLUMBER_activated_3",
          "effect": [
            { "u_location_variable": { "u_val": "VAMPIRE_sleep_in_earth_starting_point" }, "min_radius": 0, "max_radius": 0 },
            {
              "u_location_variable": { "u_val": "VAMPIRE_sleep_in_earth_destination" },
              "min_radius": 0,
              "max_radius": 0,
              "z_adjust": -9,
              "z_override": true
            },
            { "u_message": "The earth parts beneath you and you sink down into the soil.", "type": "good" },
            { "u_teleport": { "u_val": "VAMPIRE_sleep_in_earth_destination" }, "force": true }
          ]
        }
      }
    ],
    "false_effect": [
      { "u_teleport": { "u_val": "VAMPIRE_sleep_in_earth_starting_point" } },
      { "u_message": "You feel yourself rising until you stand in the clear air once again.", "type": "good" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_TORPOR_activated",
    "effect": [
      { "u_assign_activity": "ACT_VAMPIRE_TORPOR", "duration": "8 hours" },
      { "u_add_effect": "effect_vampire_torpor", "duration": "8 hours" }
    ]
  },
  {
    "id": "ACT_VAMPIRE_TORPOR",
    "type": "activity_type",
    "activity_level": "NO_EXERCISE",
    "verb": "slumbering",
    "based_on": "time",
    "can_resume": false,
    "interruptable": false,
    "interruptable_with_kb": false,
    "rooted": true,
    "do_turn_eoc": "EOC_VAMPIRE_TORPOR_RECOVER",
    "completion_eoc": "EOC_EARTH_SLEEP_CHECK_REAL"
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_TORPOR_RECOVER",
    "effect": [ { "math": [ "u_val('sleepiness') = 0" ] }, { "math": [ "u_val('sleep_deprivation') = 0" ] } ]
  },
  {
    "type": "effect_type",
    "id": "effect_vampire_torpor",
    "name": [ "Torpor" ],
    "desc": [ "Thanks to your torpor you are healing and recovering quickly" ],
    "rating": "good",
    "vitamins": [ { "vitamin": "human_blood_vitamin", "rate": [ [ 1, 1 ] ], "tick": [ "3 m" ] } ],
    "flags": [ "DEAF", "BLIND" ],
    "enchantments": [
      {
        "values": [
          {
            "value": "REGEN_HP",
            "multiply": {
              "math": [
                "(u_vampire_total_tier_one_traits * 0.05) + (u_vampire_total_tier_two_traits * 0.075) + (u_vampire_total_tier_three_traits * 0.1) + (vampire_total_tier_four_traits_plus_potence() * 0.2) + (u_vampire_total_tier_five_traits * 0.3)"
              ]
            }
          },
          {
            "value": "MENDING_MODIFIER",
            "multiply": {
              "math": [
                "(u_vampire_total_tier_one_traits * 0.05) + (u_vampire_total_tier_two_traits * 0.075) + (u_vampire_total_tier_three_traits * 0.1) + (vampire_total_tier_four_traits_plus_potence() * 0.2) + (u_vampire_total_tier_five_traits * 0.3)"
              ]
            }
          },
          { "value": "REGEN_HP_AWAKE", "multiply": 1 }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_DOMINATE_activated",
    "condition": { "math": [ "n_vitamin('human_blood_vitamin') >= -500" ] },
    "effect": [
      { "math": [ "n_vitamin('human_blood_vitamin')", "-=", "700" ] },
      { "u_location_variable": { "context_val": "loc" } },
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_DOMINATE_activated2",
            "effect": [
              { "npc_cast_spell": { "id": "vampire_dominate_real", "min_level": 1 }, "loc": { "context_val": "loc" } },
              {
                "npc_message": "You focus you gaze on your target's mind, attempting to take control of it.",
                "type": "good"
              }
            ]
          }
        ]
      }
    ],
    "false_effect": [ { "npc_message": "You don't have enough blood to activate your dominating gaze.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_BAT_FORM_activated",
    "condition": { "not": { "u_has_trait": "VAMPIRE_BAT_FORM_TRAITS" } },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_BAT_FORM_activated_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "run_eocs": "EOC_VAMPIRE_CANCEL_WOLF_FORM" },
              { "run_eocs": "EOC_VAMPIRE_CANCEL_MIST_FORM" },
              { "run_eocs": "EOC_VAMPIRE_CANCEL_SHADOW_FORM" },
              { "u_assign_activity": "ACT_GENERIC_EOC", "duration": 1.5 },
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "600" ] },
              { "u_add_trait": "VAMPIRE_BAT_FORM_TRAITS" },
              { "u_add_trait": "ECHOLOCATION" },
              { "math": [ "u_calories('dont_affect_weariness': true)", "/=", "4" ] },
              {
                "u_message": "Your fingers lengthen as flaps of skin grow between them and as your legs shorten, you take to the air.",
                "type": "good"
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to transform into a bat.", "type": "bad" },
              { "run_eocs": "EOC_VAMPIRE_BAT_FORM_deactivate_future", "time_in_future": 0 }
            ]
          }
        ]
      }
    ],
    "false_effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_BAT_FORM_deactivated",
            "condition": { "u_has_trait": "VAMPIRE_BAT_FORM_TRAITS" },
            "effect": [
              { "run_eocs": "EOC_VAMPIRE_SHADOW_FORM_deactivated" },
              { "run_eocs": "EOC_VAMPIRE_SHADOW_FORM_deactivate_future", "time_in_future": 0 },
              { "u_message": "Your wings recede and you land on now-humanoid legs.", "type": "neutral" },
              { "u_lose_trait": "VAMPIRE_BAT_FORM_TRAITS" },
              { "u_lose_trait": "ECHOLOCATION" },
              { "math": [ "u_calories('dont_affect_weariness': true)", "*=", "4" ] },
              { "math": [ "u_spell_level('vampire_bat_form_fly_upward') = -1" ] }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_BAT_FORM_deactivate_future",
    "//": "This is necessary because calling u_deactivate_trait from within the trait EoC does not work",
    "effect": { "u_deactivate_trait": "VAMPIRE_BAT_FORM" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_WOLF_FORM_activated",
    "condition": { "not": { "u_has_trait": "VAMPIRE_WOLF_FORM_TRAITS" } },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_WOLF_FORM_activated_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "run_eocs": "EOC_VAMPIRE_CANCEL_BAT_FORM" },
              { "run_eocs": "EOC_VAMPIRE_CANCEL_MIST_FORM" },
              { "run_eocs": "EOC_VAMPIRE_CANCEL_SHADOW_FORM" },
              { "u_assign_activity": "ACT_GENERIC_EOC", "duration": 1.5 },
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "600" ] },
              { "u_add_trait": "VAMPIRE_WOLF_FORM_TRAITS" },
              {
                "u_message": "Your nose pushes out into a muzzle as you fall forward on all fours and let out a snarl.",
                "type": "good"
              }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to transform into a wolf.", "type": "bad" },
              { "run_eocs": "EOC_VAMPIRE_WOLF_FORM_deactivate_future", "time_in_future": 0 }
            ]
          }
        ]
      }
    ],
    "false_effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_WOLF_FORM_deactivated",
            "condition": { "u_has_trait": "VAMPIRE_WOLF_FORM_TRAITS" },
            "effect": [
              { "u_message": "Your fur disappears and you walk once again on two legs.", "type": "neutral" },
              { "u_lose_trait": "VAMPIRE_WOLF_FORM_TRAITS" }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_WOLF_FORM_deactivate_future",
    "//": "This is necessary because calling u_deactivate_trait from within the trait EoC does not work",
    "effect": { "u_deactivate_trait": "VAMPIRE_WOLF_FORM" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_MIST_FORM_activated",
    "condition": { "not": { "u_has_trait": "VAMPIRE_MIST_FORM_TRAITS" } },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_MIST_FORM_activated_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": [
              { "run_eocs": "EOC_VAMPIRE_CANCEL_BAT_FORM" },
              { "run_eocs": "EOC_VAMPIRE_CANCEL_WOLF_FORM" },
              { "run_eocs": "EOC_VAMPIRE_CANCEL_SHADOW_FORM" },
              { "u_assign_activity": "ACT_GENERIC_EOC", "duration": 1.5 },
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "600" ] },
              { "u_add_trait": "VAMPIRE_MIST_FORM_TRAITS" },
              { "u_add_effect": "effect_vampire_mist_form", "duration": "PERMANENT" },
              { "u_add_effect": "incorporeal", "duration": "PERMANENT" },
              { "math": [ "u_spell_level('vampire_mist_form_pass_through_doors_and_windows') = 0" ] },
              { "u_message": "Your body falls apart into billowing mist.", "type": "good" }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to transform into mist.", "type": "bad" },
              { "run_eocs": "EOC_VAMPIRE_MIST_FORM_deactivate_future", "time_in_future": 0 }
            ]
          }
        ]
      }
    ],
    "false_effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_MIST_FORM_deactivated",
            "condition": { "u_has_trait": "VAMPIRE_MIST_FORM_TRAITS" },
            "effect": [
              { "u_message": "You reconstitute yourself from the billowing mists.", "type": "neutral" },
              { "u_lose_effect": [ "effect_vampire_mist_form", "incorporeal" ] },
              { "u_lose_trait": "VAMPIRE_MIST_FORM_TRAITS" },
              { "math": [ "u_spell_level('vampire_mist_form_pass_through_doors_and_windows') = -1" ] }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_MIST_FORM_deactivate_future",
    "//": "This is necessary because calling u_deactivate_trait from within the trait EoC does not work",
    "effect": { "u_deactivate_trait": "VAMPIRE_MIST_FORM" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_MIST_FORM_BLOOD_COST",
    "eoc_type": "EVENT",
    "required_event": "avatar_moves",
    "condition": { "u_has_trait": "VAMPIRE_MIST_FORM_TRAITS" },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_MIST_FORM_BLOOD_COST_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "2" ] },
            "false_effect": [
              { "u_message": "You don't have enough blood to maintain your mist form.", "type": "bad" },
              { "run_eocs": "EOC_VAMPIRE_MIST_FORM_deactivated" },
              { "run_eocs": "EOC_VAMPIRE_MIST_FORM_deactivate_future", "time_in_future": 0 }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_MIST_FORM_SEEP_THROUGH_DOOR_WINDOW",
    "effect": [
      {
        "u_choose_adjacent_highlight": { "context_val": "vampire_mist_door_or_window_seep" },
        "condition": {
          "or": [
            { "map_terrain_with_flag": "DOOR", "loc": { "context_val": "loc" } },
            { "map_terrain_with_flag": "WINDOW", "loc": { "context_val": "loc" } }
          ]
        },
        "message": "Select door or window."
      },
      {
        "if": { "math": [ "has_var(_vampire_mist_door_or_window_seep)" ] },
        "then": [
          {
            "u_choose_adjacent_highlight": { "context_val": "place_to_teleport" },
            "target_var": { "context_val": "vampire_mist_door_or_window_seep" },
            "condition": {
              "and": [
                { "not": { "is_outside": { "context_val": "loc" } } },
                { "not": { "map_terrain_with_flag": "WALL", "loc": { "context_val": "loc" } } },
                { "not": { "map_terrain_with_flag": "DOOR", "loc": { "context_val": "loc" } } },
                { "not": { "map_terrain_with_flag": "WINDOW", "loc": { "context_val": "loc" } } }
              ]
            },
            "message": "Select where to appear."
          },
          {
            "u_teleport": { "context_val": "place_to_teleport" },
            "success_message": "In a second, you were always inside."
          }
        ],
        "else": { "u_message": "You must be near a door or window to seep through." }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "eoc_vampire_blood_to_kcal",
    "//": "Check if the vampire is underweight or lower for their size category.  If yes, consume some blood to increase their calories.  Conversion rate of 1 blood vitamin to 5 calories, in 500 calories chunks.",
    "//2": "95000 Kcal is within the normal range for a medium-sized character for both short and tall.  This value is then multiplied or divided to account for the player's size category.  The following EOCs are listed according to the code's check order.",
    "recurrence": [ "50 m", "70 m" ],
    "condition": { "u_has_trait": "BLOOD_DRINKER" },
    "deactivate_condition": { "not": { "u_has_trait": "BLOOD_DRINKER" } },
    "effect": [
      { "math": [ "u_calories_needed = 95000" ] },
      {
        "run_eocs": [
          {
            "id": "eoc_vampire_blood_to_kcal_check_size_tiny",
            "condition": { "u_has_flag": "TINY" },
            "effect": [ { "math": [ "u_calories_needed", "/=", "8" ] }, { "run_eocs": "eoc_vampire_blood_to_kcal_convert" } ],
            "false_effect": [ { "run_eocs": [ "eoc_vampire_blood_to_kcal_check_size_small" ] } ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "eoc_vampire_blood_to_kcal_check_size_small",
    "condition": { "u_has_flag": "SMALL" },
    "effect": [ { "math": [ "u_calories_needed", "/=", "3" ] }, { "run_eocs": "eoc_vampire_blood_to_kcal_convert" } ],
    "false_effect": [ { "run_eocs": [ "eoc_vampire_blood_to_kcal_check_size_large" ] } ]
  },
  {
    "type": "effect_on_condition",
    "id": "eoc_vampire_blood_to_kcal_check_size_large",
    "condition": { "u_has_flag": "LARGE" },
    "effect": [ { "math": [ "u_calories_needed", "*=", "1.5" ] }, { "run_eocs": "eoc_vampire_blood_to_kcal_convert" } ],
    "false_effect": [ { "run_eocs": [ "eoc_vampire_blood_to_kcal_check_size_huge" ] } ]
  },
  {
    "type": "effect_on_condition",
    "id": "eoc_vampire_blood_to_kcal_check_size_huge",
    "condition": { "u_has_flag": "HUGE" },
    "effect": [ { "math": [ "u_calories_needed", "*=", "2" ] }, { "run_eocs": "eoc_vampire_blood_to_kcal_convert" } ],
    "false_effect": [ { "run_eocs": [ "eoc_vampire_blood_to_kcal_convert" ] } ]
  },
  {
    "type": "effect_on_condition",
    "id": "eoc_vampire_blood_to_kcal_convert",
    "condition": {
      "and": [
        { "math": [ "u_vitamin('human_blood_vitamin') > 500" ] },
        { "math": [ "u_calories('dont_affect_weariness': true) < u_calories_needed" ] }
      ]
    },
    "effect": [
      { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "100" ] },
      { "math": [ "u_calories('dont_affect_weariness': true)", "+=", "500" ] },
      {
        "u_message": "Some of your stolen blood is consumed by your body, making it a little less gaunt.",
        "type": "good"
      }
    ]
  },
  {
    "type": "enchantment",
    "id": "ench_vampire_no_gorge_issues",
    "has": "HELD",
    "condition": "ALWAYS",
    "ench_effects": [ { "effect": "effect_vampire_no_gorge_issues", "intensity": 1 } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_SHADOW_FORM_activated",
    "condition": { "not": { "u_has_trait": "VAMPIRE_SHADOW_FORM_TRAITS" } },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_SHADOW_FORM_activated_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= 500" ] },
            "effect": [
              { "run_eocs": "EOC_VAMPIRE_CANCEL_BAT_FORM" },
              { "run_eocs": "EOC_VAMPIRE_CANCEL_WOLF_FORM" },
              { "run_eocs": "EOC_VAMPIRE_CANCEL_MIST_FORM" },
              { "u_assign_activity": "ACT_GENERIC_EOC", "duration": 1.5 },
              { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "800" ] },
              { "u_add_trait": "VAMPIRE_SHADOW_FORM_TRAITS" },
              { "u_message": "Shadows surround you until only your now-glowing eyes remain visible.", "type": "good" }
            ],
            "false_effect": [
              { "u_message": "You don't have enough blood to shroud yourself in shadow.", "type": "bad" },
              { "run_eocs": "EOC_VAMPIRE_SHADOW_FORM_deactivate_future", "time_in_future": 0 }
            ]
          }
        ]
      }
    ],
    "false_effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_SHADOW_FORM_deactivated",
            "condition": { "u_has_trait": "VAMPIRE_SHADOW_FORM_TRAITS" },
            "effect": [
              { "u_message": "Your eyes stop glowing and the shadows surrounding you dissipate.", "type": "neutral" },
              { "u_lose_trait": "VAMPIRE_SHADOW_FORM_TRAITS" }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_SHADOW_FORM_deactivate_future",
    "//": "This is necessary because calling u_deactivate_trait from within the trait EoC does not work",
    "effect": { "u_deactivate_trait": "VAMPIRE_SHADOW_FORM" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_SHADOW_FORM_BLOOD_COST",
    "recurrence": [ "1 s", "1 s" ],
    "condition": { "u_has_trait": "VAMPIRE_SHADOW_FORM_TRAITS" },
    "deactivate_condition": { "not": { "u_has_trait": "VAMPIRE_SHADOW_FORM_TRAITS" } },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAMPIRE_SHADOW_FORM_BLOOD_COST_2",
            "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= -500" ] },
            "effect": { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "5" ] },
            "false_effect": [
              { "u_message": "You don't have enough blood to maintain the shadows surrounding you.", "type": "bad" },
              { "run_eocs": "EOC_VAMPIRE_SHADOW_FORM_deactivated" },
              { "run_eocs": "EOC_VAMPIRE_SHADOW_FORM_deactivate_future", "time_in_future": 0 }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_CANCEL_BAT_FORM",
    "//": "This checks for that shape, and toggle it off if found.",
    "condition": { "u_has_trait": "VAMPIRE_BAT_FORM_TRAITS" },
    "effect": { "u_deactivate_trait": "VAMPIRE_BAT_FORM" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_CANCEL_WOLF_FORM",
    "//": "This checks for that shape, and toggle it off if found.",
    "condition": { "u_has_trait": "VAMPIRE_WOLF_FORM_TRAITS" },
    "effect": { "u_deactivate_trait": "VAMPIRE_WOLF_FORM" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_CANCEL_MIST_FORM",
    "//": "This checks for that shape, and toggle it off if found.",
    "condition": { "u_has_trait": "VAMPIRE_MIST_FORM_TRAITS" },
    "effect": { "u_deactivate_trait": "VAMPIRE_MIST_FORM" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_CANCEL_SHADOW_FORM",
    "//": "This checks for that shape, and toggle it off if found.",
    "condition": { "u_has_trait": "VAMPIRE_SHADOW_FORM_TRAITS" },
    "effect": { "u_deactivate_trait": "VAMPIRE_SHADOW_FORM" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_last_breath_mist",
    "//": "This EOC is called when the player dies.  If the player has enough blood and this ability isn't in cooldown, it'll save their life and execute multiple effects.  If it can't trigger, the player dies as usual.",
    "eoc_type": "PREVENT_DEATH",
    "condition": {
      "and": [
        { "u_has_trait": "VAMPIRE_LAST_BREATH_MIST" },
        { "not": { "u_has_effect": "last_breath_mist_cooldown" } },
        { "math": [ "u_vitamin('human_blood_vitamin') >= 1800" ] }
      ]
    },
    "effect": [
      "u_prevent_death",
      { "run_eocs": [ "EOC_VAMPIRE_MIST_FORM_TRAIT_activated" ] },
      { "math": [ "u_hp('torso') = max( u_hp('torso'), 30)" ] },
      { "math": [ "u_hp('head') = max( u_hp('head'), 30)" ] },
      { "math": [ "u_hp('arm_l') = max( u_hp('arm_l'), 30)" ] },
      { "math": [ "u_hp('arm_r') = max( u_hp('arm_r'), 30)" ] },
      { "math": [ "u_hp('leg_l') = max( u_hp('leg_l'), 30)" ] },
      { "math": [ "u_hp('leg_r') = max( u_hp('leg_r'), 30)" ] },
      {
        "u_lose_effect": [
          "downed",
          "stunned",
          "corroding",
          "onfire",
          "dazed",
          "venom_blind",
          "formication",
          "blisters",
          "frostbite",
          "frostbite_recovery",
          "wet",
          "slimed",
          "migo_atmosphere",
          "fetid_goop",
          "sap",
          "nausea",
          "bleed"
        ]
      },
      { "math": [ "u_pain() = 0" ] },
      { "math": [ "u_vitamin('redcells') = 0" ] },
      { "math": [ "u_vitamin('blood') = 0" ] },
      { "math": [ "u_pain() = 0" ] },
      { "math": [ "u_val('rad') = 0" ] },
      { "u_location_variable": { "global_val": "last_breath_new_pos" }, "min_radius": 25, "max_radius": 30 },
      { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "2400" ] },
      { "u_add_effect": "last_breath_mist_cooldown", "duration": "168 hours" },
      { "u_teleport": { "global_val": "last_breath_new_pos" }, "force": true },
      {
        "u_message": "As you are about to die, your body instinctively turns to mist before reappearing nearby with some of its wounds closed.",
        "popup": true
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_MIST_FORM_TRAIT_activated",
    "//": "Ensure the trait properly activates when the ability triggers",
    "effect": { "u_activate_trait": "VAMPIRE_MIST_FORM" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_MIST_FORM_BEFORE_LAST_BREATH",
    "//": "Makes gaining last breath's mist without knowing mist form grants mist form instead.",
    "condition": { "and": [ { "u_has_trait": "VAMPIRE_LAST_BREATH_MIST" }, { "not": { "u_has_trait": "VAMPIRE_MIST_FORM" } } ] },
    "effect": [ { "u_lose_trait": "VAMPIRE_LAST_BREATH_MIST" }, { "u_add_trait": "VAMPIRE_MIST_FORM" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAMPIRE_BLIND_THE_SUN",
    "condition": { "math": [ "u_vitamin('human_blood_vitamin') >= 2000" ] },
    "effect": {
      "run_eocs": [
        {
          "id": "EOC_BLIND_THE_SUN_CHECK_FOR_STORM",
          "condition": { "or": [ { "is_weather": "portal_storm" }, { "is_weather": "early_portal_storm" } ] },
          "effect": [
            {
              "u_message": "You feel that the anomalous energies of the storm would do quick work of any darkness you could summon, so you decide to not attempt to blot out the sun for now.",
              "type": "bad"
            }
          ],
          "false_effect": [
            { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "3000" ] },
            {
              "math": [
                "sunless_time",
                "=",
                "rng(0.75,1.25) * (300 + (vampire_total_tier_one_traits() * 33) + (vampire_total_tier_two_traits() * 75) + (vampire_total_tier_three_traits() * 125) + (vampire_total_tier_four_traits_plus_potence() * 200) + (vampire_total_tier_five_traits() * 270))"
              ]
            },
            { "run_eocs": [ "EOC_BLOT_THE_SUN" ] },
            { "run_eocs": "EOC_UNBLOT_THE_SUN", "time_in_future": { "math": [ "sunless_time" ] } },
            {
              "u_message": "Using your mastery over the Shadowed Path, you blot out the sun, covering the region around you in darkness for a short period of time.",
              "type": "good"
            }
          ]
        }
      ]
    },
    "false_effect": [ { "u_message": "You don't have enough blood to blot out the sun.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_BLOT_THE_SUN",
    "effect": [ { "math": [ "blotted_sun = 1" ] }, "next_weather" ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_UNBLOT_THE_SUN",
    "effect": [
      { "math": [ "blotted_sun = 0" ] },
      "next_weather",
      { "u_message": "The darkness you summoned fades away, clearing the sky.", "type": "bad" }
    ]
  },
  {
    "id": "EOC_NEED_LIVING_BLOOD_GIVE_EFFECT",
    "type": "effect_on_condition",
    "condition": { "u_has_trait": "VAMPIRE_WEAKNESS_NEED_LIVING_BLOOD" },
    "deactivate_condition": { "not": { "u_has_trait": "VAMPIRE_WEAKNESS_NEED_LIVING_BLOOD" } },
    "recurrence": [ "5 days", "5 days" ],
    "effect": [
      {
        "u_add_effect": "vampire_need_living_blood",
        "intensity": { "math": [ "u_effect_intensity('vampire_need_living_blood') + 1" ] },
        "duration": "PERMANENT"
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_EARTH_SLEEP_CHECK",
    "//": "This allows the torpor EOC to run the check without needing an extra copy of the EOC.",
    "eoc_type": "EVENT",
    "required_event": "character_wakes_up",
    "effect": [ { "run_eocs": "EOC_EARTH_SLEEP_CHECK_REAL" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_EARTH_SLEEP_CHECK_REAL",
    "condition": {
      "or": [
        { "math": [ "u_val('pos_z') <= -1" ] },
        {
          "and": [
            {
              "or": [
                { "u_is_on_terrain_with_flag": "DIGGABLE" },
                { "u_is_on_terrain": "t_rock_floor" },
                { "u_is_on_terrain": "t_rock_floor_no_roof" }
              ]
            },
            { "not": { "u_is_on_terrain": "t_vitrified_sand" } },
            { "not": { "u_is_on_terrain": "t_pit_corpsed" } },
            { "not": { "u_is_on_terrain": "t_fungus" } },
            { "not": { "u_is_on_terrain": "t_glassed_sand" } },
            { "not": { "u_is_on_terrain": "t_rubber_mulch" } },
            { "not": { "u_is_on_terrain": "t_swater_surf" } },
            { "not": { "u_is_on_terrain": "t_woodchips" } }
          ]
        }
      ]
    },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_EARTH_SLEEP_CHECK_SATISFIED",
            "condition": { "u_has_trait": "VAMPIRE_WEAKNESS_EARTH_SLEEP" },
            "effect": [ { "u_message": "Your sleep has been restful, thanks to the proximity of the earth.", "type": "info" } ]
          }
        ]
      }
    ],
    "false_effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_EARTH_SLEEP_CHECK_PENALTY",
            "condition": { "u_has_trait": "VAMPIRE_WEAKNESS_EARTH_SLEEP" },
            "effect": [
              { "u_add_effect": "effect_earth_sleeper_penalty", "duration": "24 hours", "intensity": 1 },
              { "math": [ "u_val('sleepiness')", "+=", "550" ] },
              {
                "u_message": "You struggle to awaken, feeling tired and weakened.  Having slept away from the earth, your sleep wasn't as restful as it should've been.",
                "type": "bad"
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_HOLY_BURN_CHECK",
    "eoc_type": "EVENT",
    "required_event": "avatar_enters_omt",
    "condition": { "u_has_trait": "VAMPIRE_WEAKNESS_HOLY_BURN" },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_HOLY_BURN_CHECK_2",
            "condition": {
              "or": [
                { "u_near_om_location": "church_1", "range": 1 },
                { "u_near_om_location": "church_2ndfloor_1", "range": 1 },
                { "u_near_om_location": "church_3rdfloor_1", "range": 1 },
                { "u_near_om_location": "church_roof_1", "range": 1 },
                { "u_near_om_location": "rural_church_parking", "range": 1 },
                { "u_near_om_location": "rural_church", "range": 1 },
                { "u_near_om_location": "rural_church_basement", "range": 1 },
                { "u_near_om_location": "rural_church_steeple", "range": 1 },
                { "u_near_om_location": "rural_church_steeple_roof", "range": 1 },
                { "u_near_om_location": "cathedral_7_NW", "range": 1 },
                { "u_near_om_location": "cathedral_7_NE", "range": 1 },
                { "u_near_om_location": "cathedral_6_NW", "range": 1 },
                { "u_near_om_location": "cathedral_6_NE", "range": 1 },
                { "u_near_om_location": "cathedral_5_NW", "range": 1 },
                { "u_near_om_location": "cathedral_5_NE", "range": 1 },
                { "u_near_om_location": "cathedral_4_NW", "range": 1 },
                { "u_near_om_location": "cathedral_4_NE", "range": 1 },
                { "u_near_om_location": "cathedral_7_NW", "range": 1 },
                { "u_near_om_location": "cathedral_7_NE", "range": 1 },
                { "u_near_om_location": "cathedral_6_NW", "range": 1 },
                { "u_near_om_location": "cathedral_6_NE", "range": 1 },
                { "u_near_om_location": "cathedral_5_NW", "range": 1 },
                { "u_near_om_location": "cathedral_5_NE", "range": 1 },
                { "u_near_om_location": "cathedral_4_NW", "range": 1 },
                { "u_near_om_location": "cathedral_4_NE", "range": 1 },
                { "u_near_om_location": "cathedral_3_NW", "range": 1 },
                { "u_near_om_location": "cathedral_3_NE", "range": 1 },
                { "u_near_om_location": "cathedral_3_SW", "range": 1 },
                { "u_near_om_location": "cathedral_3_SE", "range": 1 },
                { "u_near_om_location": "cathedral_2_NW", "range": 1 },
                { "u_near_om_location": "cathedral_2_NE", "range": 1 },
                { "u_near_om_location": "cathedral_2_SW", "range": 1 },
                { "u_near_om_location": "cathedral_2_SE", "range": 1 },
                { "u_near_om_location": "cathedral_1_NW", "range": 1 },
                { "u_near_om_location": "cathedral_1_NE", "range": 1 },
                { "u_near_om_location": "cathedral_1_SW", "range": 1 },
                { "u_near_om_location": "cathedral_1_SE", "range": 1 },
                { "u_near_om_location": "cathedral_b_NW", "range": 1 },
                { "u_near_om_location": "cathedral_b_NE", "range": 1 },
                { "u_near_om_location": "cathedral_b_SW", "range": 1 },
                { "u_near_om_location": "cathedral_b_SE", "range": 1 },
                { "u_near_om_location": "synagogue", "range": 1 },
                { "u_near_om_location": "synagogue_roof", "range": 1 },
                { "u_near_om_location": "synagogue_upper_roof", "range": 1 }
              ]
            },
            "effect": [
              { "u_add_effect": "effect_holy_place_burn", "duration": 100, "target_part": "arm_l" },
              { "u_add_effect": "effect_holy_place_burn", "duration": 100, "target_part": "arm_r" },
              { "u_add_effect": "effect_holy_place_burn", "duration": 100, "target_part": "leg_l" },
              { "u_add_effect": "effect_holy_place_burn", "duration": 100, "target_part": "leg_r" },
              { "u_add_effect": "effect_holy_place_burn", "duration": 100, "target_part": "torso" },
              { "u_add_effect": "effect_holy_place_burn", "duration": 100, "target_part": "head" },
              {
                "u_message": "You are too close to a holy place!  You must flee its proximity immediately or you will die!",
                "type": "bad"
              }
            ],
            "false_effect": [
              {
                "run_eocs": [
                  {
                    "id": "EOC_HOLY_BURN_CHECK_REMOVE",
                    "condition": {
                      "or": [
                        { "math": [ "u_effect_intensity('effect_holy_place_burn', 'bodypart': 'arm_l') >= 1" ] },
                        { "math": [ "u_effect_intensity('effect_holy_place_burn', 'bodypart': 'arm_r') >= 1" ] },
                        { "math": [ "u_effect_intensity('effect_holy_place_burn', 'bodypart': 'leg_l') >= 1" ] },
                        { "math": [ "u_effect_intensity('effect_holy_place_burn', 'bodypart': 'leg_r') >= 1" ] },
                        { "math": [ "u_effect_intensity('effect_holy_place_burn', 'bodypart': 'torso') >= 1" ] },
                        { "math": [ "u_effect_intensity('effect_holy_place_burn', 'bodypart': 'head') >= 1" ] }
                      ]
                    },
                    "effect": [
                      { "u_lose_effect": "effect_holy_place_burn", "target_part": "arm_l" },
                      { "u_lose_effect": "effect_holy_place_burn", "target_part": "arm_r" },
                      { "u_lose_effect": "effect_holy_place_burn", "target_part": "leg_l" },
                      { "u_lose_effect": "effect_holy_place_burn", "target_part": "leg_r" },
                      { "u_lose_effect": "effect_holy_place_burn", "target_part": "torso" },
                      { "u_lose_effect": "effect_holy_place_burn", "target_part": "head" },
                      {
                        "u_message": "You are now far enough from the holy place.  You no longer feel like you're burning up.",
                        "type": "good"
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_VAST_WATER_BURN_CHECK",
    "eoc_type": "EVENT",
    "required_event": "avatar_enters_omt",
    "condition": { "u_has_trait": "VAMPIRE_WEAKNESS_VAST_WATER_BURN" },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_VAST_WATER_BURN_CHECK_2",
            "condition": {
              "or": [
                { "u_near_om_location": "generic_river_bank", "range": 1 },
                { "u_near_om_location": "generic_river", "range": 1 },
                { "u_near_om_location": "river_center", "range": 1 },
                { "u_near_om_location": "river", "range": 1 },
                { "u_near_om_location": "river_c_not_ne", "range": 1 },
                { "u_near_om_location": "river_c_not_nw", "range": 1 },
                { "u_near_om_location": "river_c_not_se", "range": 1 },
                { "u_near_om_location": "river_c_not_sw", "range": 1 },
                { "u_near_om_location": "lake_shore", "range": 1 },
                { "u_near_om_location": "lake_surface", "range": 1 },
                { "u_near_om_location": "ocean", "range": 1 },
                { "u_near_om_location": "ocean_shore", "range": 1 },
                { "u_near_om_location": "ocean_surface", "range": 1 },
                { "u_near_om_location": "ocean_bed", "range": 1 },
                { "u_near_om_location": "ocean_water_cube", "range": 1 },
                { "u_near_om_location": "ocean_surface", "range": 1 }
              ]
            },
            "effect": [
              { "u_add_effect": "effect_vast_water_burn", "duration": 100, "target_part": "arm_l" },
              { "u_add_effect": "effect_vast_water_burn", "duration": 100, "target_part": "arm_r" },
              { "u_add_effect": "effect_vast_water_burn", "duration": 100, "target_part": "leg_l" },
              { "u_add_effect": "effect_vast_water_burn", "duration": 100, "target_part": "leg_r" },
              { "u_add_effect": "effect_vast_water_burn", "duration": 100, "target_part": "torso" },
              { "u_add_effect": "effect_vast_water_burn", "duration": 100, "target_part": "head" },
              {
                "u_message": "You are too close to a vast body of water!  You must flee its proximity immediately or you will die!",
                "type": "bad"
              }
            ],
            "false_effect": [
              {
                "run_eocs": [
                  {
                    "id": "EOC_VAST_WATER_CHECK_REMOVE",
                    "condition": {
                      "or": [
                        { "math": [ "u_effect_intensity('effect_vast_water_burn', 'bodypart': 'arm_l') >= 1" ] },
                        { "math": [ "u_effect_intensity('effect_vast_water_burn', 'bodypart': 'arm_r') >= 1" ] },
                        { "math": [ "u_effect_intensity('effect_vast_water_burn', 'bodypart': 'leg_l') >= 1" ] },
                        { "math": [ "u_effect_intensity('effect_vast_water_burn', 'bodypart': 'leg_r') >= 1" ] },
                        { "math": [ "u_effect_intensity('effect_vast_water_burn', 'bodypart': 'torso') >= 1" ] },
                        { "math": [ "u_effect_intensity('effect_vast_water_burn', 'bodypart': 'head') >= 1" ] }
                      ]
                    },
                    "effect": [
                      { "u_lose_effect": "effect_vast_water_burn", "target_part": "arm_l" },
                      { "u_lose_effect": "effect_vast_water_burn", "target_part": "arm_r" },
                      { "u_lose_effect": "effect_vast_water_burn", "target_part": "leg_l" },
                      { "u_lose_effect": "effect_vast_water_burn", "target_part": "leg_r" },
                      { "u_lose_effect": "effect_vast_water_burn", "target_part": "torso" },
                      { "u_lose_effect": "effect_vast_water_burn", "target_part": "head" },
                      {
                        "u_message": "You are now far enough from the vast water.  You no longer feel like you're melting.",
                        "type": "good"
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_BLOOD_CRAVING_START",
    "recurrence": [ "10 hours", "16 hours" ],
    "condition": {
      "and": [ { "u_has_trait": "VAMPIRE_WEAKNESS_BLOOD_CRAVING" }, { "not": { "u_has_effect": "effect_drank_blood_recently" } } ]
    },
    "effect": [
      { "run_eocs": "EOC_BLOOD_CRAVING_CAUSE", "time_in_future": [ "3 minutes", "6 minutes" ] },
      {
        "u_message": "You feel a growing craving for blood.  If you do not drink blood soon, the craving will grow unbearable for a short time.",
        "type": "bad"
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_BLOOD_CRAVING_CAUSE",
    "condition": {
      "and": [ { "u_has_trait": "VAMPIRE_WEAKNESS_BLOOD_CRAVING" }, { "not": { "u_has_effect": "effect_drank_blood_recently" } } ]
    },
    "effect": [ { "u_add_effect": "blood_craving", "intensity": 1, "duration": { "math": [ "400 + rand(600)" ] } } ]
  }
]
