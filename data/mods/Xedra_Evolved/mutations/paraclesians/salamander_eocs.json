[
  {
    "type": "effect_on_condition",
    "id": "EOC_SALAMANDER_REMOVE_STUN",
    "effect": [ { "u_add_effect": "effect_salamander_remove_stun", "duration": 5 } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SALAMANDER_GOBLIN_FRUIT",
    "//": "I don't believe EoCs can detect if there is a fire nearby--once they can, that should be added in rather than detecting heat fields.",
    "condition": {
      "or": [
        { "u_has_item": "torch_lit" },
        { "u_has_item": "candle_lit" },
        { "u_has_item": "oil_lamp_on" },
        { "u_has_item": "oil_lamp_clay_on" },
        { "u_has_item": "cigar_lit" },
        { "u_has_item": "cig_lit" },
        { "u_is_in_field": "fd_hot_air1" },
        { "u_is_in_field": "fd_hot_air2" },
        { "u_is_in_field": "fd_hot_air3" },
        { "u_is_in_field": "fd_hot_air4" },
        { "u_is_in_field": "fd_fire" }
      ]
    },
    "effect": [ { "u_cast_spell": { "id": "cultivate_goblin_fruit_real" } } ],
    "false_effect": [ { "u_message": "You must have a source of flames or heat to call forth a goblin fruit.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SALAMANDER_FIRE_FLY",
    "condition": { "u_is_in_field": "fd_fire" },
    "effect": [
      {
        "u_add_effect": "effect_salamander_levitation",
        "duration": { "math": [ "( 12 + (u_val('spell_level', 'spell: salamander_fire_fly') * rng(2,4) )) " ] }
      },
      {
        "u_add_effect": "effect_salamander_featherfall",
        "duration": { "math": [ "( 15 + (u_val('spell_level', 'spell: salamander_fire_fly') * 4 )) " ] }
      },
      { "u_cast_spell": { "id": "salamander_fire_fly_real" }, "targeted": true }
    ],
    "false_effect": [ { "u_message": "You must be standing in flames to cast Burning Ascension.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SALAMANDER_WATER_TO_BOOZE",
    "condition": { "u_has_trait": "SALAMANDER_WATER_TO_BOOZE" },
    "effect": [ { "u_learn_recipe": "mixed_alcohol_strong_from_water" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SALAMANDER_REBORN_IN_FLAMES",
    "eoc_type": "PREVENT_DEATH",
    "condition": {
      "and": [
        { "u_has_trait": "SALAMANDER_PREVENT_DEATH" },
        { "u_is_in_field": "fd_fire" },
        { "not": { "u_has_effect": "effect_salamander_prevented_death" } }
      ]
    },
    "effect": [
      {
        "u_message": "As your body takes its final wound, your fae spirit drinks in the heat of the flames and your flesh is renewed.",
        "popup": true
      },
      { "run_eocs": [ "EOC_PERENNIAL_REBIRTH_HEAL" ] },
      { "u_add_effect": "effect_salamander_prevented_death", "duration": 1209600 },
      { "math": [ "u_val('stored_kcal')", "+=", "40000" ] }
    ],
    "false_effect": {
      "run_eocs": [
        {
          "id": "EOC_SALAMANDER_REBORN_IN_FLAMES_COOLDOWN",
          "condition": {
            "and": [
              { "u_has_trait": "SALAMANDER_PREVENT_DEATH" },
              { "u_is_in_field": "fd_fire" },
              { "u_has_effect": "effect_salamander_prevented_death" },
              { "x_in_y_chance": { "x": 1, "y": 7 } }
            ]
          },
          "effect": [
            {
              "u_message": "As your body takes its final wound, your fae spirit drinks in the heat of the flames and your flesh is renewed.",
              "popup": true
            },
            { "run_eocs": [ "EOC_PERENNIAL_REBIRTH_HEAL" ] },
            { "math": [ "u_val('stored_kcal')", "+=", "40000" ] }
          ]
        }
      ]
    }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SALAMANDER_NO_SLEEP",
    "effect": [ { "math": [ "u_val('fatigue')", "=", "0" ] }, { "math": [ "u_val('sleep_deprivation')", "=", "0" ] } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SALAMANDER_FIRE_FOOSTEPS",
    "condition": { "math": [ "u_val('mana')", ">=", "5" ] },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "5" ] },
      {
        "u_transform_radius": 0,
        "target_var": { "global_val": "salamander_fire_footsteps_location" },
        "ter_furn_transform": "ter_salamander_fire_drop"
      },
      { "u_location_variable": { "global_val": "salamander_fire_footsteps_location" }, "outdoor_only": false }
    ],
    "false_effect": [ { "u_message": "You do not have enough mana to fuel your searing footsteps!", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SALAMANDER_SMOKE_FORM_ON",
    "effect": [
      { "u_add_effect": "effect_salamander_smoke_form", "duration": "PERMANENT" },
      { "u_add_trait": "SALAMANDER_SMOKE_FORM_ASCEND" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SALAMANDER_SMOKE_FORM_OFF",
    "effect": [
      { "u_lose_effect": "effect_salamander_smoke_form" },
      { "u_lose_trait": "SALAMANDER_SMOKE_FORM_ASCEND" },
      { "u_add_effect": "effect_salamander_smoke_immunity", "duration": "15 s" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SALAMANDER_SMOKE_FORM_ASCEND",
    "condition": {
      "or": [
        { "u_is_in_field": "fd_hot_air1" },
        { "u_is_in_field": "fd_hot_air2" },
        { "u_is_in_field": "fd_hot_air3" },
        { "u_is_in_field": "fd_hot_air4" },
        { "u_is_in_field": "fd_fire" },
        { "u_is_in_field": "fd_salamander_heat" }
      ]
    },
    "effect": [ { "run_eocs": [ "EOC_SALAMANDER_SMOKE_FORM_ASCEND_OUTSIDE_CHECK" ] } ],
    "false_effect": [ { "u_message": "You must be in warm air to ascend!", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SALAMANDER_SMOKE_FORM_ASCEND_OUTSIDE_CHECK",
    "condition": "u_is_outside",
    "effect": [
      { "u_location_variable": { "u_val": "salamander_smoke_form_ascend" }, "z_adjust": 2, "outdoor_only": true },
      { "u_message": "You soar upward on the rising smoke", "type": "good" },
      { "u_teleport": { "u_val": "salamander_smoke_form_ascend" } }
    ],
    "false_effect": [ { "u_message": "The ceiling above blocks your attempt to rise!", "type": "bad" } ]
  },
  {
    "id": "salamander_quell_flames",
    "type": "SPELL",
    "name": "Quell Fire",
    "description": "As you can create fire, you can also extinguish it.",
    "message": "You disperse the flames harmlessly.",
    "teachable": false,
    "valid_targets": [ "ground" ],
    "skill": "metaphysics",
    "flags": [ "CONCENTRATE", "SILENT", "NO_HANDS", "NO_LEGS", "IGNORE_WALLS", "NO_EXPLOSION_SFX" ],
    "effect": "ter_transform",
    "effect_str": "ter_salamander_fire_drop",
    "shape": "blast",
    "difficulty": 3,
    "max_level": { "math": [ "int_to_level(1)" ] },
    "min_range": {
      "math": [ "( (u_val('spell_level', 'spell: salamander_quell_flames') * 0.8) + 5) * (scaling_factor(u_val('intelligence') ) )" ]
    },
    "max_range": 70,
    "min_aoe": {
      "math": [ "( (u_val('spell_level', 'spell: salamander_quell_flames') * 0.5) + 1) * (scaling_factor(u_val('intelligence') ) )" ]
    },
    "max_aoe": 50,
    "energy_source": "STAMINA",
    "base_energy_cost": 2000,
    "final_energy_cost": 500,
    "energy_increment": -150,
    "base_casting_time": 125,
    "final_casting_time": 50,
    "casting_time_increment": -7.5
  }
]
