[
  {
    "type": "recipe",
    "activity_level": "NO_EXERCISE",
    "result": "blood_treatment",
    "qualities": [
      { "id": "CONCENTRATE", "level": 1 },
      { "id": "CONTAIN", "level": 1 },
      { "id": "CHEM", "level": 1 },
      { "id": "SAW_M", "level": 1 }
    ],
    "tools": [ [ [ "surface_heat", 30, "LIST" ] ] ],
    "components": [ [ [ "mercury", 1 ] ], [ [ "garlic_clove", 4 ] ], [ [ "blood", 3 ] ], [ [ "silver_small", 1 ] ] ],
    "time": "30 m",
    "charges": 4,
    "skill_used": "cooking",
    "batch_time_factors": [ 65, 4 ],
    "difficulty": 2,
    "flags": [ "SECRET" ],
    "skills_required": [ "cooking", 2 ],
    "book_learn": [ [ "grimy_recipe", 1 ] ],
    "category": "CC_CHEM",
    "subcategory": "CSC_CHEM_DRUGS"
  },
  {
    "type": "recipe",
    "activity_level": "LIGHT_EXERCISE",
    "name": "research blood gifts",
    "id": "xe_vampire_blood_gift_research",
    "description": "With the expenditure of a large amount of blood and time, attempt to develop a new gift of the blood.",
    "category": "CC_XEDRA",
    "subcategory": "CSC_XEDRA_RESEARCH",
    "skill_used": "deduction",
    "difficulty": 0,
    "time": "30 s",
    "autolearn": false,
    "flags": [ "SECRET", "BLIND_EASY", "NO_MANIP", "AFFECTED_BY_PAIN", "NO_BENCH", "NO_ENCHANTMENT" ],
    "result_eocs": [
      {
        "id": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_BEGIN",
        "condition": { "math": [ "u_vitamin('human_blood_vitamin')", ">=", "500" ] },
        "effect": [
          { "math": [ "u_vitamin('human_blood_vitamin')", "-=", "3000" ] },
          { "u_add_effect": "effect_vampire_studying_blood_gifts", "duration": "8 hours" },
          { "u_assign_activity": "ACT_VAMPIRE_STUDYING_BLOOD_GIFTS", "duration": "8 hours" },
          {
            "queue_eocs": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_SWITCHER",
            "time_in_future": [ "120 minutes", "180 minutes" ]
          }
        ],
        "false_effect": [ { "u_message": "You do not have enough blood to experiment with your gifts.", "type": "bad" } ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_SWITCHER",
    "condition": {
      "and": [
        { "u_has_effect": "effect_vampire_studying_blood_gifts" },
        { "not": { "u_has_effect": "effect_vampire_recently_learned_blood_gifts" } }
      ]
    },
    "//": "Switch statement below determines results.  The two rands on the end simulate rolling 2d10 to get a bell-curve distribution, and the cases are calibrated so a character with Deduction 2 and Intelligence 8 will fail to discover anything slightly more than half the time.  There are five tiers of vampire powers, so each tier is 3 higher (~30% less likely) than the previous tier, but since it's a bell curve, raising deduction and intelligence makes it increasingly much more likely to discover things.  With Deduction 10 and Intelligence 12, hitting case 17 will happen 100% of the time, case 23 will happen 85% of the time, and case 26 will happen 64% of the time.",
    "effect": {
      "switch": { "math": [ "(u_val('intelligence') / 2) + u_skill('deduction') + (rand(9) + 1) + (rand(9) + 1)" ] },
      "cases": [
        {
          "case": 0,
          "effect": [ { "queue_eocs": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_SWITCHER", "time_in_future": [ "90 minutes", "150 minutes" ] } ]
        },
        { "case": 17, "effect": [ { "run_eocs": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_RESULTS_01" } ] },
        { "case": 20, "effect": [ { "run_eocs": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_RESULTS_02" } ] },
        { "case": 23, "effect": [ { "run_eocs": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_RESULTS_03" } ] },
        { "case": 26, "effect": [ { "run_eocs": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_RESULTS_04" } ] },
        { "case": 29, "effect": [ { "run_eocs": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_RESULTS_05" } ] }
      ]
    }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_RESULTS_01",
    "//": "This should contain all tier 1 vampire powers",
    "condition": { "u_has_effect": "effect_vampire_studying_blood_gifts" },
    "effect": [
      { "u_lose_effect": "effect_vampire_studying_blood_gifts" },
      {
        "u_roll_remainder": [
          "EYEGLEAM",
          "BLOOD_FUN",
          "STAMINAFORBLOOD",
          "COMMUNE_NIGHT",
          "VAMPIRIC_STRENGTH",
          "VAMPIRIC_RESILIENCE",
          "VAMPIRE_HEIGHTENED_SENSES",
          "VAMPIRE_SILENT_MOVE"
        ],
        "type": "mutation",
        "true_eocs": [ "EOC_XE_VAMPIRE_BLOOD_RESEARCH_SUCCESS" ],
        "false_eocs": [ "EOC_XE_VAMPIRE_BLOOD_RESEARCH_FAILURE" ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_RESULTS_02",
    "//": "This should contain all tier 2 vampire powers",
    "condition": { "u_has_effect": "effect_vampire_studying_blood_gifts" },
    "effect": [
      { "u_lose_effect": "effect_vampire_studying_blood_gifts" },
      {
        "u_roll_remainder": [
          "BLOODHEAL",
          "COAGULANTWEAVE",
          "VAMPIRIC_DODGE",
          "VAMPIRE_FEAR_GAZE",
          "VAMPIRE_WALK_ON_WALLS",
          "VAMPIRE_BEAST_CLAWS",
          "VAMPIRE_SEE_HEAT"
        ],
        "type": "mutation",
        "true_eocs": [ "EOC_XE_VAMPIRE_BLOOD_RESEARCH_SUCCESS" ],
        "false_eocs": [ "EOC_XE_VAMPIRE_BLOOD_RESEARCH_RESULTS_01" ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_RESULTS_03",
    "//": "This should contain all tier 3 vampire powers",
    "condition": { "u_has_effect": "effect_vampire_studying_blood_gifts" },
    "effect": [
      { "u_lose_effect": "effect_vampire_studying_blood_gifts" },
      {
        "u_roll_remainder": [ "BLOODHASTE", "MAGICFORBLOOD", "HYPNOTIC_GAZE", "BLOODBANK", "VAMPIRE_COMMAND_BEAST", "VAMPIRE_EARTH_SLUMBER" ],
        "type": "mutation",
        "true_eocs": [ "EOC_XE_VAMPIRE_BLOOD_RESEARCH_SUCCESS" ],
        "false_eocs": [ "EOC_XE_VAMPIRE_BLOOD_RESEARCH_RESULTS_02" ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_RESULTS_04",
    "//": "This should contain all tier 4 vampire powers",
    "condition": { "u_has_effect": "effect_vampire_studying_blood_gifts" },
    "effect": [
      { "u_lose_effect": "effect_vampire_studying_blood_gifts" },
      {
        "u_roll_remainder": [
          "TRUE_VAMPIRE_POWER",
          "VAMPIRE_TORPOR",
          "VAMPIRE_DOMINATE",
          "VAMPIRE_NO_BREATHE",
          "VAMPIRE_NO_ILLNESS",
          "VAMPIRE_BAT_FORM",
          "VAMPIRE_WOLF_FORM",
          "VAMPIRE_MIST_FORM"
        ],
        "type": "mutation",
        "true_eocs": [ "EOC_XE_VAMPIRE_BLOOD_RESEARCH_SUCCESS" ],
        "false_eocs": [ "EOC_XE_VAMPIRE_BLOOD_RESEARCH_RESULTS_03" ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_RESULTS_05",
    "//": "This should contain all tier 5 vampire powers",
    "condition": { "u_has_effect": "effect_vampire_studying_blood_gifts" },
    "effect": [
      { "u_lose_effect": "effect_vampire_studying_blood_gifts" },
      {
        "u_roll_remainder": [ "VAMPIRE4" ],
        "type": "mutation",
        "true_eocs": [ "EOC_XE_VAMPIRE_BLOOD_RESEARCH_SUCCESS" ],
        "false_eocs": [ "EOC_XE_VAMPIRE_BLOOD_RESEARCH_RESULTS_04" ]
      }
    ]
  },
  {
    "id": "ACT_VAMPIRE_STUDYING_BLOOD_GIFTS",
    "type": "activity_type",
    "activity_level": "LIGHT_EXERCISE",
    "verb": "studying blood gifts",
    "based_on": "time",
    "completion_eoc": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_FAILURE"
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_SUCCESS",
    "effect": [
      { "u_message": "You learn a new blood gift.", "popup": true },
      { "u_add_effect": "effect_vampire_recently_learned_blood_gifts", "duration": "5 days" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_XE_VAMPIRE_BLOOD_RESEARCH_FAILURE",
    "effect": [ { "u_message": "Your experiments are fruitless.  You'll have to try again." } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_XE_VAMPIRE_BLOOD_GIFTS_CANCELLING_ACTIVITY_CANCELS_RESEARCH",
    "eoc_type": "EVENT",
    "required_event": "character_finished_activity",
    "condition": {
      "and": [
        { "compare_string": [ "ACT_VAMPIRE_STUDYING_BLOOD_GIFTS", { "context_val": "activity" } ] },
        { "u_has_effect": "effect_vampire_studying_blood_gifts" }
      ]
    },
    "effect": [ { "u_lose_effect": "effect_vampire_studying_blood_gifts" } ]
  }
]
