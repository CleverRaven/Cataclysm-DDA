[
  {
    "type": "effect_on_condition",
    "id": "EOC_CONDITION_ESPER_TRAIT_AND_SCHOOL_LIST",
    "condition": {
      "and": [ { "u_has_trait": "ESPER" }, { "or": [ { "compare_string": [ "AFS_TELEPATH", { "context_val": "school" } ] } ] } ]
    },
    "effect": [  ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ESPER_CONSEQUENCES_VALUE_INCREASER",
    "eoc_type": "EVENT",
    "required_event": "spellcasting_finish",
    "condition": { "test_eoc": "EOC_CONDITION_ESPER_TRAIT_AND_SCHOOL_LIST" },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "EOC_ESPER_CONSEQUENCES_VALUE_INCREASER_2",
            "condition": { "math": [ "u_esper_repeated_channeling_value", "<", "20" ] },
            "effect": [ { "math": [ "u_esper_repeated_channeling_value", "+=", "rng(1,5)" ] } ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ESPER_CONSEQUENCES_VALUE_DECREASER",
    "recurrence": [ "3 seconds", "30 seconds" ],
    "global": true,
    "run_for_npcs": true,
    "condition": { "math": [ "u_esper_repeated_channeling_value", ">", "0" ] },
    "effect": [ { "math": [ "u_esper_repeated_channeling_value", "-=", "1" ] } ],
    "false_effect": [ { "math": [ "u_esper_repeated_channeling_value", "=", "0" ] } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_AFS_POWER_MAINTENANCE_PLUS_ONE",
    "effect": [ { "math": [ "u_vitamin('vitamin_afs_maintained_powers')", "+=", "1" ] } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_AFS_POWER_MAINTENANCE_MINUS_ONE",
    "effect": [ { "math": [ "u_vitamin('vitamin_afs_maintained_powers')", "-=", "1" ] } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_AFS_END_PSI_POWERS_MAINTAINED",
    "effect": [
      {
        "run_eocs": [
          "EOC_AFS_TELEPATH_REMOVE_TELEPATHIC_SHIELD",
          "EOC_AFS_TELEPATH_REMOVE_SENSE_MINDS",
          "EOC_AFS_TELEPATH_REMOVE_TELEPATHIC_SUGGESTION"
        ]
      },
      { "math": [ "u_vitamin('vitamin_afs_maintained_powers')", "=", "0" ] }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CONCENTRATION_SUCCESS_PROFICIENCY",
    "condition": {
      "and": [
        { "not": { "u_has_proficiency": "prof_concentration_basic" } },
        { "math": [ "u_vitamin('vitamin_maintained_powers')", ">", "0" ] }
      ]
    },
    "effect": [ { "math": [ "u_proficiency('prof_concentration_basic', 'format': 'percent')", "+=", "rand(4) / 24" ] } ],
    "//": "adds 0% - 0.16% experience per run",
    "false_effect": {
      "run_eocs": [
        {
          "id": "EOC_CONCENTRATION_SUCCESS_PROFICIENCY_INT",
          "condition": {
            "and": [
              { "not": { "u_has_proficiency": "prof_concentration_intermediate" } },
              { "math": [ "u_vitamin('vitamin_maintained_powers')", ">", "0" ] }
            ]
          },
          "effect": [ { "math": [ "u_proficiency('prof_concentration_intermediate', 'format': 'percent')", "+=", "rand(4) / 48" ] } ],
          "false_effect": {
            "run_eocs": [
              {
                "id": "EOC_CONCENTRATION_SUCCESS_PROFICIENCY_MASTER",
                "condition": {
                  "and": [
                    { "not": { "u_has_proficiency": "prof_concentration_master" } },
                    { "math": [ "u_vitamin('vitamin_maintained_powers')", ">", "0" ] }
                  ]
                },
                "effect": [ { "math": [ "u_proficiency('prof_concentration_master', 'format': 'percent')", "+=", "rand(4) / 96" ] } ]
              }
            ]
          }
        }
      ]
    }
  }
]
