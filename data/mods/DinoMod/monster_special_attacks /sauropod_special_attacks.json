[
  {
    "id": "sauropod_control",
    "type": "SPELL",
    "name": { "str": "Sauropod control", "//~": "NO_I18N" },
    "description": { "str": "Sauropods control themselves using this one.", "//~": "NO_I18N" },
    "valid_targets": [ "self" ],
    "flags": [ "SILENT", "NO_EXPLOSION_SFX" ],
    "shape": "blast",
    "min_range": 1,
    "max_range": 1,
    "message": "",
    "effect": "effect_on_condition",
    "effect_str": "EOC_SAUROPOD_CONTROL"
  },
  {
    "type": "SPELL",
    "id": "sauropod_hurt_self",
    "name": { "str": "Wretch Hurt Self", "//~": "NO_I18N" },
    "description": { "str": "Hurts yourself.", "//~": "NO_I18N" },
    "flags": [ "RANDOM_DAMAGE", "NO_PROJECTILE", "NO_EXPLOSION_SFX" ],
    "min_damage": 1200,
    "max_damage": 1500,
    "damage_type": "pure",
    "valid_targets": [ "hostile", "ally", "self", "ground" ],
    "shape": "blast",
    "effect": "attack"
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_SAUROPOD_CONTROL",
    "effect": [
      {
        "run_eocs": [
          {
            "id": "eoc_start_update_sauropod_walkers",
            "condition": { "math": [ "updating_sauropods != 1" ] },
            "effect": [ { "run_eocs": "eoc_update_sauropod_walkers" } ]
          },
          {
            "id": "sauropod_setup",
            "condition": { "math": [ "u_setup != 1" ] },
            "effect": [
              {
                "run_eocs": [
                  {
                    "id": "avatar_sees_sauropod_setup",
                    "condition": "player_see_u",
                    "effect": [ { "message": "You see the sauropod." } ]
                  }
                ]
              },
              { "math": [ "_sauropod_uid = rand(1200)" ] },
              { "math": [ "u_sauropod_uid = _quad_uid" ] },
              { "math": [ "u_setup = 1" ] },
              { "u_spawn_monster": "mon_sauropod_leg", "real_count": 4, "min_radius": 1, "max_radius": 1 },
              {
                "u_run_monster_eocs": [ { "id": "sauropod_leg_assign", "effect": [ { "math": [ "u_quad_id = _quad_uid" ] } ] } ],
                "monster_range": 2,
                "mtype_ids": [ "mon_sauropod_leg" ]
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "id": "eoc_update_sauropod_walkers",
    "type": "effect_on_condition",
    "global": true,
    "condition": { "math": [ "u_monsters_nearby('mon_apatosaurus', 'radius': 3) >= 1" ] },
    "effect": [
      { "math": [ "updating_sauropods = 1" ] },
      { "run_eocs": "eoc_update_sauropod_walkers", "time_in_future": 1 },
      {
        "u_run_monster_eocs": [ "eoc_sauropod_walker" ],
        "monster_range": 3,
        "mtype_ids": [ "mon_apatosaurus", "mon_brontosaurus", "mon_diplodocus" ]
      }
    ],
    "false_effect": [ { "math": [ "updating_sauropods = 0" ] } ]
  },
  {
    "id": "eoc_sauropod_walker",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "_quad_uid = u_quad_uid" ] },
      { "u_location_variable": { "context_val": "quad_pos_1" }, "x_adjust": 1 },
      { "u_location_variable": { "context_val": "quad_pos_2" }, "x_adjust": -1 },
      { "u_location_variable": { "context_val": "quad_pos_3" }, "y_adjust": 1 },
      { "u_location_variable": { "context_val": "quad_pos_4" }, "y_adjust": -1 },
      {
        "u_run_monster_eocs": [
          {
            "id": "sauropod_leg_tp",
            "condition": { "math": [ "u_quad_id == _quad_uid" ] },
            "effect": [
              { "u_teleport": { "context_val": "quad_pos_1" } },
              { "u_teleport": { "context_val": "quad_pos_2" } },
              { "u_teleport": { "context_val": "quad_pos_3" } },
              { "u_teleport": { "context_val": "quad_pos_4" } }
            ]
          }
        ],
        "monster_range": 3,
        "mtype_ids": [ "mon_sauropod_leg" ]
      }
    ]
  },
  {
    "id": "EOC_SAUROPOD_HURT",
    "type": "effect_on_condition",
    "global": true,
    "effect": [
      { "math": [ "_uid = n_quad_id" ] },
      {
        "u_run_monster_eocs": [
          {
            "id": "sauropod_leg_hurt",
            "condition": { "math": [ "u_quad_uid == _uid" ] },
            "effect": [ { "u_cast_spell": { "id": "sauropod_hurt_self" } } ]
          }
        ],
        "monster_range": 3,
        "mtype_ids": [ "mon_apatosaurus", "mon_brontosaurus", "mon_diplodocus" ]
      }
    ]
  },
  {
    "id": "EOC_SAUROPOD_DIES",
    "type": "effect_on_condition",
    "global": true,
    "effect": [
      { "math": [ "_uid = n_quad_uid" ] },
      {
        "u_run_monster_eocs": [
          {
            "id": "sauropod_leg_dies",
            "condition": { "math": [ "u_quad_id == _uid" ] },
            "effect": [ { "u_cast_spell": { "id": "sauropod_hurt_self" } } ]
          }
        ],
        "monster_range": 3,
        "mtype_ids": [ "mon_sauropod_leg" ]
      }
    ]
  }
]
