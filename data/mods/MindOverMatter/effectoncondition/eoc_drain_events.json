[
  {
    "type": "effect_on_condition",
    "id": "EOC_PSIONICS_DRAIN_EVENTS",
    "eoc_type": "EVENT",
    "required_event": "spellcasting_finish",
    "condition": {
      "and": [
        {
          "u_has_any_trait": [ "BIOKINETIC", "CLAIRSENTIENT", "PHOTOKINETIC", "PYROKINETIC", "TELEKINETIC", "TELEPATH", "TELEPORTER", "VITAKINETIC" ]
        },
        {
          "or": [
            { "compare_string": [ "BIOKINETIC", { "context_val": "school" } ] },
            { "compare_string": [ "CLAIRSENTIENT", { "context_val": "school" } ] },
            { "compare_string": [ "PHOTOKINETIC", { "context_val": "school" } ] },
            { "compare_string": [ "PYROKINETIC", { "context_val": "school" } ] },
            { "compare_string": [ "TELEKINETIC", { "context_val": "school" } ] },
            { "compare_string": [ "TELEPATH", { "context_val": "school" } ] },
            { "compare_string": [ "TELEPORTER", { "context_val": "school" } ] },
            { "compare_string": [ "VITAKINETIC", { "context_val": "school" } ] }
          ]
        },
        { "math": [ "u_val('vitamin', 'name:vitamin_psionic_drain')", ">=", "15" ] }
      ]
    },
    "effect": [ 
      { 
        "run_eocs": [ 
          "EOC_DRAIN_EFFECT_CHECK_HEADACHE",
          "EOC_DRAIN_EFFECT_CHECK_EXTRA_DRAIN",
          "EOC_DRAIN_EFFECT_CHECK_NOSEBLEED",
          "EOC_DRAIN_EFFECT_CHECK_STAMINA_LOSS",
          "EOC_DRAIN_EFFECT_CHECK_FATIGUE",
          "EOC_DRAIN_EFFECT_CHECK_WEAKNESS"          
        ] 
      } 
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_DRAIN_EFFECT_CHECK_HEADACHE",
    "condition": { 
      "and": [ 
        { "math": [ "u_val('vitamin', 'name:vitamin_psionic_drain')", ">=", "15" ] },  
        {
          "x_in_y_chance": {
            "x": {
              "math": [
                "( (u_val('vitamin', 'name:vitamin_psionic_drain') * 2 ) + 30)"
              ]
            },
            "y": 1000
          }
        } 
      ] 
    },
    "effect": [
      { "u_message": "As you unleash your powers, your head suddenly begins to throb!", "type": "bad" },
      {
        "u_add_effect": "psionic_overload",
        "duration": {
          "math": [ "u_val('time: 30 s') * rng( ( u_val('vitamin', 'name:vitamin_psionic_drain') / 2 ), ( u_val('vitamin', 'name:vitamin_psionic_drain') * 2 ) )" ]
        }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_DRAIN_EFFECT_CHECK_EXTRA_DRAIN",
    "condition": { 
      "and": [ 
        { "math": [ "u_val('vitamin', 'name:vitamin_psionic_drain')", ">=", "15" ] },  
        {
          "x_in_y_chance": {
            "x": {
              "math": [
                "( (u_val('vitamin', 'name:vitamin_psionic_drain') * 2.5 ) + 20)"
              ]
            },
            "y": 1000
          }
        } 
      ] 
    },
    "effect": [
      { "u_message": "You feel a sudden fatigue as your powers are unleashed.", "type": "bad" },
      { "math": [ "u_val('vitamin', 'name:vitamin_psionic_drain')", "+=", "rng( 2,6 )" ] }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_DRAIN_EFFECT_CHECK_NOSEBLEED",
    "condition": { 
      "and": [ 
        { "math": [ "u_val('vitamin', 'name:vitamin_psionic_drain')", ">=", "25" ] },  
        {
          "x_in_y_chance": {
            "x": {
              "math": [
                "( (u_val('vitamin', 'name:vitamin_psionic_drain') * 1.8 ) + 40)"
              ]
            },
            "y": 1000
          }
        } 
      ] 
    },
    "effect": [
      { "u_message": "As you unleash your powers, blood drips from your nose!", "type": "bad" },
      { "u_add_effect": "bleed", "intensity": 1, "bodypart": "head" },
      { "u_set_hp": { "math": { "u_hp('head') - 1" } }, "target_part": "head" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_DRAIN_EFFECT_CHECK_STAMINA_LOSS",
    "condition": { 
      "and": [ 
        { "math": [ "u_val('vitamin', 'name:vitamin_psionic_drain')", ">=", "60" ] },  
        {
          "x_in_y_chance": {
            "x": {
              "math": [
                "( (u_val('vitamin', 'name:vitamin_psionic_drain') * 2.2 ) + 30)"
              ]
            },
            "y": 1000
          }
        } 
      ] 
    },
    "effect": [
      { "u_message": "As you unleash your powers, your vigor leaves you in a rush!", "type": "bad" },
      { "math": [ "u_val('stamina')", "-=", "rng(3000,9000)" ] }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_DRAIN_EFFECT_CHECK_FATIGUE",
    "condition": { 
      "and": [ 
        { "math": [ "u_val('vitamin', 'name:vitamin_psionic_drain')", ">=", "60" ] },  
        {
          "x_in_y_chance": {
            "x": {
              "math": [
                "( (u_val('vitamin', 'name:vitamin_psionic_drain') * 1.2 ) + 80)"
              ]
            },
            "y": 1000
          }
        } 
      ] 
    },
    "effect": [
      { "u_message": "As you unleash your powers, you feel weary!", "type": "bad" },
      { "math": [ "u_val('fatigue')", "-=", "rng(30,90)" ] }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_DRAIN_EFFECT_CHECK_WEAKNESS",
    "condition": { 
      "and": [ 
        { "math": [ "u_val('vitamin', 'name:vitamin_psionic_drain')", ">=", "80" ] },  
        {
          "x_in_y_chance": {
            "x": {
              "math": [
                "( (u_val('vitamin', 'name:vitamin_psionic_drain') * 1.5 ) + 50)"
              ]
            },
            "y": 1000
          }
        } 
      ] 
    },
    "effect": [
      { "u_message": "As you unleash your powers, your muscles begin trembling!", "type": "bad" },
      {
        "u_add_effect": "effect_biokin_overload",
        "duration": {
          "math": [ "u_val('time: 30 s') * rng( ( u_val('vitamin', 'name:vitamin_psionic_drain') / 2 ), ( u_val('vitamin', 'name:vitamin_psionic_drain') * 2 ) )" ]
        }
      }
    ]
  }
]
