[
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_ITEM_APPORT",
    "effect": [
      {
        "u_run_inv_eocs": "all",
        "search_data": [ { "wielded_only": true, "condition": { "math": [ "n_volume() > 0" ] } } ],
        "true_eocs": [
          {
            "id": "EOC_TELEPORT_ITEM_APPORT_NEXT",
            "effect": [
              {
                "u_run_inv_eocs": "all",
                "search_data": [
                  {
                    "wielded_only": true,
                    "condition": {
                      "and": [
                        {
                          "math": [
                            "n_volume() <= ((u_spell_level('teleport_item_apport') * 2500) + 2000) * scaling_factor(u_val('intelligence')) * u_nether_attunement_power_scaling"
                          ]
                        },
                        { "math": [ "n_volume() > 0" ] }
                      ]
                    }
                  }
                ],
                "true_eocs": [
                  {
                    "id": "EOC_TELEPORT_ITEM_APPORT_ITEM_QUALIFIES",
                    "effect": [
                      {
                        "if": {
                          "u_query_tile": "line_of_sight",
                          "target_var": { "global_val": "teleporter_item_apport_location" },
                          "range": {
                            "math": [
                              "min( ( ( (u_spell_level('teleport_item_apport') * 1.25) + 2) * (scaling_factor(u_val('intelligence') ) ) * u_nether_attunement_power_scaling), 80)"
                            ]
                          },
                          "z_level": true,
                          "message": "Select apport location."
                        },
                        "then": {
                          "if": {
                            "or": [
                              { "map_terrain_with_flag": "WALL", "loc": { "global_val": "teleporter_item_apport_location" } },
                              {
                                "map_terrain_with_flag": "DOOR",
                                "loc": { "global_val": "teleporter_item_apport_location" }
                              }
                            ]
                          },
                          "then": { "u_message": "You cannot apport an item inside a solid object.", "type": "bad" },
                          "else": [
                            { "npc_teleport": { "global_val": "teleporter_item_apport_location" } },
                            {
                              "u_message": "The item in your hands grows freezing cold for a moment before vanishing.",
                              "type": "neutral"
                            }
                          ]
                        },
                        "else": { "u_message": "Canceled" }
                      }
                    ]
                  }
                ],
                "false_eocs": [
                  {
                    "id": "EOC_TELEPORT_ITEM_APPORT_ITEM_DOES_NOT_QUALIFY",
                    "effect": [ { "u_message": "The air around the item wavers, but nothing happens.  The item is too large." } ]
                  }
                ]
              }
            ]
          }
        ],
        "false_eocs": [
          { "id": "EOC_TELEPORT_ITEM_APPORT_FAIL", "effect": [ { "u_message": "You must be holding something to apport it." } ] }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_SPACIAL_VORTEX",
    "effect": [
      { "u_cast_spell": { "id": "psionic_drained_difficulty_four", "hit_self": true } },
      {
        "switch": { "math": [ "u_spell_level('teleport_collapse')" ] },
        "cases": [
          { "case": 0, "effect": [ { "u_cast_spell": { "id": "teleport_collapse_01", "hit_self": false }, "targeted": true } ] },
          {
            "case": 4,
            "effect": [ { "u_cast_spell": { "id": "teleport_collapse_02", "hit_self": false }, "targeted": true } ]
          },
          {
            "case": 8,
            "effect": [ { "u_cast_spell": { "id": "teleport_collapse_03", "hit_self": false }, "targeted": true } ]
          },
          {
            "case": 12,
            "effect": [ { "u_cast_spell": { "id": "teleport_collapse_04", "hit_self": false }, "targeted": true } ]
          },
          {
            "case": 16,
            "effect": [ { "u_cast_spell": { "id": "teleport_collapse_05", "hit_self": false }, "targeted": true } ]
          },
          {
            "case": 20,
            "effect": [ { "u_cast_spell": { "id": "teleport_collapse_06", "hit_self": false }, "targeted": true } ]
          },
          {
            "case": 24,
            "effect": [ { "u_cast_spell": { "id": "teleport_collapse_07", "hit_self": false }, "targeted": true } ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORTER_OUBLIETTE_HANDLING",
    "condition": {
      "and": [
        { "not": { "u_has_flag": "TELESTOP" } },
        { "not": { "u_has_flag": "TELEPORT_IMMUNE" } },
        { "not": { "u_has_worn_with_flag": "DIMENSIONAL_ANCHOR" } }
      ]
    },
    "effect": [ { "run_eocs": "EOC_TELEPORTER_OUBLIETTE_HANDLING_2" } ],
    "false_effect": [ { "npc_message": "Your target wavers for a moment, but nothing happens." } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORTER_OUBLIETTE_HANDLING_2",
    "condition": { "not": "u_is_npc" },
    "effect": [
      {
        "math": [
          "u_psi_teleporter_damage",
          "=",
          "rng(((15 + (n_spell_level('teleport_banish') * 15)) * ( ( n_val('intelligence') + 10) / 20 ) * n_nether_attunement_power_scaling),((350 + (n_spell_level('teleport_banish') * 35)) * ( ( n_val('intelligence') + 10) / 20 ) * n_nether_attunement_power_scaling))"
        ]
      },
      { "math": [ "u_health_comparison = u_hp('ALL')" ] },
      {
        "if": { "math": [ "u_psi_teleporter_damage > u_health_comparison" ] },
        "then": [
          { "u_cast_spell": { "id": "teleport_banish_self_target", "message": "" } },
          { "npc_message": "With a tremendous mental exertion, you hurl your target to another dimension!" }
        ]
      }
    ],
    "false_effect": [
      {
        "math": [
          "u_psi_teleporter_damage",
          "=",
          "rng(((15 + (n_spell_level('teleport_banish') * 15)) * ( ( n_val('intelligence') + 10) / 20 ) * n_nether_attunement_power_scaling),((350 + (n_spell_level('teleport_banish') * 35)) * ( ( n_val('intelligence') + 10) / 20 ) * n_nether_attunement_power_scaling))"
        ]
      },
      {
        "math": [
          "u_health_comparison",
          "=",
          "(u_hp('arm_l') + u_hp('arm_r') + u_hp('leg_l') + u_hp('leg_r') + u_hp('torso') + u_hp('head')) / 3"
        ]
      },
      {
        "if": { "math": [ "u_psi_teleporter_damage > u_health_comparison" ] },
        "then": [
          "u_die",
          { "npc_message": "With a tremendous mental exertion, you hurl your target to another dimension!" },
          {
            "u_map_run_item_eocs": "all",
            "min_radius": 0,
            "max_radius": 0,
            "true_eocs": [ { "id": "EOC_TELEPORTER_OUBLIETTE_HANDLING_DELETE_NPC_ITEMS", "effect": [ "npc_die" ] } ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORTER_GATEWAY_MESSAGE",
    "effect": [
      {
        "u_message": "There is a long moment of darkness and terrible cold that seems like it will freeze your heart, and then you are somewhere else.",
        "type": "neutral"
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORTER_ATTUNING_MESSAGE",
    "effect": [
      { "u_message": "You concentrate and begin memorizing every detail of the current area you are in.", "type": "neutral" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORTER_ATTUNED_MESSAGE",
    "effect": [
      {
        "u_message": "You have successfully memorized the local area, and may now return to it with your powers.",
        "type": "good"
      },
      "u_cancel_activity"
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_SELECTOR",
    "effect": [
      {
        "run_eoc_selector": [
          "EOC_TELEPORT_GATEWAY_SELECTOR_01",
          "EOC_TELEPORT_GATEWAY_SELECTOR_02",
          "EOC_TELEPORT_GATEWAY_SELECTOR_03",
          "EOC_TELEPORT_GATEWAY_SELECTOR_04",
          "EOC_TELEPORT_GATEWAY_SELECTOR_05",
          "EOC_TELEPORT_GATEWAY_SELECTOR_06",
          "EOC_TELEPORT_GATEWAY_SELECTOR_07",
          "EOC_TELEPORT_GATEWAY_SELECTOR_08",
          "EOC_TELEPORT_GATEWAY_SELECTOR_09",
          "EOC_TELEPORT_GATEWAY_SELECTOR_10"
        ],
        "names": [
          "Gateway: <u_val:gateway_destination_name_1>",
          "Gateway: <u_val:gateway_destination_name_2>",
          "Gateway: <u_val:gateway_destination_name_3>",
          "Gateway: <u_val:gateway_destination_name_4>",
          "Gateway: <u_val:gateway_destination_name_5>",
          "Gateway: <u_val:gateway_destination_name_6>",
          "Gateway: <u_val:gateway_destination_name_7>",
          "Gateway: <u_val:gateway_destination_name_8>",
          "Gateway: <u_val:gateway_destination_name_9>",
          "Gateway: <u_val:gateway_destination_name_10>"
        ],
        "keys": [ "1", "2", "3", "4", "5", "6", "7", "8", "9", "0" ],
        "descriptions": [
          "Teleport/Attune to a destination.",
          "Teleport/Attune to a destination.",
          "Teleport/Attune to a destination.",
          "Teleport/Attune to a destination.",
          "Teleport/Attune to a destination.",
          "Teleport/Attune to a destination.",
          "Teleport/Attune to a destination.",
          "Teleport/Attune to a destination.",
          "Teleport/Attune to a destination.",
          "Teleport/Attune to a destination."
        ],
        "hide_failing": true,
        "allow_cancel": true
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "ECO_TELEPORTER_CANCELLING_ATTUNING_CANCELS_ATTUNE",
    "eoc_type": "EVENT",
    "required_event": "character_finished_activity",
    "condition": {
      "and": [
        { "compare_string": [ "ACT_PSI_TELEPORTER_ATTUNING", { "context_val": "activity" } ] },
        { "u_has_effect": "effect_teleporter_attuning_to_area" }
      ]
    },
    "effect": [ { "u_lose_effect": "effect_teleporter_attuning_to_area" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_SELECTOR_01",
    "effect": [
      {
        "run_eoc_selector": [ "EOC_TELEPORT_GATEWAY_TELEPORT_01", "EOC_TELEPORT_GATEWAY_ATTUNE_01" ],
        "names": [ "Destination: <u_val:gateway_destination_name_1>", "Attune to Area" ],
        "keys": [ "1", "2" ],
        "descriptions": [ "Teleport to <u_val:gateway_destination_name_1>.", "Attune to a new destination." ],
        "hide_failing": true,
        "allow_cancel": true
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_TELEPORT_01",
    "condition": { "math": [ "has_var(u_gateway_destination_1)" ] },
    "effect": [ { "u_teleport": { "u_val": "gateway_destination_1" } }, { "run_eocs": "EOC_TELEPORTER_GATEWAY_MESSAGE" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_01",
    "effect": [
      { "run_eocs": "EOC_TELEPORTER_ATTUNING_MESSAGE" },
      { "u_add_effect": "effect_teleporter_attuning_to_area", "duration": "8 hours" },
      { "u_assign_activity": "ACT_PSI_TELEPORTER_ATTUNING", "duration": "8 hours" },
      {
        "run_eocs": "EOC_TELEPORT_GATEWAY_ATTUNE_01_SUCCESS",
        "time_in_future": { "math": [ "28800 - clamp(( u_spell_level('teleport_gateway') * 1200), 0, 27000)" ] }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_01_SUCCESS",
    "condition": { "u_has_effect": "effect_teleporter_attuning_to_area" },
    "effect": [
      {
        "set_string_var": "Destination 1",
        "string_input": {
          "title": { "i18n": true, "str": "Input a destination name:" },
          "description": { "i18n": true, "str": "Destination Name:" },
          "width": 35,
          "identifier": ""
        },
        "target_var": { "u_val": "gateway_destination_name_1" }
      },
      { "u_location_variable": { "u_val": "gateway_destination_1" }, "min_radius": 0, "max_radius": 0 },
      { "run_eocs": "EOC_TELEPORTER_ATTUNED_MESSAGE" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_SELECTOR_02",
    "condition": {
      "math": [
        "(u_spell_level('teleport_gateway') * (1 + (u_has_trait('GOODMEMORY') * 0.2) ) / (1 + (u_has_trait('FORGETFUL') * 0.33) ) ) / 3",
        ">=",
        "1"
      ]
    },
    "effect": [
      {
        "run_eoc_selector": [ "EOC_TELEPORT_GATEWAY_TELEPORT_02", "EOC_TELEPORT_GATEWAY_ATTUNE_02" ],
        "names": [ "Destination: <u_val:gateway_destination_name_2>", "Attune to Area" ],
        "keys": [ "1", "2" ],
        "descriptions": [ "Teleport to <u_val:gateway_destination_name_2>.", "Attune to a new destination." ],
        "hide_failing": true,
        "allow_cancel": true
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_TELEPORT_02",
    "condition": { "math": [ "has_var(u_gateway_destination_2)" ] },
    "effect": [ { "u_teleport": { "u_val": "gateway_destination_2" } }, { "run_eocs": "EOC_TELEPORTER_GATEWAY_MESSAGE" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_02",
    "effect": [
      { "run_eocs": "EOC_TELEPORTER_ATTUNING_MESSAGE" },
      { "u_add_effect": "effect_teleporter_attuning_to_area", "duration": "8 hours" },
      { "u_assign_activity": "ACT_PSI_TELEPORTER_ATTUNING", "duration": "8 hours" },
      {
        "run_eocs": "EOC_TELEPORT_GATEWAY_ATTUNE_02_SUCCESS",
        "time_in_future": { "math": [ "28800 - clamp(( u_spell_level('teleport_gateway') * 1200), 0, 27000)" ] }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_02_SUCCESS",
    "condition": { "u_has_effect": "effect_teleporter_attuning_to_area" },
    "effect": [
      {
        "set_string_var": "Destination 2",
        "string_input": {
          "title": { "i18n": true, "str": "Input a destination name:" },
          "description": { "i18n": true, "str": "Destination Name:" },
          "width": 35,
          "identifier": ""
        },
        "target_var": { "u_val": "gateway_destination_name_2" }
      },
      { "u_location_variable": { "u_val": "gateway_destination_2" }, "min_radius": 0, "max_radius": 0 },
      { "run_eocs": "EOC_TELEPORTER_ATTUNED_MESSAGE" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_SELECTOR_03",
    "condition": {
      "math": [
        "(u_spell_level('teleport_gateway') * (1 + (u_has_trait('GOODMEMORY') * 0.2) ) / (1 + (u_has_trait('FORGETFUL') * 0.33) ) ) / 3",
        ">=",
        "2"
      ]
    },
    "effect": [
      {
        "run_eoc_selector": [ "EOC_TELEPORT_GATEWAY_TELEPORT_03", "EOC_TELEPORT_GATEWAY_ATTUNE_03" ],
        "names": [ "Destination: <u_val:gateway_destination_name_3>", "Attune to Area" ],
        "keys": [ "1", "2" ],
        "descriptions": [ "Teleport to <u_val:gateway_destination_name_3>.", "Attune to a new destination." ],
        "hide_failing": true,
        "allow_cancel": true
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_TELEPORT_03",
    "condition": { "math": [ "has_var(u_gateway_destination_3)" ] },
    "effect": [ { "u_teleport": { "u_val": "gateway_destination_3" } }, { "run_eocs": "EOC_TELEPORTER_GATEWAY_MESSAGE" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_03",
    "effect": [
      { "run_eocs": "EOC_TELEPORTER_ATTUNING_MESSAGE" },
      { "u_add_effect": "effect_teleporter_attuning_to_area", "duration": "8 hours" },
      { "u_assign_activity": "ACT_PSI_TELEPORTER_ATTUNING", "duration": "8 hours" },
      {
        "run_eocs": "EOC_TELEPORT_GATEWAY_ATTUNE_03_SUCCESS",
        "time_in_future": { "math": [ "28800 - clamp(( u_spell_level('teleport_gateway') * 1200), 0, 27000)" ] }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_03_SUCCESS",
    "condition": { "u_has_effect": "effect_teleporter_attuning_to_area" },
    "effect": [
      {
        "set_string_var": "Destination 3",
        "string_input": {
          "title": { "i18n": true, "str": "Input a destination name:" },
          "description": { "i18n": true, "str": "Destination Name:" },
          "width": 35,
          "identifier": ""
        },
        "target_var": { "u_val": "gateway_destination_name_3" }
      },
      { "u_location_variable": { "u_val": "gateway_destination_3" }, "min_radius": 0, "max_radius": 0 },
      { "run_eocs": "EOC_TELEPORTER_ATTUNED_MESSAGE" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_SELECTOR_04",
    "condition": {
      "math": [
        "(u_spell_level('teleport_gateway') * (1 + (u_has_trait('GOODMEMORY') * 0.2) ) / (1 + (u_has_trait('FORGETFUL') * 0.33) ) ) / 3",
        ">=",
        "3"
      ]
    },
    "effect": [
      {
        "run_eoc_selector": [ "EOC_TELEPORT_GATEWAY_TELEPORT_04", "EOC_TELEPORT_GATEWAY_ATTUNE_04" ],
        "names": [ "Destination: <u_val:gateway_destination_name_4>", "Attune to Area" ],
        "keys": [ "1", "2" ],
        "descriptions": [ "Teleport to <u_val:gateway_destination_name_4>.", "Attune to a new destination." ],
        "hide_failing": true,
        "allow_cancel": true
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_TELEPORT_04",
    "condition": { "math": [ "has_var(u_gateway_destination_4)" ] },
    "effect": [ { "u_teleport": { "u_val": "gateway_destination_4" } }, { "run_eocs": "EOC_TELEPORTER_GATEWAY_MESSAGE" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_04",
    "effect": [
      { "run_eocs": "EOC_TELEPORTER_ATTUNING_MESSAGE" },
      { "u_add_effect": "effect_teleporter_attuning_to_area", "duration": "8 hours" },
      { "u_assign_activity": "ACT_PSI_TELEPORTER_ATTUNING", "duration": "8 hours" },
      {
        "run_eocs": "EOC_TELEPORT_GATEWAY_ATTUNE_04_SUCCESS",
        "time_in_future": { "math": [ "28800 - clamp(( u_spell_level('teleport_gateway') * 1200), 0, 27000)" ] }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_04_SUCCESS",
    "condition": { "u_has_effect": "effect_teleporter_attuning_to_area" },
    "effect": [
      {
        "set_string_var": "Destination 4",
        "string_input": {
          "title": { "i18n": true, "str": "Input a destination name:" },
          "description": { "i18n": true, "str": "Destination Name:" },
          "width": 35,
          "identifier": ""
        },
        "target_var": { "u_val": "gateway_destination_name_4" }
      },
      { "u_location_variable": { "u_val": "gateway_destination_4" }, "min_radius": 0, "max_radius": 0 },
      { "run_eocs": "EOC_TELEPORTER_ATTUNED_MESSAGE" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_SELECTOR_05",
    "condition": {
      "math": [
        "(u_spell_level('teleport_gateway') * (1 + (u_has_trait('GOODMEMORY') * 0.2) ) / (1 + (u_has_trait('FORGETFUL') * 0.33) ) ) / 3",
        ">=",
        "4"
      ]
    },
    "effect": [
      {
        "run_eoc_selector": [ "EOC_TELEPORT_GATEWAY_TELEPORT_05", "EOC_TELEPORT_GATEWAY_ATTUNE_05" ],
        "names": [ "Destination: <u_val:gateway_destination_name_5>", "Attune to Area" ],
        "keys": [ "1", "2" ],
        "descriptions": [ "Teleport to <u_val:gateway_destination_name_5>.", "Attune to a new destination." ],
        "hide_failing": true,
        "allow_cancel": true
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_TELEPORT_05",
    "condition": { "math": [ "has_var(u_gateway_destination_5)" ] },
    "effect": [ { "u_teleport": { "u_val": "gateway_destination_5" } }, { "run_eocs": "EOC_TELEPORTER_GATEWAY_MESSAGE" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_05",
    "effect": [
      { "run_eocs": "EOC_TELEPORTER_ATTUNING_MESSAGE" },
      { "u_add_effect": "effect_teleporter_attuning_to_area", "duration": "8 hours" },
      { "u_assign_activity": "ACT_PSI_TELEPORTER_ATTUNING", "duration": "8 hours" },
      {
        "run_eocs": "EOC_TELEPORT_GATEWAY_ATTUNE_05_SUCCESS",
        "time_in_future": { "math": [ "28800 - clamp(( u_spell_level('teleport_gateway') * 1200), 0, 27000)" ] }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_05_SUCCESS",
    "condition": { "u_has_effect": "effect_teleporter_attuning_to_area" },
    "effect": [
      {
        "set_string_var": "Destination 5",
        "string_input": {
          "title": { "i18n": true, "str": "Input a destination name:" },
          "description": { "i18n": true, "str": "Destination Name:" },
          "width": 35,
          "identifier": ""
        },
        "target_var": { "u_val": "gateway_destination_name_5" }
      },
      { "u_location_variable": { "u_val": "gateway_destination_5" }, "min_radius": 0, "max_radius": 0 },
      { "run_eocs": "EOC_TELEPORTER_ATTUNED_MESSAGE" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_SELECTOR_06",
    "condition": {
      "math": [
        "(u_spell_level('teleport_gateway') * (1 + (u_has_trait('GOODMEMORY') * 0.2) ) / (1 + (u_has_trait('FORGETFUL') * 0.33) ) ) / 3",
        ">=",
        "5"
      ]
    },
    "effect": [
      {
        "run_eoc_selector": [ "EOC_TELEPORT_GATEWAY_TELEPORT_06", "EOC_TELEPORT_GATEWAY_ATTUNE_06" ],
        "names": [ "Destination: <u_val:gateway_destination_name_6>", "Attune to Area" ],
        "keys": [ "1", "2" ],
        "descriptions": [ "Teleport to <u_val:gateway_destination_name_6>.", "Attune to a new destination." ],
        "hide_failing": true,
        "allow_cancel": true
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_TELEPORT_06",
    "condition": { "math": [ "has_var(u_gateway_destination_6)" ] },
    "effect": [ { "u_teleport": { "u_val": "gateway_destination_6" } }, { "run_eocs": "EOC_TELEPORTER_GATEWAY_MESSAGE" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_06",
    "effect": [
      { "run_eocs": "EOC_TELEPORTER_ATTUNING_MESSAGE" },
      { "u_add_effect": "effect_teleporter_attuning_to_area", "duration": "8 hours" },
      { "u_assign_activity": "ACT_PSI_TELEPORTER_ATTUNING", "duration": "8 hours" },
      {
        "run_eocs": "EOC_TELEPORT_GATEWAY_ATTUNE_06_SUCCESS",
        "time_in_future": { "math": [ "28800 - clamp(( u_spell_level('teleport_gateway') * 1200), 0, 27000)" ] }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_06_SUCCESS",
    "condition": { "u_has_effect": "effect_teleporter_attuning_to_area" },
    "effect": [
      {
        "set_string_var": "Destination 6",
        "string_input": {
          "title": { "i18n": true, "str": "Input a destination name:" },
          "description": { "i18n": true, "str": "Destination Name:" },
          "width": 35,
          "identifier": ""
        },
        "target_var": { "u_val": "gateway_destination_name_6" }
      },
      { "u_location_variable": { "u_val": "gateway_destination_6" }, "min_radius": 0, "max_radius": 0 },
      { "run_eocs": "EOC_TELEPORTER_ATTUNED_MESSAGE" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_SELECTOR_07",
    "condition": {
      "math": [
        "(u_spell_level('teleport_gateway') * (1 + (u_has_trait('GOODMEMORY') * 0.2) ) / (1 + (u_has_trait('FORGETFUL') * 0.33) ) ) / 3",
        ">=",
        "6"
      ]
    },
    "effect": [
      {
        "run_eoc_selector": [ "EOC_TELEPORT_GATEWAY_TELEPORT_07", "EOC_TELEPORT_GATEWAY_ATTUNE_07" ],
        "names": [ "Destination: <u_val:gateway_destination_name_7>", "Attune to Area" ],
        "keys": [ "1", "2" ],
        "descriptions": [ "Teleport to <u_val:gateway_destination_name_7>.", "Attune to a new destination." ],
        "hide_failing": true,
        "allow_cancel": true
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_TELEPORT_07",
    "condition": { "math": [ "has_var(u_gateway_destination_7)" ] },
    "effect": [ { "u_teleport": { "u_val": "gateway_destination_7" } }, { "run_eocs": "EOC_TELEPORTER_GATEWAY_MESSAGE" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_07",
    "effect": [
      { "run_eocs": "EOC_TELEPORTER_ATTUNING_MESSAGE" },
      { "u_add_effect": "effect_teleporter_attuning_to_area", "duration": "8 hours" },
      { "u_assign_activity": "ACT_PSI_TELEPORTER_ATTUNING", "duration": "8 hours" },
      {
        "run_eocs": "EOC_TELEPORT_GATEWAY_ATTUNE_07_SUCCESS",
        "time_in_future": { "math": [ "28800 - clamp(( u_spell_level('teleport_gateway') * 1200), 0, 27000)" ] }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_07_SUCCESS",
    "condition": { "u_has_effect": "effect_teleporter_attuning_to_area" },
    "effect": [
      {
        "set_string_var": "Destination 7",
        "string_input": {
          "title": { "i18n": true, "str": "Input a destination name:" },
          "description": { "i18n": true, "str": "Destination Name:" },
          "width": 35,
          "identifier": ""
        },
        "target_var": { "u_val": "gateway_destination_name_7" }
      },
      { "u_location_variable": { "u_val": "gateway_destination_7" }, "min_radius": 0, "max_radius": 0 },
      { "run_eocs": "EOC_TELEPORTER_ATTUNED_MESSAGE" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_SELECTOR_08",
    "condition": {
      "math": [
        "(u_spell_level('teleport_gateway') * (1 + (u_has_trait('GOODMEMORY') * 0.2) ) / (1 + (u_has_trait('FORGETFUL') * 0.33) ) ) / 3",
        ">=",
        "7"
      ]
    },
    "effect": [
      {
        "run_eoc_selector": [ "EOC_TELEPORT_GATEWAY_TELEPORT_08", "EOC_TELEPORT_GATEWAY_ATTUNE_08" ],
        "names": [ "Destination: <u_val:gateway_destination_name_8>", "Attune to Area" ],
        "keys": [ "1", "2" ],
        "descriptions": [ "Teleport to <u_val:gateway_destination_name_8>.", "Attune to a new destination." ],
        "hide_failing": true,
        "allow_cancel": true
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_TELEPORT_08",
    "condition": { "math": [ "has_var(u_gateway_destination_8)" ] },
    "effect": [ { "u_teleport": { "u_val": "gateway_destination_8" } }, { "run_eocs": "EOC_TELEPORTER_GATEWAY_MESSAGE" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_08",
    "effect": [
      { "run_eocs": "EOC_TELEPORTER_ATTUNING_MESSAGE" },
      { "u_add_effect": "effect_teleporter_attuning_to_area", "duration": "8 hours" },
      { "u_assign_activity": "ACT_PSI_TELEPORTER_ATTUNING", "duration": "8 hours" },
      {
        "run_eocs": "EOC_TELEPORT_GATEWAY_ATTUNE_08_SUCCESS",
        "time_in_future": { "math": [ "28800 - clamp(( u_spell_level('teleport_gateway') * 1200), 0, 27000)" ] }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_08_SUCCESS",
    "condition": { "u_has_effect": "effect_teleporter_attuning_to_area" },
    "effect": [
      {
        "set_string_var": "Destination 8",
        "string_input": {
          "title": { "i18n": true, "str": "Input a destination name:" },
          "description": { "i18n": true, "str": "Destination Name:" },
          "width": 35,
          "identifier": ""
        },
        "target_var": { "u_val": "gateway_destination_name_8" }
      },
      { "u_location_variable": { "u_val": "gateway_destination_8" }, "min_radius": 0, "max_radius": 0 },
      { "run_eocs": "EOC_TELEPORTER_ATTUNED_MESSAGE" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_SELECTOR_09",
    "condition": {
      "math": [
        "(u_spell_level('teleport_gateway') * (1 + (u_has_trait('GOODMEMORY') * 0.2) ) / (1 + (u_has_trait('FORGETFUL') * 0.33) ) ) / 3",
        ">=",
        "8"
      ]
    },
    "effect": [
      {
        "run_eoc_selector": [ "EOC_TELEPORT_GATEWAY_TELEPORT_09", "EOC_TELEPORT_GATEWAY_ATTUNE_09" ],
        "names": [ "Destination: <u_val:gateway_destination_name_9>", "Attune to Area" ],
        "keys": [ "1", "2" ],
        "descriptions": [ "Teleport to <u_val:gateway_destination_name_9>.", "Attune to a new destination." ],
        "hide_failing": true,
        "allow_cancel": true
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_TELEPORT_09",
    "condition": { "math": [ "has_var(u_gateway_destination_9)" ] },
    "effect": [ { "u_teleport": { "u_val": "gateway_destination_9" } }, { "run_eocs": "EOC_TELEPORTER_GATEWAY_MESSAGE" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_09",
    "effect": [
      { "run_eocs": "EOC_TELEPORTER_ATTUNING_MESSAGE" },
      { "u_add_effect": "effect_teleporter_attuning_to_area", "duration": "8 hours" },
      { "u_assign_activity": "ACT_PSI_TELEPORTER_ATTUNING", "duration": "8 hours" },
      {
        "run_eocs": "EOC_TELEPORT_GATEWAY_ATTUNE_09_SUCCESS",
        "time_in_future": { "math": [ "28800 - clamp(( u_spell_level('teleport_gateway') * 1200), 0, 27000)" ] }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_09_SUCCESS",
    "condition": { "u_has_effect": "effect_teleporter_attuning_to_area" },
    "effect": [
      {
        "set_string_var": "Destination 9",
        "string_input": {
          "title": { "i18n": true, "str": "Input a destination name:" },
          "description": { "i18n": true, "str": "Destination Name:" },
          "width": 35,
          "identifier": ""
        },
        "target_var": { "u_val": "gateway_destination_name_9" }
      },
      { "u_location_variable": { "u_val": "gateway_destination_9" }, "min_radius": 0, "max_radius": 0 },
      { "run_eocs": "EOC_TELEPORTER_ATTUNED_MESSAGE" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_SELECTOR_10",
    "condition": {
      "math": [
        "(u_spell_level('teleport_gateway') * (1 + (u_has_trait('GOODMEMORY') * 0.2) ) / (1 + (u_has_trait('FORGETFUL') * 0.33) ) ) / 3",
        ">=",
        "9"
      ]
    },
    "effect": [
      {
        "run_eoc_selector": [ "EOC_TELEPORT_GATEWAY_TELEPORT_10", "EOC_TELEPORT_GATEWAY_ATTUNE_10" ],
        "names": [ "Destination: <u_val:gateway_destination_name_10>", "Attune to Area" ],
        "keys": [ "1", "2" ],
        "descriptions": [ "Teleport to <u_val:gateway_destination_name_10>.", "Attune to a new destination." ],
        "hide_failing": true,
        "allow_cancel": true
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_TELEPORT_10",
    "condition": { "math": [ "has_var(u_gateway_destination_10)" ] },
    "effect": [ { "u_teleport": { "u_val": "gateway_destination_10" } }, { "run_eocs": "EOC_TELEPORTER_GATEWAY_MESSAGE" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_10",
    "effect": [
      { "run_eocs": "EOC_TELEPORTER_ATTUNING_MESSAGE" },
      { "u_add_effect": "effect_teleporter_attuning_to_area", "duration": "8 hours" },
      { "u_assign_activity": "ACT_PSI_TELEPORTER_ATTUNING", "duration": "8 hours" },
      {
        "run_eocs": "EOC_TELEPORT_GATEWAY_ATTUNE_10_SUCCESS",
        "time_in_future": { "math": [ "28800 - clamp(( u_spell_level('teleport_gateway') * 1200), 0, 27000)" ] }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_GATEWAY_ATTUNE_10_SUCCESS",
    "condition": { "u_has_effect": "effect_teleporter_attuning_to_area" },
    "effect": [
      {
        "set_string_var": "Destination 10",
        "string_input": {
          "title": { "i18n": true, "str": "Input a destination name:" },
          "description": { "i18n": true, "str": "Destination Name:" },
          "width": 35,
          "identifier": ""
        },
        "target_var": { "u_val": "gateway_destination_name_10" }
      },
      { "u_location_variable": { "u_val": "gateway_destination_10" }, "min_radius": 0, "max_radius": 0 },
      { "run_eocs": "EOC_TELEPORTER_ATTUNED_MESSAGE" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_dilated_gateway_SELECTOR",
    "effect": [
      {
        "run_eoc_selector": [
          "EOC_TELEPORT_dilated_gateway_SELECT_01",
          "EOC_TELEPORT_dilated_gateway_SELECT_02",
          "EOC_TELEPORT_dilated_gateway_SELECT_03",
          "EOC_TELEPORT_dilated_gateway_SELECT_04",
          "EOC_TELEPORT_dilated_gateway_SELECT_05",
          "EOC_TELEPORT_dilated_gateway_SELECT_06",
          "EOC_TELEPORT_dilated_gateway_SELECT_07",
          "EOC_TELEPORT_dilated_gateway_SELECT_08",
          "EOC_TELEPORT_dilated_gateway_SELECT_09",
          "EOC_TELEPORT_dilated_gateway_SELECT_10"
        ],
        "names": [
          "Dilated Gateway: <u_val:gateway_destination_name_1>",
          "Dilated Gateway: <u_val:gateway_destination_name_2>",
          "Dilated Gateway: <u_val:gateway_destination_name_3>",
          "Dilated Gateway: <u_val:gateway_destination_name_4>",
          "Dilated Gateway: <u_val:gateway_destination_name_5>",
          "Dilated Gateway: <u_val:gateway_destination_name_6>",
          "Dilated Gateway: <u_val:gateway_destination_name_7>",
          "Dilated Gateway: <u_val:gateway_destination_name_8>",
          "Dilated Gateway: <u_val:gateway_destination_name_9>",
          "Dilated Gateway: <u_val:gateway_destination_name_10>"
        ],
        "keys": [ "1", "2", "3", "4", "5", "6", "7", "8", "9", "0" ],
        "descriptions": [
          "Teleport target to a destination.",
          "Teleport target to a destination.",
          "Teleport target to a destination.",
          "Teleport target to a destination.",
          "Teleport target to a destination.",
          "Teleport target to a destination.",
          "Teleport target to a destination.",
          "Teleport target to a destination.",
          "Teleport target to a destination.",
          "Teleport target to a destination."
        ],
        "hide_failing": true,
        "allow_cancel": true
      },
      {
        "if": { "not": { "compare_string": [ { "u_val": "dilated_gateway_location" }, "" ] } },
        "then": [
          { "u_cast_spell": { "id": "teleport_dilated_gateway_teleport_others", "message": "" } },
          { "u_cast_spell": { "id": "teleport_dilated_gateway_teleport_self", "message": "" } }
        ]
      },
      { "set_string_var": "", "target_var": { "u_val": "dilated_gateway_location" } }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_EXTERNAL_TELEPORT",
    "effect": [
      {
        "set_string_var": "<npc_val:dilated_gateway_location>",
        "target_var": { "context_val": "temp_var" },
        "parse_tags": true
      },
      { "u_teleport": { "var_val": "temp_var" }, "force_safe": true },
      { "message": "<u_name> vanishes!" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_dilated_gateway_SELECT_01",
    "condition": { "math": [ "has_var(u_gateway_destination_1)" ] },
    "effect": [ { "set_string_var": "npc_gateway_destination_1", "target_var": { "u_val": "dilated_gateway_location" } } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_dilated_gateway_SELECT_02",
    "condition": { "math": [ "has_var(u_gateway_destination_2)" ] },
    "effect": [ { "set_string_var": "npc_gateway_destination_2", "target_var": { "u_val": "dilated_gateway_location" } } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_dilated_gateway_SELECT_03",
    "condition": { "math": [ "has_var(u_gateway_destination_3)" ] },
    "effect": [ { "set_string_var": "npc_gateway_destination_3", "target_var": { "u_val": "dilated_gateway_location" } } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_dilated_gateway_SELECT_04",
    "condition": { "math": [ "has_var(u_gateway_destination_4)" ] },
    "effect": [ { "set_string_var": "npc_gateway_destination_4", "target_var": { "u_val": "dilated_gateway_location" } } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_dilated_gateway_SELECT_05",
    "condition": { "math": [ "has_var(u_gateway_destination_5)" ] },
    "effect": [ { "set_string_var": "npc_gateway_destination_5", "target_var": { "u_val": "dilated_gateway_location" } } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_dilated_gateway_SELECT_06",
    "condition": { "math": [ "has_var(u_gateway_destination_6)" ] },
    "effect": [ { "set_string_var": "npc_gateway_destination_6", "target_var": { "u_val": "dilated_gateway_location" } } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_dilated_gateway_SELECT_07",
    "condition": { "math": [ "has_var(u_gateway_destination_7)" ] },
    "effect": [ { "set_string_var": "npc_gateway_destination_7", "target_var": { "u_val": "dilated_gateway_location" } } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_dilated_gateway_SELECT_08",
    "condition": { "math": [ "has_var(u_gateway_destination_8)" ] },
    "effect": [ { "set_string_var": "npc_gateway_destination_8", "target_var": { "u_val": "dilated_gateway_location" } } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_dilated_gateway_SELECT_09",
    "condition": { "math": [ "has_var(u_gateway_destination_9)" ] },
    "effect": [ { "set_string_var": "npc_gateway_destination_9", "target_var": { "u_val": "dilated_gateway_location" } } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_dilated_gateway_SELECT_10",
    "condition": { "math": [ "has_var(u_gateway_destination_10)" ] },
    "effect": [ { "set_string_var": "npc_gateway_destination_10", "target_var": { "u_val": "dilated_gateway_location" } } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_SUMMON",
    "effect": [
      { "u_spawn_monster": "GROUP_NETHER_BREACH", "group": true, "real_count": [ 1, 3 ], "min_radius": 2, "max_radius": 6 }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_REALITY_TEAR_EFFECTS",
    "//": "Some way of angering factions if done nearby them would be ideal as well.  Cannot find a way to dynamically find nearby faction bases though.",
    "effect": [
      { "u_spawn_monster": "GROUP_NETHER_BREACH", "group": true, "real_count": [ 2, 6 ], "min_radius": 2, "max_radius": 6 }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_TELEPORT_LOCI_TECHNIQUE",
    "condition": { "u_has_effect": "effect_teleport_loci_establishment" },
    "effect": [
      {
        "u_teleport": { "u_val": "teleporter_loci_establishment_loc" },
        "success_message": "You feel a moment of darkness and terrible cold, but you are quickly back at your established locus.",
        "fail_message": "Something goes wrong with the Loci Technique!"
      }
    ],
    "false_effect": [ { "u_message": "You are currently not concentrating on [Î¨]Loci Establishment!" } ]
  }
]
