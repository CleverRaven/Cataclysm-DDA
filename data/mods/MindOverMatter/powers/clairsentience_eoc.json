[
  {
    "type": "effect_on_condition",
    "id": "EOC_CLAIR_DISCERN_WEAKNESS",
    "effect": [
      { "math": [ "u_discern_weakness_clear_intelligence = ( ( n_val('intelligence') + 10) / 20 )" ] },
      { "math": [ "u_discern_weakness_clear_power_level = n_spell_level('clair_spot_weakness')" ] },
      { "math": [ "u_nether_attunement_discern_weakness_scaling = n_nether_attunement_power_scaling" ] },
      {
        "u_add_effect": "effect_clair_weak_point",
        "duration": {
          "math": [
            "rng( ( ( (u_discern_weakness_clear_power_level * 1.5) + 13.5) * u_discern_weakness_clear_intelligence * u_nether_attunement_discern_weakness_scaling),( ( (u_discern_weakness_clear_power_level * 2.5) + 30) * u_discern_weakness_clear_intelligence * u_nether_attunement_discern_weakness_scaling) )"
          ]
        }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CLAIR_RAD_SENSE",
    "effect": [
      {
        "run_eoc_selector": [ "EOC_CLAIR_RAD_SENSE_SELF", "EOC_CLAIR_RAD_SENSE_OUTSIDE", "EOC_PORTAL_NULL_AWAKENING" ],
        "names": [ "Check yourself", "Check your surroundings", "Nevermind" ],
        "keys": [ "1", "2", "3" ],
        "descriptions": [
          "Cast your subtle senses over yourself, seeing if you are contaminated with radiation.",
          "Open your inner eye, searching your environment for dangerous radiation.",
          "Do nothing for now."
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CLAIR_RAD_SENSE_SELF",
    "effect": [ { "u_cast_spell": { "id": "clair_sense_rads_self" } } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CLAIR_RAD_SENSE_OUTSIDE",
    "effect": [
      { "u_cast_spell": { "id": "clair_sense_rads_outside" } },
      { "u_cast_spell": { "id": "clair_sense_rads_outside_spawn_item" } }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CLAIR_RAD_SENSE_OUTSIDE_RECURRING",
    "condition": { "u_has_effect": "effect_clair_sense_rads_self" },
    "deactivate_condition": { "not": { "u_has_trait": "CLAIRSENTIENT" } },
    "recurrence": 10,
    "effect": [
      { "u_remove_item_with": "clair_sense_rad_item" },
      { "u_cast_spell": { "id": "clair_sense_rads_outside_spawn_item" } }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CLAIR_RAD_SENSE_SELF_REPORT",
    "condition": { "math": [ "u_val('rad') <= 0" ] },
    "effect": [
      {
        "u_message": "Turning your senses on yourself, you see none of the insidious glow typical of radiation.  You are in the clear, for now.",
        "type": "good"
      }
    ],
    "false_effect": {
      "run_eocs": [
        {
          "id": "EOC_CLAIR_RAD_SENSE_SELF_REPORT_2",
          "condition": { "and": [ { "math": [ "u_val('rad') > 0" ] }, { "math": [ "u_val('rad') <= 50" ] } ] },
          "effect": [
            {
              "u_message": "Turning your senses on yourself, you see a few dull glimmers, hidden deep in your flesh.  The damage is minimal for now, but you had best not let it fester.",
              "type": "mixed"
            }
          ],
          "false_effect": {
            "run_eocs": [
              {
                "id": "EOC_CLAIR_RAD_SENSE_SELF_REPORT_3",
                "condition": { "and": [ { "math": [ "u_val('rad') >= 51" ] }, { "math": [ "u_val('rad') <= 100" ] } ] },
                "effect": [
                  {
                    "u_message": "Turning your senses on yourself, you see a dull glow along your core.  Your radiation is climbing, though it's still not in the danger zone.",
                    "type": "bad"
                  }
                ],
                "false_effect": { "run_eocs": "EOC_CLAIR_RAD_SENSE_SELF_REPORT_4" }
              }
            ]
          }
        }
      ]
    }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CLAIR_RAD_SENSE_SELF_REPORT_4",
    "condition": { "and": [ { "math": [ "u_val('rad') >= 101" ] }, { "math": [ "u_val('rad') <= 200" ] } ] },
    "effect": [
      {
        "u_message": "Turning your senses on yourself, you see a faint glow spreading outward from your core to your limbs.  You're getting closer to dangerous levels--you should deal with it before it gets worse.",
        "type": "bad"
      }
    ],
    "false_effect": {
      "run_eocs": [
        {
          "id": "EOC_CLAIR_RAD_SENSE_SELF_REPORT_5",
          "condition": { "and": [ { "math": [ "u_val('rad') >= 201" ] }, { "math": [ "u_val('rad') <= 500" ] } ] },
          "effect": [
            {
              "u_message": "Turning your senses on yourself, you see a glow along your bones.  You had best seek treatment, and soon.",
              "type": "bad",
              "popup": true
            }
          ],
          "false_effect": {
            "run_eocs": [
              {
                "id": "EOC_CLAIR_RAD_SENSE_SELF_REPORT_6",
                "condition": { "math": [ "u_val('rad') >= 501" ] },
                "effect": [
                  {
                    "u_message": "Turning your senses on yourself, you see a steady glow all along your muscles and bones.  You are in real trouble if you don't deal with your radiation immediately.",
                    "type": "bad",
                    "popup": true
                  }
                ]
              }
            ]
          }
        }
      ]
    }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CLAIR_EXAMINE_ITEM_INITIATE",
    "effect": [
      {
        "u_run_inv_eocs": "manual",
        "true_eocs": [
          {
            "id": "EOC_CLAIR_EXAMINE_ITEM_DETECTION",
            "effect": [
              { "math": [ "_artifact_resonance = n_artifact_resonance()" ] },
              {
                "math": [ "_resonance_modifier = min( (u_spell_level('clair_examine_item') + u_spell_level('clair_examine_item_knack')),10)" ]
              },
              { "math": [ "_resonance_modifier = (10 - _resonance_modifier) / 50" ] },
              {
                "math": [ "_artifact_resonance = _artifact_resonance * rng( ( 1 - _resonance_modifier), (1 + _resonance_modifier) )" ]
              },
              {
                "if": { "math": [ "_artifact_resonance > 0" ] },
                "then": {
                  "u_message": "The strange object has an otherworldly resonance about it (about <color_light_cyan><context_val:artifact_resonance></color> resonance )."
                }
              },
              {
                "if": { "npc_has_flag": "FIFTH_SUN_TECHNOLOGY" },
                "then": {
                  "u_message": "You have a sense of vast distances from this object, as though it came from a place you would never find on any map.  For a moment, you see an eagle stooping over a snake, wings flashing in the sun, and a vast shape moving through the void between the stars."
                }
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CLAIR_CRAFTING_ADD_BLINDNESS_WHEN_CRAFTING",
    "eoc_type": "EVENT",
    "required_event": "character_starts_activity",
    "condition": {
      "and": [
        { "u_has_effect": "effect_clair_craft_bonus" },
        {
          "or": [
            { "compare_string": [ "ACT_MULTIPLE_CRAFT", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_CRAFT", { "context_val": "activity" } ] }
          ]
        }
      ]
    },
    "effect": [
      { "u_add_effect": "effect_clair_craft_bonus_blindness", "duration": "12 hours" },
      { "u_message": "You close your eyes as the visions overtake you.", "type": "mixed" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CLAIR_CRAFTING_REMOVE_BLINDNESS_WHEN_DONE_CRAFTING",
    "eoc_type": "EVENT",
    "required_event": "character_finished_activity",
    "condition": {
      "and": [
        { "u_has_effect": "effect_clair_craft_bonus" },
        { "u_has_effect": "effect_clair_craft_bonus_blindness" },
        {
          "or": [
            { "compare_string": [ "ACT_MULTIPLE_CRAFT", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_CRAFT", { "context_val": "activity" } ] }
          ]
        }
      ]
    },
    "effect": [
      { "u_lose_effect": "effect_clair_craft_bonus_blindness" },
      { "u_message": "You open your eyes as the visions fade.", "type": "neutral" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CLAIR_ASTRAL_PROJECTION_INITIATE",
    "effect": [
      { "u_location_variable": { "u_val": "clair_astral_projection_original_location" }, "min_radius": 0, "max_radius": 0 },
      { "u_add_effect": "effect_clair_astral_projection", "duration": "PERMANENT" },
      { "u_add_effect": "incorporeal", "duration": "PERMANENT" },
      { "u_message": "As you meditate, you feel your spirit slipping free from your body.", "type": "good" },
      { "u_add_trait": "CLAIR_ASTRAL_PROJECTION_APPEARANCE" },
      { "u_spawn_item": "body_astral_projection", "suppress_message": true },
      { "u_spawn_item": "item_clair_astral_projection_cord", "suppress_message": true, "force_equip": true },
      { "math": [ "u_spell_level('clair_astral_projection_return') = 0" ] }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CLAIR_ASTRAL_PROJECTION_DEACTIVATE",
    "effect": [
      { "u_remove_item_with": "item_clair_astral_projection_cord" },
      { "u_lose_effect": [ "effect_clair_astral_projection", "incorporeal" ] },
      { "u_lose_trait": "CLAIR_ASTRAL_PROJECTION_APPEARANCE" },
      { "math": [ "u_spell_level('clair_astral_projection_passwall') = -1" ] },
      { "math": [ "u_spell_level('clair_astral_projection_return') = -1" ] },
      {
        "u_teleport": { "u_val": "clair_astral_projection_original_location" },
        "success_message": "You snap back into your body once again."
      },
      {
        "u_map_run_item_eocs": "all",
        "min_radius": 0,
        "max_radius": 0,
        "search_data": [ { "id": "body_astral_projection" } ],
        "true_eocs": [ { "id": "EOC_CLAIR_ASTRAL_PROJECTION_DEACTIVATE_REMOVE_BODY", "effect": [ "npc_die" ] } ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CLAIR_ASTRAL_PROJECTION_MOVEMENT_STAMINA",
    "eoc_type": "EVENT",
    "required_event": "avatar_moves",
    "condition": { "u_has_effect": "effect_clair_astral_projection" },
    "effect": [ { "math": [ "u_val('stamina') -= max((75 - (u_spell_level('clair_astral_projection') * 3)), 25)" ] } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CLAIR_ASTRAL_PROJECTION_NO_STAMINA_RETURN",
    "eoc_type": "EVENT",
    "required_event": "avatar_moves",
    "condition": {
      "and": [
        { "u_has_effect": "effect_clair_astral_projection" },
        { "or": [ { "u_has_effect": "winded" }, { "math": [ "u_val('stamina') == 0" ] } ] }
      ]
    },
    "effect": [ { "run_eocs": "EOC_CLAIR_ASTRAL_PROJECTION_DEACTIVATE" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_CLAIR_ASTRAL_PROJECTION_CANT_DO_THAT",
    "eoc_type": "EVENT",
    "required_event": "character_starts_activity",
    "condition": {
      "and": [
        { "u_has_effect": "effect_clair_astral_projection" },
        {
          "or": [
            { "compare_string": [ "ACT_LOCKPICK", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_REPAIR_ITEM", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_MEND_ITEM", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_VEHICLE_REPAIR", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_RELOAD", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_FIRSTAID", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_MILK", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_HACKSAW", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_BOLTCUTTING", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_HAIRCUT", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_SHAVE", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_CRACKING", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_READ", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_EBOOKSAVE", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_TIDY_UP", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_MOP", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_VEHICLE_DECONSTRUCTION", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_VEHICLE_FOLD", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_VEHICLE_UNFOLD", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_BIKERACK_UNRACKING", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_BIKERACK_RACKING", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_MULTIPLE_DIS", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_MULTIPLE_FISH", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_MULTIPLE_CRAFT", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_MULTIPLE_CHOP_PLANKS", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_MULTIPLE_CHOP_TREES", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_MULTIPLE_MINE", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_MULTIPLE_CONSTRUCTION", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_MULTIPLE_MOP", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_MULTIPLE_READ", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_FISH", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_GENERIC_GAME", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_GAME", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_DISASSEMBLE", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_MULTIPLE_FARM", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_HARVEST", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_FIELD_DRESS", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_SKIN", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_QUARTER", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_DISSECT", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_LONGSALVAGE", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_BUILD", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_PICKAXE", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_HAND_CRANK", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_PICKUP", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_AUTODRIVE", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_FERTILIZE_PLOT", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_MOVE_LOOT", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_UNLOAD_LOOT", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_INSERT_ITEM", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_START_FIRE", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_OPEN_GATE", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_FILL_LIQUID", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_SHEARING", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_HOTWIRE_CAR", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_AIM", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_ATM", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_START_ENGINES", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_OXYTORCH", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_TOOLMOD_ADD", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_CLEAR_RUBBLE", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_WASH", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_PRYING", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_CHOP_LOGS", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_CHOP_PLANKS", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_JACKHAMMER", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_CHURN", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_PLANT_SEED", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_WEAR", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_PICKUP", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_WIELD", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_BINDER_COPY_RECIPE", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_DATA_HANDLING", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_FURNITURE_MOVE", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_TENT_PLACE", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_TENT_DECONSTRUCT", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_REEL_CABLE", { "context_val": "activity" } ] },
            { "compare_string": [ "ACT_SALINE_INFUSE", { "context_val": "activity" } ] }
          ]
        }
      ]
    },
    "effect": [
      "u_cancel_activity",
      { "u_message": "You can't perform that activity while in the form of an animal.", "type": "bad" }
    ]
  }
]
