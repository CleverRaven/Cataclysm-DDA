[
  {
    "id": [ "TALK_EVAC_GUARD3" ],
    "type": "talk_topic",
    "responses": [
      {
        "text": "[Premonition] *Determine if <npc_name> is a threat*",
        "topic": "TALK_EVAC_GUARD3_danger_sense",
        "condition": { "math": [ "u_val('spell_level', 'spell: clair_danger_sense')", ">=", "2" ] }
      },
      {
        "text": "[Telepathy] *Read <npc_name>'s mind*",
        "topic": "TALK_EVAC_GUARD3_scan",
        "condition": { "u_has_trait": "TELEPATH" }
      },
      {
        "text": "It's you.",
        "topic": "TALK_EVAC_GUARD3_direct_accusation",
        "condition": { "u_has_var": "deep_scanned_evac_guard_3", "type": "dialogue", "context": "refugee_center_traitor", "value": "yes" }
      }
    ]
  },
  {
    "id": [ "TALK_EVAC_GUARD3_danger_sense" ],
    "type": "talk_topic",
    "dynamic_line": "&You barely open up your senses before you're met with an overpowering sense of menace.  <npc_name> isn't planning to kill you at this exact second but that could change at any moment.",
    "responses": [ { "text": "…", "topic": "TALK_EVAC_GUARD3" } ]
  },
  {
    "id": "TALK_EVAC_GUARD3_scan",
    "type": "talk_topic",
    "dynamic_line": [
      "«Just what I need.  Come on, leave me alone.»",
      "«How am I supposed to…ugh, just go away.»",
      "«Who does this asshole think he is?»"
    ],
    "responses": [
      { "text": "…", "topic": "TALK_EVAC_GUARD3" },
      {
        "text": "[Telepathy 8+] *Go deeper*.",
        "topic": "TALK_EVAC_GUARD3_deep_scan",
        "condition": { "math": [ "u_val('spell_level', 'school: TELEPATH')", ">=", "8" ] }
      }
    ]
  },
  {
    "id": [ "TALK_EVAC_GUARD3_deep_scan" ],
    "type": "talk_topic",
    "dynamic_line": "&It's only a moment, but that's enough.  You are looking from behind a tree onto a road where a crude roadblock has been set up.  There's a refugee bus, one of the same ones parked outside the refugee center, stopped at the roadblock, and as the driver gets out to look at the roadblock, there's a loud crack and two spots of red appear on his chest and leg.  As he begins to fall and the people in the bus start screaming, the raiders emerge from the trees, already running with guns raised.",
    "responses": [
      {
        "text": "*Withdraw from <npc_name>'s mind*.",
        "effect": { "u_add_var": "deep_scanned_evac_guard_3", "type": "dialogue", "context": "refugee_center_traitor", "value": "yes" },
        "topic": "TALK_EVAC_GUARD3_post_scan"
      }
    ]
  },
  {
    "id": [ "TALK_EVAC_GUARD3_post_scan" ],
    "type": "talk_topic",
    "dynamic_line": "&Only a few moments have passed.  <npc_name> hasn't noticed anything amiss.",
    "responses": [
      { "text": "…", "topic": "TALK_EVAC_GUARD3" },
      {
        "text": "It's you.",
        "topic": "TALK_EVAC_GUARD3_direct_accusation",
        "condition": { "u_has_var": "deep_scanned_evac_guard_3", "type": "dialogue", "context": "refugee_center_traitor", "value": "yes" }
      }
    ]
  },
  {
    "id": [ "TALK_EVAC_GUARD3_direct_accusation" ],
    "type": "talk_topic",
    "dynamic_line": "What the hell are you talking about?",
    "responses": [
      {
        "text": "He was only a child, <npc_name>, and you killed him.  Do you remember the blood on his Superman shirt?",
        "topic": "TALK_EVAC_GUARD3_witch",
        "opinion": { "fear": 4 }
      }
    ]
  },
  {
    "id": [ "TALK_EVAC_GUARD3_witch" ],
    "type": "talk_topic",
    "dynamic_line": "I didn't tell you my na-\" <npc_name>'s face goes white. \"What the fuck!  You some kind of freak?",
    "responses": [
      {
        "text": "It's over.  Give up.",
        "topic": "TALK_EVAC_GUARD3_DEAD",
        "effect": { "npc_change_faction": "hells_raiders" }
      }
    ]
  },
  {
    "id": "TALK_EVAC_GUARD3_DEAD",
    "type": "talk_topic",
    "responses": [
      {
        "text": "[Telekinesis Check] *Try to rip <npc_name>'s weapon away*",
        "condition": { "u_has_trait": "TELEKINETIC" },
        "switch": false,
        "trial": {
          "type": "CONDITION",
          "condition": {
            "roll_contested": { "math": [ "u_val('spell_level', 'school: TELEKINETIC')" ] },
            "difficulty": { "math": [ "n_val('strength')" ] },
            "die_size": 5
          }
        },
        "success": { "topic": "TALK_DONE", "effect": "drop_weapon" },
        "failure": { "topic": "TALK_DONE" }
      },
      {
        "text": "[Sensory Deprivation Check] *Shut off <npc_name>'s senses*.",
        "condition": { "math": [ "u_val('spell_level', 'spell: telepathic_confusion')", ">=", "1" ] },
        "switch": false,
        "trial": {
          "type": "CONDITION",
          "condition": {
            "and": [
              {
                "roll_contested": { "math": [ "u_val('spell_level', 'spell: telepathic_confusion')" ] },
                "difficulty": { "math": [ "n_val('perception')" ] },
                "die_size": 10
              },
              { "not": { "npc_has_trait": "NPC_TELEPATHY_IMMUNE" } }
            ]
          }
        },
        "success": {
          "topic": "TALK_DONE",
          "effect": [ "hostile", { "npc_add_effect": "blind", "duration": "30 s" }, { "npc_add_effect": "deaf", "duration": "30 s" } ]
        },
        "failure": {
          "topic": "TALK_DONE",
          "effect": [ "hostile", { "u_message": "You failed to affect <npc_name>'s senses!", "type": "bad" } ]
        }
      },
      {
        "text": "[Synaptic Overload Check] *Attack <npc_name>'s mind*.",
        "condition": { "and": [ { "math": [ "u_val('spell_level', 'spell: telepathic_blast')", ">=", "1" ] } ] },
        "switch": false,
        "trial": {
          "type": "CONDITION",
          "condition": {
            "and": [
              {
                "roll_contested": { "math": [ "u_val('spell_level', 'spell: telepathic_blast')" ] },
                "difficulty": { "math": [ "n_val('intelligence')" ] },
                "die_size": 10
              },
              { "not": { "npc_has_trait": "NPC_TELEPATHY_IMMUNE" } }
            ]
          }
        },
        "success": {
          "topic": "TALK_DONE",
          "effect": [
            "hostile",
            {
              "npc_set_hp": { "math": [ "(80 - (6 * (u_val('spell_level', 'spell: telepathic_blast'))))" ] },
              "target_part": "head"
            },
            { "npc_add_effect": "stunned", "duration": "2 s" }
          ]
        },
        "failure": {
          "topic": "TALK_DONE",
          "effect": [ "hostile", { "u_message": "<npc_name> repelled your attack on their mind!", "type": "bad" } ]
        }
      },
      {
        "text": "[Transposition Check] *Teleport away <npc_name>'s weapon*.",
        "condition": { "math": [ "u_val('spell_level', 'spell: teleport_transpose')", ">=", "1" ] },
        "switch": false,
        "trial": {
          "type": "CONDITION",
          "condition": {
            "roll_contested": { "math": [ "u_val('spell_level', 'spell: teleport_transpose')" ] },
            "difficulty": 10,
            "die_size": 10
          }
        },
        "success": {
          "topic": "TALK_DONE",
          "effect": [
            { "npc_consume_item": "spear_knife_proper", "popup": false },
            { "npc_consume_item": "spear_pipe", "popup": false },
            { "npc_consume_item": "spear_homemade_halfpike", "popup": false },
            { "npc_consume_item": "makeshift_glaive", "popup": false },
            { "npc_consume_item": "spear_knife_proper", "popup": false },
            { "npc_consume_item": "spear_knife_proper", "popup": false },
            { "npc_consume_item": "spear_knife_proper", "popup": false },
            { "npc_consume_item": "spear_knife_proper", "popup": false },
            { "npc_consume_item": "spear_knife_proper", "popup": false },
            { "npc_consume_item": "spear_knife_proper", "popup": false }
          ]
        },
        "failure": {
          "topic": "TALK_DONE",
          "effect": [ "hostile", { "u_message": "You failed to teleport <npc_name>'s weapon!", "type": "bad" } ]
        }
      },
      {
        "text": "[Oubliette Check] *Banish <npc_name> to another dimension*.",
        "condition": { "math": [ "u_val('spell_level', 'spell: teleport_banish')", ">=", "1" ] },
        "switch": false,
        "trial": {
          "type": "CONDITION",
          "condition": { "roll_contested": { "math": [ "u_val('spell_level', 'spell: teleport_banish')" ] }, "difficulty": 15, "die_size": 10 }
        },
        "success": {
          "topic": "TALK_DONE",
          "effect": [
            { "npc_add_effect": "stunned", "duration": "2 s" },
            { "queue_eocs": [ "EOC_REMOVE_REFUGEE_CENTER_TRAITOR_BANISHED" ], "time_in_future": "1 seconds" }
          ]
        },
        "failure": { "topic": "TALK_DONE", "effect": [ "hostile", { "u_message": "You failed to teleport <npc_name>!", "type": "bad" } ] }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_REMOVE_REFUGEE_CENTER_TRAITOR_BANISHED",
    "effect": [ { "mapgen_update": "remove_refugee_center_traitor_because_banished" } ]
  },
  {
    "type": "mapgen",
    "method": "json",
    "update_mapgen_id": "remove_refugee_center_traitor_because_banished",
    "object": { "remove_npcs": [ { "class": "NC_FREE_MERCH_GUARD", "x": [ 0, 23 ], "y": [ 0, 23 ], "unique_id": "evac_guard3" } ] }
  }
]
