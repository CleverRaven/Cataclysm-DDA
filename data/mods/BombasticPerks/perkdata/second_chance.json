[
  {
    "type": "mutation",
    "id": "perk_second_chance_limiter",
    "name": { "str": "Second Chance Limiter", "//~": "NO_I18N" },
    "points": 0,
    "purifiable": false,
    "valid": false,
    "player_display": false,
    "description": { "str": "You used up your second chance perk and it won't work again.", "//~": "NO_I18N" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PERK_SECOND_CHANCE_PREVENTION",
    "eoc_type": "PREVENT_DEATH",
    "condition": { "and": [ { "u_has_trait": "perk_second_chance" }, { "not": { "u_has_trait": "perk_second_chance_limiter" } } ] },
    "effect": [
      { "u_message": "As the wounds overtake you, you feel a surge of inner strength.", "popup": true },
      { "run_eocs": [ "EOC_PERK_SECOND_CHANCE_PREVENTION_ACTIVATE" ] }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PERK_SECOND_CHANCE_PREVENTION_ACTIVATE",
    "condition": { "u_has_trait": "perk_second_chance" },
    "effect": [
      { "math": [ "u_pain() = 0" ] },
      { "math": [ "u_hp('ALL_MINOR') = 999" ] },
      { "math": [ "u_hp('torso') = max( u_hp('torso'), 10)" ] },
      { "math": [ "u_hp('head') = max( u_hp('head'), 10)" ] },
      { "math": [ "u_hp('arm_l') = max( u_hp('arm_l'), 10)" ] },
      { "math": [ "u_hp('arm_r') = max( u_hp('arm_r'), 10)" ] },
      { "math": [ "u_hp('leg_l') = max( u_hp('leg_l'), 10)" ] },
      { "math": [ "u_hp('leg_r') = max( u_hp('leg_r'), 10)" ] },
      { "u_lose_effect": [ "onfire", "dazed", "downed", "bleed", "blind", "deaf", "stunned" ] },
      { "u_add_trait": "perk_second_chance_limiter" },
      { "u_add_effect": "effect_perk_second_chance", "duration": 5 }
    ]
  },
  {
    "type": "effect_type",
    "id": "effect_perk_second_chance",
    "name": [ "Surge of Energy" ],
    "desc": [ "You are filled with vitality!" ],
    "remove_message": "Your surge of vitality fades away!",
    "max_duration": "5 s",
    "max_intensity": 5,
    "int_dur_factor": "1 s",
    "rating": "good",
    "removes_effects": [ "dazed", "downed", "bleed", "blind", "deaf", "stunned" ],
    "enchantments": [
      {
        "condition": "ALWAYS",
        "values": [
          { "value": "EVASION", "add": 1 },
          { "value": "CLIMATE_CONTROL_HEAT", "add": 2000 },
          { "value": "CLIMATE_CONTROL_CHILL", "add": 2000 }
        ]
      }
    ],
    "scaling_mods": { "stamina_min": [ 2000 ], "stamina_max": [ 4500 ], "stamina_chance": [ 1 ] },
    "flags": [ "PAIN_IMMUNE" ]
  }
]
