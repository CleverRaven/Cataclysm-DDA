[
  {
    "type": "effect_type",
    "id": "effect_perk_second_wind_cooldown",
    "//": "Hidden effect",
    "name": [ "" ],
    "desc": [ "" ]
  },
  {
    "type": "effect_type",
    "id": "effect_perk_second_wind_currently_active",
    "//": "Hidden effect",
    "name": [ "" ],
    "desc": [ "" ]
  },
  {
    "type": "activity_type",
    "id": "ACT_PERK_SECOND_WIND",
    "activity_level": "NO_EXERCISE",
    "verb": "catching your breath",
    "rooted": false,
    "based_on": "time",
    "do_turn_eoc": "EOC_ACT_PERK_SECOND_WIND"
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_perk_second_wind",
    "condition": { "not": { "u_has_effect": "effect_perk_second_wind_cooldown" } },
    "effect": [
      {
        "if": { "not": { "math": [ "has_var(u_perk_second_wind_max_stamina)" ] } },
        "then": { "math": [ "u_perk_second_wind_max_stamina = 8500" ] }
      },
      { "u_add_effect": "effect_perk_second_wind_cooldown", "duration": "15 minutes" },
      { "u_add_effect": "effect_perk_second_wind_currently_active", "duration": "10 seconds" },
      { "u_assign_activity": "ACT_PERK_SECOND_WIND", "duration": "10 seconds" },
      { "u_message": "You take a moment and catch your breath.", "type": "good" }
    ],
    "false_effect": [ { "u_message": "You need more time really rest before you can get your second wind back.", "type": "bad" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_ACT_PERK_SECOND_WIND",
    "condition": { "u_has_effect": "effect_perk_second_wind_currently_active" },
    "effect": [ { "math": [ "u_val('stamina') += (u_perk_second_wind_max_stamina * .033333333333333333333333333333)" ] } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PERK_SECOND_WIND_TAKE_DAMAGE",
    "eoc_type": "EVENT",
    "required_event": "character_takes_damage",
    "condition": { "and": [ { "u_has_trait": "perk_second_wind" }, { "u_has_effect": "effect_perk_second_wind_currently_active" } ] },
    "effect": [ { "u_lose_effect": "effect_perk_second_wind_currently_active" }, "u_cancel_activity" ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_PERK_SECOND_WIND_CHECK_STAMINA",
    "//": "There's currently no way to check max stamina so we need to use this.",
    "eoc_type": "EVENT",
    "required_event": "character_wakes_up",
    "condition": { "u_has_trait": "perk_second_wind" },
    "effect": [ { "math": [ "u_perk_second_wind_max_stamina = u_val('stamina')" ] } ]
  }
]
