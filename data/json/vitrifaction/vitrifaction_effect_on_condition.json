[
  {
    "type": "effect_on_condition",
    "id": "EOC_vitrified_farm_entry",
    "recurrence": "1 seconds",
    "condition": {
      "and": [
        { "or": [ { "u_at_om_location": "unvitrified_farm_0" }, { "u_at_om_location": "unvitrified_orchard" } ] },
        { "and": [ { "not": { "u_has_effect": "VITRIFYING" } }, { "not": { "u_has_trait": "NOT_GLASS" } } ] }
      ]
    },
    "effect": {
      "run_eocs": [
        {
          "id": "EOC_vitrified_no_map",
          "effect": {
            "place_override": { "global_val": "place_name", "default_str": "Quiet Farmhouse" },
            "length": "1 day",
            "key": "vitrified_farm_escape_key"
          }
        },
        {
          "id": "EOC_setup_vitrified_farm",
          "effect": [
            {
              "u_location_variable": { "global_val": "vitrified_farm_ground" },
              "target_params": { "om_terrain": "unvitrified_farm_0", "search_range": 100, "min_distance": 0, "z": 0 },
              "z_adjust": 7,
              "z_override": true
            },
            {
              "u_location_variable": { "global_val": "vitrified_farm_upper" },
              "target_params": { "om_terrain": "unvitrified_farm_1", "search_range": 100, "min_distance": 0, "z": 0 },
              "z_adjust": 8,
              "z_override": true
            },
            {
              "u_location_variable": { "global_val": "vitrified_farm_basement" },
              "target_params": { "om_terrain": "unvitrified_farm_-1", "search_range": 100, "min_distance": 0, "z": 0 },
              "z_adjust": 6,
              "z_override": true
            },
            {
              "u_location_variable": { "global_val": "vitrified_farm_roof" },
              "target_params": { "om_terrain": "unvitrified_farm_2", "search_range": 100, "min_distance": 0, "z": 0 },
              "z_adjust": 9,
              "z_override": true
            },
            {
              "u_location_variable": { "global_val": "vitrified_apples" },
              "target_params": { "om_terrain": "unvitrified_orchard", "search_range": 100, "min_distance": 0, "z": 0 },
              "z_adjust": 7,
              "z_override": true
            },
            {
              "revert_location": { "global_val": "vitrified_farm_ground" },
              "time_in_future": "infinite",
              "key": "vitrified_farm_escape_key"
            },
            {
              "revert_location": { "global_val": "vitrified_farm_upper" },
              "time_in_future": "infinite",
              "key": "vitrified_farm_escape_key"
            },
            {
              "revert_location": { "global_val": "vitrified_farm_basement" },
              "time_in_future": "infinite",
              "key": "vitrified_farm_escape_key"
            },
            {
              "revert_location": { "global_val": "vitrified_farm_roof" },
              "time_in_future": "infinite",
              "key": "vitrified_farm_escape_key"
            },
            {
              "revert_location": { "global_val": "vitrified_apples" },
              "time_in_future": "infinite",
              "key": "vitrified_farm_escape_key"
            },
            { "mapgen_update": "vitrified_farm_0", "target_var": { "global_val": "vitrified_farm_ground" } },
            { "mapgen_update": "vitrified_farm_1", "target_var": { "global_val": "vitrified_farm_upper" } },
            { "mapgen_update": "vitrified_farm_-1", "target_var": { "global_val": "vitrified_farm_basement" } },
            { "mapgen_update": "vitrified_farm_2", "target_var": { "global_val": "vitrified_farm_roof" } },
            { "mapgen_update": "vitrified_orchard", "target_var": { "global_val": "vitrified_apples" } }
          ]
        },
        {
          "id": "EOC_entrynorth",
          "condition": { "or": [ { "u_is_on_terrain": "t_quietfarm_north_ground" }, { "u_is_on_terrain": "t_quietfarm_north_fence" } ] },
          "effect": [
            { "u_location_variable": { "u_val": "vitrifaction_entry" }, "x_adjust": 0, "y_adjust": 1, "z_adjust": 7 },
            { "u_teleport": { "u_val": "vitrifaction_entry" }, "fail_message": "Oops!", "force": true }
          ]
        },
        {
          "id": "EOC_entrysouth",
          "condition": { "u_is_on_terrain": "t_quietfarm_south_fence" },
          "effect": [
            { "u_location_variable": { "u_val": "vitrifaction_entry" }, "x_adjust": 0, "y_adjust": -1, "z_adjust": 7 },
            { "u_teleport": { "u_val": "vitrifaction_entry" }, "fail_message": "Oops!", "force": true }
          ]
        },
        {
          "id": "EOC_entrywest",
          "condition": { "u_is_on_terrain": "t_quietfarm_west_fence" },
          "effect": [
            { "u_location_variable": { "u_val": "vitrifaction_entry" }, "x_adjust": -1, "y_adjust": 0, "z_adjust": 7 },
            { "u_teleport": { "u_val": "vitrifaction_entry" }, "fail_message": "Oops!", "force": true }
          ]
        },
        {
          "id": "EOC_entryeast",
          "condition": { "u_is_on_terrain": "t_quietfarm_east_fence" },
          "effect": [
            { "u_location_variable": { "u_val": "vitrifaction_entry" }, "x_adjust": 1, "y_adjust": 0, "z_adjust": 7 },
            { "u_teleport": { "u_val": "vitrifaction_entry" }, "fail_message": "Oops!", "force": true }
          ]
        },
        {
          "id": "EOC_vitrifiaction_entry_message",
          "effect": {
            "u_message": "You arrive at the farmhouse, after what feels like an eternity. It's not quite what you were expecting, but it's very peaceful.",
            "type": "good",
            "popup": true
          }
        },
        {
          "id": "EOC_enter_vitrify_effect",
          "effect": [
            { "math": [ "vitrified", "=", "1" ] },
            { "math": [ "glassed", "=", "0" ] },
            { "u_add_effect": "VITRIFYING", "duration": "PERMANENT", "intensity": { "math": [ "vitrified" ] } }
          ]
        }
      ]
    }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_vitrified_farm_explore",
    "recurrence": "1 seconds",
    "condition": {
      "and": [
        {
          "or": [
            { "u_at_om_location": "vitrified_farm_0" },
            { "u_at_om_location": "vitrified_farm_1" },
            { "u_at_om_location": "vitrified_farm_2" },
            { "u_at_om_location": "vitrified_farm_-1" },
            { "u_at_om_location": "vitrified_orchard" }
          ]
        },
        { "u_has_effect": "VITRIFYING" }
      ]
    },
    "effect": {
      "run_eocs": [
        {
          "id": "EOC_vitrified_int_check_1",
          "recurrence": "1 minute",
          "condition": { "u_has_effect": "VITRIFYING", "intensity": 1 },
          "effect": {
            "run_eocs": [
              {
                "id": "EOC_vitrified_ambient_message_1",
                "effect": [ { "u_message": "Vitrifaction_Ambient_1", "snippet": true }, { "math": [ "glassed", "++" ] } ]
              },
              "EOC_vitrified_int_drain"
            ]
          }
        },
        {
          "id": "EOC_vitrified_int_check_2",
          "recurrence": "1 minute",
          "condition": { "u_has_effect": "VITRIFYING", "intensity": 2 },
          "effect": {
            "run_eocs": [
              {
                "id": "EOC_vitrified_ambient_message_2",
                "effect": { "u_message": "Vitrifaction_Ambient_2", "snippet": true },
                "math": [ "glassed", "++" ]
              },
              "EOC_vitrified_int_drain"
            ]
          }
        },
        {
          "id": "EOC_vitrified_int_check_3",
          "recurrence": "1 minute",
          "condition": { "u_has_effect": "VITRIFYING", "intensity": 3 },
          "effect": {
            "run_eocs": [
              {
                "id": "EOC_vitrified_ambient_message_3",
                "effect": { "u_message": "Vitrifaction_Ambient_3", "snippet": true },
                "math": [ "glassed", "++" ]
              },
              "EOC_vitrified_int_drain"
            ]
          }
        },
        {
          "id": "EOC_vitrified_int_check_4",
          "recurrence": "1 minute",
          "condition": { "u_has_effect": "VITRIFYING", "intensity": 4 },
          "effect": {
            "run_eocs": [
              {
                "id": "EOC_vitrified_ambient_message_4",
                "effect": { "u_message": "Vitrifaction_Ambient_4", "snippet": true },
                "math": [ "glassed", "++" ]
              },
              "EOC_vitrified_int_drain"
            ]
          }
        },
        {
          "id": "EOC_vitrified_int_check_5",
          "recurrence": "1 minute",
          "condition": { "u_has_effect": "VITRIFYING", "intensity": 5 },
          "effect": {
            "run_eocs": [
              {
                "id": "EOC_vitrified_ambient_message_5",
                "effect": { "u_message": "Vitrifaction_Ambient_5", "snippet": true },
                "math": [ "glassed", "++" ]
              },
              "EOC_vitrified_int_drain"
            ]
          }
        },
        {
          "id": "EOC_vitrified_int_check_6",
          "recurrence": "1 minute",
          "condition": { "u_has_effect": "VITRIFYING", "intensity": 6 },
          "effect": {
            "run_eocs": [
              {
                "id": "EOC_vitrified_ambient_message_6",
                "effect": { "u_message": "Vitrifaction_Ambient_6", "snippet": true },
                "math": [ "glassed", "++" ]
              },
              "EOC_vitrified_int_drain"
            ]
          }
        },
        {
          "id": "EOC_vitrified_int_check_7",
          "recurrence": "1 seconds",
          "condition": { "u_has_effect": "VITRIFYING", "intensity": 7 },
          "effect": [ { "u_message": "Vitrifaction_Final", "snippet": true, "popup": true }, { "u_set_hp": 0 } ]
        }
      ]
    }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_vitrified_int_drain",
    "EOC_TYPE": "ACTIVATION",
    "condition": { "and": [ { "x_in_y_chance": { "x": 1, "y": 3 } }, { "math": [ "glassed", ">=", "4" ] } ] },
    "effect": [
      { "math": [ "vitrified", "++" ] },
      { "u_add_effect": "VITRIFYING", "duration": "PERMANENT", "intensity": { "math": [ "vitrified" ] } },
      { "math": [ "glassed", "=", "0" ] }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_queue_unvitrified_return",
    "effect": { "queue_eocs": "EOC_unvitrified_return", "time_in_future": "1 seconds" }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_unvitrified_return",
    "effect": [
      { "u_lose_effect": "VITRFYING" },
      { "u_add_trait": "NOT_GLASS" },
      { "u_location_variable": { "u_val": "vitrifaction_exit" }, "x_adjust": 0, "y_adjust": 0, "z_adjust": -7 },
      { "u_teleport": { "u_val": "vitrifaction_exit" }, "fail_message": "Oops!", "force": true },
      { "u_remove_item_with": "imperfect_doll_complete" },
      { "u_remove_item_with": "black_glass_shard" },
      { "alter_timed_events": "vitrified_farm_escape_key" },
      {
        "u_message": "You suck in a deep, ragged draught of air that burns in your chest. Have you been holding your breath? You must have been. All you can hear for a moment is your heart hammering in your ears. It takes a while to settle down.",
        "type": "good",
        "popup": true
      }
    ]
  }
]
