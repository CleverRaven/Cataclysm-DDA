[
  {
    "type": "effect_on_condition",
    "id": "EOC_GIVE_RANDOM_MISSION",
    "condition": { "or": [ { "u_has_trait": "GETS_RANDOM_MISSION" }, { "u_has_trait": "GETS_RANDOM_MISSION_NOMOVE" } ] },
    "effect": [
      {
        "weighted_list_eocs": [
          [
            {
              "id": "give_MISSION_GET_RELIC",
              "condition": { "or": [ { "u_has_trait": "GETS_RANDOM_MISSION" }, { "u_has_trait": "GETS_RANDOM_MISSION_NOMOVE" } ] },
              "effect": { "offer_mission": "MISSION_GET_RELIC" }
            },
            1
          ],
          [
            {
              "id": "give_MISSION_GET_RECORD_ACCOUNTING",
              "condition": { "u_has_trait": "GETS_RANDOM_MISSION" },
              "effect": { "offer_mission": "MISSION_GET_RECORD_ACCOUNTING" }
            },
            1
          ],
          [
            {
              "id": "give_MISSION_GET_INHALER",
              "condition": { "or": [ { "u_has_trait": "GETS_RANDOM_MISSION" }, { "u_has_trait": "GETS_RANDOM_MISSION_NOMOVE" } ] },
              "effect": { "offer_mission": "MISSION_GET_INHALER" }
            },
            1
          ],
          [
            {
              "id": "give_MISSION_GET_ANTIBIOTICS",
              "condition": { "or": [ { "u_has_trait": "GETS_RANDOM_MISSION" }, { "u_has_trait": "GETS_RANDOM_MISSION_NOMOVE" } ] },
              "effect": { "offer_mission": "MISSION_GET_ANTIBIOTICS" }
            },
            1
          ],
          [
            {
              "id": "give_MISSION_GET_FLAG",
              "condition": { "or": [ { "u_has_trait": "GETS_RANDOM_MISSION" }, { "u_has_trait": "GETS_RANDOM_MISSION_NOMOVE" } ] },
              "effect": { "offer_mission": "MISSION_GET_FLAG" }
            },
            1
          ],
          [
            {
              "id": "give_MISSION_GET_RECORD_WEATHER",
              "condition": { "or": [ { "u_has_trait": "GETS_RANDOM_MISSION" }, { "u_has_trait": "GETS_RANDOM_MISSION_NOMOVE" } ] },
              "effect": { "offer_mission": "MISSION_GET_RECORD_WEATHER" }
            },
            1
          ],
          [
            {
              "id": "give_MISSION_GET_SOFTWARE",
              "condition": { "or": [ { "u_has_trait": "GETS_RANDOM_MISSION" }, { "u_has_trait": "GETS_RANDOM_MISSION_NOMOVE" } ] },
              "effect": { "offer_mission": "MISSION_GET_SOFTWARE" }
            },
            1
          ],
          [
            {
              "id": "give_MISSION_GET_RECORD_PATIENT",
              "condition": { "u_has_trait": "GETS_RANDOM_MISSION" },
              "effect": { "offer_mission": "MISSION_GET_RECORD_PATIENT" }
            },
            1
          ],
          [
            {
              "id": "give_MISSION_KILL_JABBERWOCK",
              "condition": { "or": [ { "u_has_trait": "GETS_RANDOM_MISSION" }, { "u_has_trait": "GETS_RANDOM_MISSION_NOMOVE" } ] },
              "effect": { "offer_mission": "MISSION_KILL_JABBERWOCK" }
            },
            1
          ],
          [
            {
              "id": "give_MISSION_KILL_ZOMBIE_MOM",
              "condition": { "or": [ { "u_has_trait": "GETS_RANDOM_MISSION" }, { "u_has_trait": "GETS_RANDOM_MISSION_NOMOVE" } ] },
              "effect": { "offer_mission": "MISSION_KILL_ZOMBIE_MOM" }
            },
            1
          ],
          [
            {
              "id": "give_MISSION_RESCUE_DOG",
              "condition": { "or": [ { "u_has_trait": "GETS_RANDOM_MISSION" }, { "u_has_trait": "GETS_RANDOM_MISSION_NOMOVE" } ] },
              "effect": { "offer_mission": "MISSION_RESCUE_DOG" }
            },
            1
          ],
          [
            {
              "id": "give_MISSION_PROVE_YOU_ARE_A_SURVIVOR",
              "condition": { "u_has_trait": "GETS_RANDOM_MISSION" },
              "effect": { "offer_mission": "MISSION_PROVE_YOU_ARE_A_SURVIVOR" }
            },
            1
          ],
          [
            {
              "id": "give_MISSION_LEARN_ABOUT_CATTAIL_JELLY",
              "condition": { "or": [ { "u_has_trait": "GETS_RANDOM_MISSION" }, { "u_has_trait": "GETS_RANDOM_MISSION_NOMOVE" } ] },
              "effect": { "offer_mission": "MISSION_LEARN_ABOUT_CATTAIL_JELLY" }
            },
            1
          ],
          [
            {
              "id": "give_MISSION_PYROMANIAC",
              "condition": { "u_has_trait": "GETS_RANDOM_MISSION" },
              "effect": { "offer_mission": "MISSION_PYROMANIAC" }
            },
            1
          ]
        ]
      },
      { "u_lose_trait": "GETS_RANDOM_MISSION" },
      { "u_lose_trait": "GETS_RANDOM_MISSION_NOMOVE" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_MISSION_GET_DRIVEBELTS_done",
    "global": true,
    "condition": { "u_has_items": { "item": "drivebelt", "count": 3 } },
    "effect": [ { "u_sell_item": "drivebelt", "count": 3 } ],
    "false_effect": [ { "u_sell_item": "drivebelt_makeshift", "count": 3 } ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_MISSION_LUMBERMILL_GET_6_BLANKETS_done",
    "global": true,
    "condition": {
      "or": [
        { "u_has_items": { "item": "blanket", "count": 6 } },
        { "u_has_items": { "item": "fur_blanket", "count": 6 } },
        { "u_has_items": { "item": "electric_blanket", "count": 6 } },
        { "u_has_items": { "item": "quilt", "count": 6 } },
        { "u_has_items": { "item": "quilt_patchwork", "count": 6 } }
      ]
    },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "sell_blanket",
            "condition": { "u_has_items": { "item": "blanket", "count": 6 } },
            "effect": { "u_sell_item": "blanket", "count": 6 }
          },
          {
            "id": "sell_fur_blanket",
            "condition": { "u_has_items": { "item": "fur_blanket", "count": 6 } },
            "effect": { "u_sell_item": "fur_blanket", "count": 6 }
          },
          {
            "id": "sell_electric_blanket",
            "condition": { "u_has_items": { "item": "electric_blanket", "count": 6 } },
            "effect": { "u_sell_item": "electric_blanket", "count": 6 }
          },
          {
            "id": "sell_quilt",
            "condition": { "u_has_items": { "item": "quilt", "count": 6 } },
            "effect": { "u_sell_item": "quilt", "count": 6 }
          },
          {
            "id": "sell_quilt_patchwork",
            "condition": { "u_has_items": { "item": "quilt_patchwork", "count": 6 } },
            "effect": { "u_sell_item": "quilt_patchwork", "count": 6 }
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_MISSION_GODCO_TROPHY2_done",
    "global": true,
    "condition": {
      "or": [
        { "u_has_items": { "item": "egg_spider_cellar", "count": 1 } },
        { "u_has_items": { "item": "egg_spider_jumping", "count": 1 } },
        { "u_has_items": { "item": "egg_spider_trapdoor", "count": 1 } },
        { "u_has_items": { "item": "egg_spider_web", "count": 1 } },
        { "u_has_items": { "item": "egg_spider_widow", "count": 1 } },
        { "u_has_items": { "item": "egg_spider_wolf", "count": 1 } }
      ]
    },
    "effect": [
      {
        "run_eocs": [
          {
            "id": "sell_egg_spider_cellar",
            "condition": { "u_has_items": { "item": "egg_spider_cellar", "count": 1 } },
            "effect": { "u_sell_item": "egg_spider_cellar", "count": 1 }
          },
          {
            "id": "sell_egg_spider_jumping",
            "condition": { "u_has_items": { "item": "egg_spider_jumping", "count": 1 } },
            "effect": { "u_sell_item": "egg_spider_jumping", "count": 1 }
          },
          {
            "id": "sell_egg_spider_trapdoor",
            "condition": { "u_has_items": { "item": "egg_spider_trapdoor", "count": 1 } },
            "effect": { "u_sell_item": "egg_spider_trapdoor", "count": 1 }
          },
          {
            "id": "sell_egg_spider_web",
            "condition": { "u_has_items": { "item": "egg_spider_web", "count": 1 } },
            "effect": { "u_sell_item": "egg_spider_web", "count": 1 }
          },
          {
            "id": "sell_egg_spider_widow",
            "condition": { "u_has_items": { "item": "egg_spider_widow", "count": 1 } },
            "effect": { "u_sell_item": "egg_spider_widow", "count": 1 }
          },
          {
            "id": "sell_egg_spider_wolf",
            "condition": { "u_has_items": { "item": "egg_spider_wolf", "count": 1 } },
            "effect": { "u_sell_item": "egg_spider_wolf", "count": 1 }
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_BANDIT_ASSASSIN",
    "recurrence": [ "60 days", "100 days" ],
    "global": true,
    "condition": {
      "and": [
        { "math": [ "faction_like('hells_raiders')", "<", "-40" ] },
        { "math": [ "faction_like('hells_raiders')", ">", "-60" ] },
        { "math": [ "u_bandit_assassins_sent", "<=", "10" ] },
        { "math": [ "time_since('cataclysm', 'unit':'days') >= 9" ] },
        { "not": { "is_weather": "portal_storm" } },
        { "not": { "u_near_om_location": "godco_enter", "range": 8 } },
        { "not": { "u_near_om_location": "evac_center_18", "range": 4 } },
        { "not": { "u_near_om_location": "pagan_cult_enter", "range": 4 } },
        { "not": { "u_near_om_location": "lumbermill_0_0_ocu", "range": 4 } },
        { "not": { "u_near_om_location": "smallscrapyard_ocu", "range": 4 } }
      ]
    },
    "effect": [
      { "u_spawn_npc": "hells_raiders_assassin", "real_count": 1, "min_radius": 15, "max_radius": 25 },
      { "math": [ "u_bandit_assassins_sent", "++" ] }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_BANDIT_ASSASSIN_2",
    "recurrence": [ "60 days", "100 days" ],
    "global": true,
    "condition": {
      "and": [
        { "math": [ "faction_like('hells_raiders')", "<", "-60" ] },
        { "math": [ "faction_like('hells_raiders')", ">", "-90" ] },
        { "math": [ "u_bandit_assassins_sent", "<=", "10" ] },
        { "math": [ "time_since('cataclysm', 'unit':'days') >= 15" ] },
        { "not": { "is_weather": "portal_storm" } },
        { "not": { "u_near_om_location": "godco_enter", "range": 8 } },
        { "not": { "u_near_om_location": "evac_center_18", "range": 4 } },
        { "not": { "u_near_om_location": "pagan_cult_enter", "range": 4 } },
        { "not": { "u_near_om_location": "lumbermill_0_0_ocu", "range": 4 } },
        { "not": { "u_near_om_location": "smallscrapyard_ocu", "range": 4 } }
      ]
    },
    "effect": [
      { "u_spawn_npc": "hells_raiders_assassin", "real_count": 2, "min_radius": 15, "max_radius": 25 },
      { "math": [ "u_bandit_assassins_sent", "+=", "2" ] }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_BANDIT_ASSASSIN_3",
    "recurrence": [ "60 days", "100 days" ],
    "global": true,
    "condition": {
      "and": [
        { "math": [ "faction_like('hells_raiders')", "<", "-90" ] },
        { "math": [ "u_bandit_assassins_sent", "<=", "10" ] },
        { "math": [ "time_since('cataclysm', 'unit':'days') >= 21" ] },
        { "not": { "is_weather": "portal_storm" } },
        { "not": { "u_near_om_location": "godco_enter", "range": 8 } },
        { "not": { "u_near_om_location": "evac_center_18", "range": 4 } },
        { "not": { "u_near_om_location": "pagan_cult_enter", "range": 4 } },
        { "not": { "u_near_om_location": "lumbermill_0_0_ocu", "range": 4 } },
        { "not": { "u_near_om_location": "smallscrapyard_ocu", "range": 4 } }
      ]
    },
    "effect": [
      { "u_spawn_npc": "hells_raiders_assassin", "real_count": 3, "min_radius": 15, "max_radius": 25 },
      { "math": [ "u_bandit_assassins_sent", "+=", "3" ] }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_OLD_GUARD_ASSASSIN",
    "recurrence": [ "60 days", "100 days" ],
    "global": true,
    "condition": {
      "and": [
        { "math": [ "faction_like('old_guard')", "<", "-45" ] },
        { "math": [ "u_government_assassins_sent", "<=", "6" ] },
        { "math": [ "time_since('cataclysm', 'unit':'days') >= 9" ] },
        { "not": { "is_weather": "portal_storm" } },
        { "not": { "u_near_om_location": "godco_enter", "range": 8 } },
        { "not": { "u_near_om_location": "evac_center_18", "range": 4 } },
        { "not": { "u_near_om_location": "pagan_cult_enter", "range": 4 } },
        { "not": { "u_near_om_location": "lumbermill_0_0_ocu", "range": 4 } },
        { "not": { "u_near_om_location": "smallscrapyard_ocu", "range": 4 } }
      ]
    },
    "effect": [
      { "u_spawn_npc": "old_guard_assassin", "real_count": 2, "min_radius": 15, "max_radius": 25 },
      { "math": [ "u_government_assassins_sent", "+=", "2" ] }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_REFUGEE_CENTER_NPC_MOVEMENT",
    "//": "Runs once an hour and moves refugee center npcs around based on what hour it is.",
    "global": true,
    "recurrence": "1 hours",
    "effect": [
      {
        "switch": { "math": [ "time_since('midnight', 'unit': 'hour')" ] },
        "cases": [
          { "case": 0, "effect": { "run_eocs": "EOC_REFUGEE_CENTER_GUARD_FIRST_POSITION" } },
          { "case": 2, "effect": { "run_eocs": "EOC_REFUGEE_CENTER_GUARD_SECOND_POSITION" } },
          { "case": 4, "effect": { "run_eocs": "EOC_REFUGEE_CENTER_GUARD_FIRST_POSITION" } },
          { "case": 6, "effect": { "run_eocs": "EOC_REFUGEE_CENTER_GUARD_SECOND_POSITION" } },
          { "case": 8, "effect": { "run_eocs": "EOC_REFUGEE_CENTER_GUARD_FIRST_POSITION" } },
          { "case": 10, "effect": { "run_eocs": "EOC_REFUGEE_CENTER_GUARD_SECOND_POSITION" } },
          { "case": 12, "effect": { "run_eocs": "EOC_REFUGEE_CENTER_GUARD_FIRST_POSITION" } },
          { "case": 14, "effect": { "run_eocs": "EOC_REFUGEE_CENTER_GUARD_SECOND_POSITION" } },
          { "case": 16, "effect": { "run_eocs": "EOC_REFUGEE_CENTER_GUARD_FIRST_POSITION" } },
          { "case": 18, "effect": { "run_eocs": "EOC_REFUGEE_CENTER_GUARD_SECOND_POSITION" } },
          { "case": 20, "effect": { "run_eocs": "EOC_REFUGEE_CENTER_GUARD_FIRST_POSITION" } },
          { "case": 22, "effect": { "run_eocs": "EOC_REFUGEE_CENTER_GUARD_SECOND_POSITION" } }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_REFUGEE_CENTER_GUARD_FIRST_POSITION",
    "effect": [
      {
        "u_run_npc_eocs": [
          {
            "id": "EOC_REFUGEE_CENTER_GUARD_FIRST_SHIFT",
            "effect": { "u_set_guard_pos": { "global_val": "_First" }, "unique_id": true }
          }
        ],
        "unique_ids": [ "GUARD1", "GUARD2", "GUARD3", "GUARD4", "GUARD5", "GUARD6", "GUARD7" ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_REFUGEE_CENTER_GUARD_SECOND_POSITION",
    "effect": [
      {
        "u_run_npc_eocs": [
          {
            "id": "EOC_REFUGEE_CENTER_GUARD_SECOND_SHIFT",
            "effect": { "u_set_guard_pos": { "global_val": "_Second" }, "unique_id": true }
          }
        ],
        "unique_ids": [ "GUARD1", "GUARD2", "GUARD3", "GUARD4", "GUARD5", "GUARD6", "GUARD7" ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_DIVING_INTO_WATER_CHECK",
    "global": true,
    "run_for_npcs": true,
    "eoc_type": "EVENT",
    "required_event": "avatar_moves",
    "condition": "u_is_underwater",
    "effect": [
      {
        "run_eocs": {
          "id": "EOC_REMOVE_HARD_THINGS_CHECK",
          "global": false,
          "eoc_type": "EVENT",
          "required_event": "avatar_moves",
          "condition": { "x_in_y_chance": { "x": 1, "y": 10 } },
          "//": "I would assume that Mycus spores are a bit sticky to keep them from coming off, so this has a chance to be removed instead of a garuntee.",
          "effect": [ { "u_lose_effect": "spores" } ]
        }
      },
      { "u_lose_effect": "boomered" },
      { "u_lose_effect": "corroding" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_MISSION_OLD_GUARD_REP_3_CHECK",
    "global": true,
    "eoc_type": "EVENT",
    "required_event": "avatar_enters_omt",
    "condition": {
      "and": [ { "math": [ "old_guard_rep_scouting", "==", "1" ] }, { "u_near_om_location": "exodii_base_x0y3z0", "range": 0 } ]
    },
    "effect": [
      { "math": [ "old_guard_rep_scouting", "=", "0" ] },
      { "u_add_var": "missions_old_guard_u_scouted_exodii", "value": "yes" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_NPC_FORGIVENESS",
    "condition": { "expects_vars": [ "anger_increase", "anger_type" ] },
    "effect": [
      { "npc_set_talker": { "npc_val": "n_character_id" } },
      { "math": [ "n_npc_anger()", "+=", "_anger_increase" ] },
      {
        "if": { "math": [ "n_npc_anger()", "<", "20" ] },
        "then": [
          {
            "if": {
              "or": [
                {
                  "and": [
                    { "compare_string": [ "minor_offense", { "context_val": "anger_type" } ] },
                    { "npc_has_var": "u_has_forgiveness_timer_minor_offense", "value": "yes" }
                  ]
                },
                {
                  "and": [
                    { "compare_string": [ "personal_affront", { "context_val": "anger_type" } ] },
                    { "npc_has_var": "u_has_forgiveness_timer_personal_affront", "value": "yes" }
                  ]
                },
                {
                  "and": [
                    { "compare_string": [ "intimidation", { "context_val": "anger_type" } ] },
                    { "npc_has_var": "u_has_forgiveness_timer_intimidation", "value": "yes" }
                  ]
                },
                {
                  "and": [
                    { "compare_string": [ "mission_fail", { "context_val": "anger_type" } ] },
                    { "npc_has_var": "u_has_forgiveness_timer_mission_fail", "value": "yes" }
                  ]
                }
              ]
            },
            "then": [
              {
                "run_eoc_with": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_LOW_ANGER_GAIN_CHECK",
                "alpha_talker": { "npc_val": "n_character_id" }
              }
            ]
          },
          {
            "if": {
              "or": [
                {
                  "and": [
                    { "compare_string": [ "minor_offense", { "context_val": "anger_type" } ] },
                    { "not": { "npc_has_var": "u_has_forgiveness_timer_minor_offense", "value": "yes" } }
                  ]
                },
                {
                  "and": [
                    { "compare_string": [ "personal_affront", { "context_val": "anger_type" } ] },
                    { "not": { "npc_has_var": "u_has_forgiveness_timer_personal_affront", "value": "yes" } }
                  ]
                },
                {
                  "and": [
                    { "compare_string": [ "intimidation", { "context_val": "anger_type" } ] },
                    { "not": { "npc_has_var": "u_has_forgiveness_timer_intimidation", "value": "yes" } }
                  ]
                },
                {
                  "and": [
                    { "compare_string": [ "mission_fail", { "context_val": "anger_type" } ] },
                    { "not": { "npc_has_var": "u_has_forgiveness_timer_mission_fail", "value": "yes" } }
                  ]
                }
              ]
            },
            "then": [
              {
                "run_eoc_with": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_LOW_ANGER_GAIN_CHECK",
                "alpha_talker": { "npc_val": "n_character_id" }
              },
              {
                "run_eoc_with": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_SET_TALKER",
                "alpha_talker": { "npc_val": "n_character_id" }
              },
              {
                "if": { "compare_string": [ "minor_offense", { "context_val": "anger_type" } ] },
                "then": { "npc_add_var": "u_has_forgiveness_timer_minor_offense", "value": "yes" },
                "else": {
                  "if": { "compare_string": [ "personal_affront", { "context_val": "anger_type" } ] },
                  "then": { "npc_add_var": "u_has_forgiveness_timer_personal_affront", "value": "yes" },
                  "else": {
                    "if": { "compare_string": [ "intimidation", { "context_val": "anger_type" } ] },
                    "then": { "npc_add_var": "u_has_forgiveness_timer_intimidation", "value": "yes" },
                    "else": {
                      "if": { "compare_string": [ "mission_fail", { "context_val": "anger_type" } ] },
                      "then": { "npc_add_var": "u_has_forgiveness_timer_mission_fail", "value": "yes" }
                    }
                  }
                }
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_LOW_ANGER_GAIN_CHECK",
    "effect": [
      { "u_set_talker": { "u_val": "u_character_id" } },
      {
        "if": { "math": [ "_anger_increase", "<", "3" ] },
        "then": [
          { "math": [ "u_max_forgiveness_small_values", "+=", "_anger_increase * 0.75" ] },
          {
            "if": {
              "and": [
                { "compare_string": [ "minor_offense", { "context_val": "anger_type" } ] },
                { "math": [ "u_max_forgiveness_small_values", ">=", "1" ] }
              ]
            },
            "then": [
              { "math": [ "u_max_forgiveness_minor_offense", "+=", "floor(u_max_forgiveness_small_values)" ] },
              { "math": [ "u_max_forgiveness_small_values", "=", "0" ] }
            ],
            "else": {
              "if": {
                "and": [
                  { "compare_string": [ "personal_affront", { "context_val": "anger_type" } ] },
                  { "math": [ "u_max_forgiveness_small_values", ">=", "1" ] }
                ]
              },
              "then": [
                { "math": [ "u_max_forgiveness_personal_affront", "+=", "floor(u_max_forgiveness_small_values)" ] },
                { "math": [ "u_max_forgiveness_small_values", "=", "0" ] }
              ],
              "else": {
                "if": {
                  "and": [
                    { "compare_string": [ "intimidation", { "context_val": "anger_type" } ] },
                    { "math": [ "u_max_forgiveness_small_values", ">=", "1" ] }
                  ]
                },
                "then": [
                  { "math": [ "u_max_forgiveness_intimidation", "+=", "floor(u_max_forgiveness_small_values)" ] },
                  { "math": [ "u_max_forgiveness_small_values", "=", "0" ] }
                ],
                "else": {
                  "if": {
                    "and": [
                      { "compare_string": [ "mission_fail", { "context_val": "anger_type" } ] },
                      { "math": [ "u_max_forgiveness_small_values", ">=", "1" ] }
                    ]
                  },
                  "then": [
                    { "math": [ "u_max_forgiveness_mission_fail", "+=", "floor(u_max_forgiveness_small_values)" ] },
                    { "math": [ "u_max_forgiveness_small_values", "=", "0" ] }
                  ]
                }
              }
            }
          }
        ],
        "else": [
          {
            "run_eoc_with": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_ADD_MAX_FORGIVENESS",
            "alpha_talker": { "u_val": "u_character_id" }
          }
        ]
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_ADD_MAX_FORGIVENESS",
    "effect": [
      {
        "if": {
          "and": [
            { "compare_string": [ "minor_offense", { "context_val": "anger_type" } ] },
            { "u_has_trait": "personality_forgiving" }
          ]
        },
        "then": { "math": [ "u_max_forgiveness_minor_offense", "+=", "round(_anger_increase * 0.84)" ] },
        "else": {
          "if": {
            "and": [
              { "compare_string": [ "minor_offense", { "context_val": "anger_type" } ] },
              { "u_has_trait": "personality_forgiving_plus" }
            ]
          },
          "then": { "math": [ "u_max_forgiveness_minor_offense", "+=", "round(_anger_increase * 0.875)" ] },
          "else": {
            "if": {
              "and": [
                { "compare_string": [ "minor_offense", { "context_val": "anger_type" } ] },
                { "u_has_trait": "personality_neg_forgiving" }
              ]
            },
            "then": { "math": [ "u_max_forgiveness_minor_offense", "+=", "round(_anger_increase * 0.5)" ] },
            "else": { "math": [ "u_max_forgiveness_minor_offense", "+=", "round(_anger_increase * 0.75)" ] }
          }
        }
      },
      {
        "if": {
          "and": [
            { "compare_string": [ "personal_affront", { "context_val": "anger_type" } ] },
            { "u_has_trait": "personality_forgiving" }
          ]
        },
        "then": { "math": [ "u_max_forgiveness_personal_affront", "+=", "round(_anger_increase * 0.84)" ] },
        "else": {
          "if": {
            "and": [
              { "compare_string": [ "personal_affront", { "context_val": "anger_type" } ] },
              { "u_has_trait": "personality_forgiving_plus" }
            ]
          },
          "then": { "math": [ "u_max_forgiveness_personal_affront", "+=", "round(_anger_increase * 0.875)" ] },
          "else": {
            "if": {
              "and": [
                { "compare_string": [ "personal_affront", { "context_val": "anger_type" } ] },
                { "u_has_trait": "personality_neg_forgiving" }
              ]
            },
            "then": { "math": [ "u_max_forgiveness_personal_affront", "+=", "round(_anger_increase * 0.5)" ] },
            "else": { "math": [ "u_max_forgiveness_personal_affront", "+=", "round(_anger_increase * 0.75)" ] }
          }
        }
      },
      {
        "if": {
          "and": [
            { "compare_string": [ "intimidation", { "context_val": "anger_type" } ] },
            { "u_has_trait": "personality_forgiving" }
          ]
        },
        "then": { "math": [ "u_max_forgiveness_intimidation", "+=", "round(_anger_increase * 0.84)" ] },
        "else": {
          "if": {
            "and": [
              { "compare_string": [ "intimidation", { "context_val": "anger_type" } ] },
              { "u_has_trait": "personality_forgiving_plus" }
            ]
          },
          "then": { "math": [ "u_max_forgiveness_intimidation", "+=", "round(_anger_increase * 0.875)" ] },
          "else": {
            "if": {
              "and": [
                { "compare_string": [ "intimidation", { "context_val": "anger_type" } ] },
                { "u_has_trait": "personality_neg_forgiving" }
              ]
            },
            "then": { "math": [ "u_max_forgiveness_intimidation", "+=", "round(_anger_increase * 0.5)" ] },
            "else": { "math": [ "u_max_forgiveness_intimidation", "+=", "round(_anger_increase * 0.75)" ] }
          }
        }
      },
      {
        "if": {
          "and": [
            { "compare_string": [ "mission_fail", { "context_val": "anger_type" } ] },
            { "u_has_trait": "personality_forgiving" }
          ]
        },
        "then": { "math": [ "u_max_forgiveness_mission_fail", "+=", "round(_anger_increase * 0.84)" ] },
        "else": {
          "if": {
            "and": [
              { "compare_string": [ "mission_fail", { "context_val": "anger_type" } ] },
              { "u_has_trait": "personality_forgiving_plus" }
            ]
          },
          "then": { "math": [ "u_max_forgiveness_mission_fail", "+=", "round(_anger_increase * 0.875)" ] },
          "else": {
            "if": {
              "and": [
                { "compare_string": [ "mission_fail", { "context_val": "anger_type" } ] },
                { "u_has_trait": "personality_neg_forgiving" }
              ]
            },
            "then": { "math": [ "u_max_forgiveness_mission_fail", "+=", "round(_anger_increase * 0.5)" ] },
            "else": { "math": [ "u_max_forgiveness_mission_fail", "+=", "round(_anger_increase * 0.75)" ] }
          }
        }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_SET_TALKER",
    "effect": [
      { "u_set_talker": { "u_val": "u_character_id" } },
      {
        "if": { "compare_string": [ "minor_offense", { "context_val": "anger_type" } ] },
        "then": {
          "queue_eoc_with": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_MINOR_OFFENSE",
          "variables": { "alpha_talker": { "u_val": "u_character_id" } },
          "time_in_future": { "math": [ "(ceil(1 + (n_npc_anger() * 0.3) - (n_npc_value() * 0.1) - (n_npc_trust() * 0.1))) * 86400" ] }
        }
      },
      {
        "if": { "compare_string": [ "personal_affront", { "context_val": "anger_type" } ] },
        "then": {
          "queue_eoc_with": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_PERSONAL_AFFRONT",
          "variables": { "alpha_talker": { "u_val": "u_character_id" } },
          "time_in_future": { "math": [ "(ceil(2 + (n_npc_anger() * 0.3) - (n_npc_value() * 0.1) - (n_npc_trust() * 0.1))) * 86400" ] }
        }
      },
      {
        "if": { "compare_string": [ "intimidation", { "context_val": "anger_type" } ] },
        "then": {
          "queue_eoc_with": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_INTIMIDATION",
          "variables": { "alpha_talker": { "u_val": "u_character_id" } },
          "time_in_future": { "math": [ "(ceil(3 + (n_npc_anger() * 0.3) - (n_npc_value() * 0.1) - (n_npc_trust() * 0.1))) * 86400" ] }
        }
      },
      {
        "if": { "compare_string": [ "mission_fail", { "context_val": "anger_type" } ] },
        "then": {
          "queue_eoc_with": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_MISSION_FAIL",
          "variables": { "alpha_talker": { "u_val": "u_character_id" } },
          "time_in_future": { "math": [ "(ceil(5 + (n_npc_anger() * 0.3) - (n_npc_value() * 0.1) - (n_npc_trust() * 0.1))) * 86400" ] }
        }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_MINOR_OFFENSE",
    "global": false,
    "condition": { "and": [ "u_is_npc", { "u_has_var": "u_has_forgiveness_timer_minor_offense", "value": "yes" } ] },
    "effect": [
      {
        "if": { "math": [ "u_max_forgiveness_minor_offense", ">=", "1" ] },
        "then": [
          { "math": [ "u_npc_anger()", "-=", "1" ] },
          { "math": [ "u_max_forgiveness_minor_offense", "-=", "1" ] },
          { "u_set_talker": { "u_val": "u_character_id" } },
          {
            "queue_eoc_with": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_MINOR_OFFENSE",
            "variables": { "alpha_talker": { "u_val": "u_character_id" } },
            "time_in_future": { "math": [ "(ceil(1 + (u_npc_anger() * 0.3) - (u_npc_value() * 0.1) - (u_npc_trust() * 0.1))) * 86400" ] }
          }
        ],
        "else": { "u_lose_var": "u_has_forgiveness_timer_minor_offense" }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_PERSONAL_AFFRONT",
    "global": false,
    "condition": { "and": [ "u_is_npc", { "u_has_var": "u_has_forgiveness_timer_personal_affront", "value": "yes" } ] },
    "effect": [
      {
        "if": { "math": [ "u_max_forgiveness_personal_affront", ">=", "1" ] },
        "then": [
          { "math": [ "u_npc_anger()", "-=", "1" ] },
          { "math": [ "u_max_forgiveness_personal_affront", "-=", "1" ] },
          { "u_set_talker": { "u_val": "u_character_id" } },
          {
            "queue_eoc_with": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_PERSONAL_AFFRONT",
            "variables": { "alpha_talker": { "u_val": "u_character_id" } },
            "time_in_future": { "math": [ "(ceil(2 + (u_npc_anger() * 0.3) - (u_npc_value() * 0.1) - (u_npc_trust() * 0.1))) * 86400" ] }
          }
        ],
        "else": { "u_lose_var": "u_has_forgiveness_timer_personal_affront" }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_INTIMIDATION",
    "global": false,
    "condition": { "and": [ "u_is_npc", { "u_has_var": "u_has_forgiveness_timer_intimidation", "value": "yes" } ] },
    "effect": [
      {
        "if": { "math": [ "u_max_forgiveness_intimidation", ">=", "1" ] },
        "then": [
          { "math": [ "u_npc_anger()", "-=", "1" ] },
          { "math": [ "u_max_forgiveness_intimidation", "-=", "1" ] },
          { "u_set_talker": { "u_val": "u_character_id" } },
          {
            "queue_eoc_with": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_INTIMIDATION",
            "variables": { "alpha_talker": { "u_val": "u_character_id" } },
            "time_in_future": { "math": [ "(ceil(3 + (u_npc_anger() * 0.3) - (u_npc_value() * 0.1) - (u_npc_trust() * 0.1))) * 86400" ] }
          }
        ],
        "else": { "u_lose_var": "u_has_forgiveness_timer_intimidation" }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_MISSION_FAIL",
    "global": false,
    "condition": { "and": [ "u_is_npc", { "u_has_var": "u_has_forgiveness_timer_mission_fail", "value": "yes" } ] },
    "effect": [
      {
        "if": { "math": [ "u_max_forgiveness_mission_fail", ">=", "1" ] },
        "then": [
          { "math": [ "u_npc_anger()", "-=", "1" ] },
          { "math": [ "u_max_forgiveness_mission_fail", "-=", "1" ] },
          { "u_set_talker": { "u_val": "u_character_id" } },
          {
            "queue_eoc_with": "EOC_NPC_PLAYER_FORGIVENESS_EFFECT_MISSION_FAIL",
            "variables": { "alpha_talker": { "u_val": "u_character_id" } },
            "time_in_future": { "math": [ "(ceil(5 + (u_npc_anger() * 0.3) - (u_npc_value() * 0.1) - (u_npc_trust() * 0.1))) * 86400" ] }
          }
        ],
        "else": { "u_lose_var": "u_has_forgiveness_timer_mission_fail" }
      }
    ]
  }
]
