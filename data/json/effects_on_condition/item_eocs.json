[
  {
    "type": "effect_on_condition",
    "id": "get_katana",
    "global": true,
    "effect": { "u_spawn_item": "katana" }
  },
  {
    "type": "effect_on_condition",
    "id": "get_deagle_44",
    "global": true,
    "effect": { "u_spawn_item": "modular_deagle_44", "use_item_group": true }
  },
  {
    "type": "effect_on_condition",
    "id": "get_m4_carbine",
    "global": true,
    "effect": { "u_spawn_item": "modular_m4a1", "use_item_group": true }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_scan_advanced_weather",
    "condition": {
      "or": [
        { "is_weather": "portal_storm" },
        { "is_weather": "distant_portal_storm" },
        { "is_weather": "close_portal_storm" },
        { "u_near_om_location": "unvitrified_orchard", "range": 10 },
        { "u_near_om_location": "LIXA_surface_1a", "range": 10 },
        { "u_near_om_location": "temple_stairs", "range": 10 },
        { "u_near_om_location": "mine_amigara_finale_central", "range": 10 },
        { "u_near_om_location": "highlands", "range": 10 },
        { "u_near_om_location": "exodii_base_x0y0z0", "range": 10 },
        { "u_near_om_location": "microlab_portal_security1", "range": 10 },
        { "u_near_om_location": "labyrinth_entrance", "range": 10 },
        { "u_near_om_location": "corpse_surface", "range": 10 },
        { "u_near_om_location": "corpse_brain", "range": 10 },
        { "u_near_om_location": "xedra_rural_church", "range": 10 },
        { "u_near_om_location": "morgantown_2b", "range": 10 },
        { "u_near_om_location": "cabin_3_reverberation", "range": 10 },
        { "u_near_om_location": "cabin_3_reverberation_hint", "range": 10 },
        { "u_near_om_location": "radiosphere_radio_tower_top", "range": 10 }
      ]
    },
    "effect": {
      "u_message": "The instruments whir for a moment before the computer emits 3 sharp beeps.  The LED screen reads \"ANOMALOUS CONDITIONS DETECTED - FULL SCAN RECOMMENDED\"."
    },
    "false_effect": {
      "u_message": "The instruments whir for a moment before the computer beeps once.  The LED screen reads \"CONDITIONS NORMAL\"."
    }
  },
  {
    "id": "EOC_vitrified_doll_talk",
    "type": "effect_on_condition",
    "condition": { "not": { "u_has_item": "imperfect_doll_complete" } },
    "effect": { "open_dialogue": { "topic": "vitrified_doll_talk_main" } }
  },
  {
    "id": "EOC_repair_imperfect_doll",
    "type": "effect_on_condition",
    "effect": [
      { "u_remove_item_with": "imperfect_doll_features" },
      { "u_remove_item_with": "imperfect_doll_arms" },
      { "u_remove_item_with": "imperfect_doll_legs" },
      { "u_spawn_item": "imperfect_doll_complete", "suppress_message": true },
      { "u_transform_radius": 5, "ter_furn_transform": "imperfect_doll_to_couch" }
    ]
  },
  {
    "id": "EOC_vitrified_bookcase_talk",
    "type": "effect_on_condition",
    "condition": { "not": { "u_has_item": "imperfect_doll_features" } },
    "effect": { "open_dialogue": { "topic": "vitrified_bookcase_talk_main" } },
    "false_effect": { "u_message": "This bookshelf is complete, now.", "type": "good", "popup": false }
  },
  {
    "id": "EOC_swap_glass_book_for_eyes",
    "type": "effect_on_condition",
    "effect": [
      { "u_remove_item_with": "glass_book" },
      { "u_spawn_item": "imperfect_doll_features", "suppress_message": true },
      { "u_transform_radius": 5, "ter_furn_transform": "glass_book_on_shelf" }
    ]
  },
  {
    "id": "EOC_vitrified_pool_talk",
    "type": "effect_on_condition",
    "condition": { "not": { "u_has_item": "imperfect_doll_legs" } },
    "effect": { "open_dialogue": { "topic": "vitrified_pool_talk_main" } },
    "false_effect": { "u_message": "The sailboat drifts in slow circles through the sand.", "type": "good", "popup": false }
  },
  {
    "id": "EOC_swap_glass_boat_for_legs",
    "type": "effect_on_condition",
    "effect": [ { "u_remove_item_with": "glass_boat" }, { "u_spawn_item": "imperfect_doll_legs", "suppress_message": true } ]
  },
  {
    "id": "EOC_vitrified_soil_talk",
    "type": "effect_on_condition",
    "condition": { "not": { "u_has_item": "imperfect_doll_arms" } },
    "effect": { "open_dialogue": { "topic": "vitrified_soil_talk_main" } },
    "false_effect": { "u_message": "A tiny glass sprout has begun to grow here.", "type": "good", "popup": false }
  },
  {
    "id": "EOC_swap_glass_apple_for_arms",
    "type": "effect_on_condition",
    "effect": [ { "u_remove_item_with": "glass_apple" }, { "u_spawn_item": "imperfect_doll_arms", "suppress_message": true } ]
  },
  {
    "id": "EOC_toolweapon_activate",
    "type": "effect_on_condition",
    "condition": { "not": "u_is_underwater" },
    "effect": [
      {
        "if": "has_ammo",
        "then": [
          { "turn_cost": { "context_val": "turn_cost" } },
          {
            "u_make_sound": { "context_val": "success_message" },
            "type": "combat",
            "volume": { "context_val": "volume" }
          },
          { "u_message": { "context_val": "success_message" } },
          { "transform_item": { "context_val": "transform_target" }, "active": true }
        ],
        "else": { "u_message": { "context_val": "failure_message" } }
      }
    ],
    "false_effect": { "u_message": "The <npc_name> won't start underwater." }
  },
  {
    "id": "EOC_toolweapon_running",
    "type": "effect_on_condition",
    "condition": { "not": "npc_is_underwater" },
    "effect": {
      "if": { "one_in_chance": { "context_val": "sound_chance" } },
      "then": [
        { "message": { "context_val": "sound_message" }, "sound": true },
        {
          "npc_make_sound": { "context_val": "sound_message" },
          "type": "activity",
          "volume": { "context_val": "volume" },
          "ambient": true
        }
      ]
    },
    "false_effect": [
      { "u_message": "Your <npc_name> gurgles in the water and stops." },
      { "transform_item": { "context_val": "revert_to" } }
    ]
  },
  {
    "id": "EOC_toolweapon_deactivate",
    "type": "effect_on_condition",
    "effect": [ { "u_message": "Your <npc_name> goes quiet." }, { "transform_item": { "context_val": "transform_target" } } ]
  },
  {
    "type": "effect_on_condition",
    "id": "barber_hair",
    "effect": { "open_dialogue": { "topic": "TALK_CUT_YOUR_HAIR" } }
  },
  {
    "type": "effect_on_condition",
    "id": "barber_beard",
    "effect": { "open_dialogue": { "topic": "TALK_CUT_YOUR_BEARD" } }
  },
  {
    "type": "effect_on_condition",
    "id": "barber_hair_and_beard",
    "effect": { "open_dialogue": { "topic": "TALK_CUT_HAIR_OR_BEARD" } }
  },
  {
    "type": "effect_on_condition",
    "id": "reset_all_hair_types",
    "//": "This will reset all hair types for the purposes of applying new ones.",
    "effect": [
      { "u_lose_trait": "hair_buzzcut" },
      { "u_lose_trait": "hair_crewcut" },
      { "u_lose_trait": "hair_short" },
      { "u_lose_trait": "hair_short_no_fringe" },
      { "u_lose_trait": "hair_short_over_eye" },
      { "u_lose_trait": "hair_medium" },
      { "u_lose_trait": "hair_mohawk" },
      { "u_lose_trait": "hair_long" },
      { "u_lose_trait": "hair_long_mohawk" },
      { "u_lose_trait": "hair_mullet" },
      { "u_lose_trait": "hair_long_over_eye" },
      { "u_lose_trait": "hair_messy" },
      { "u_lose_trait": "hair_very_long" },
      { "u_lose_trait": "hair_extremely_long" },
      { "u_lose_trait": "hair_body_length" },
      { "u_lose_trait": "hair_modern" },
      { "u_lose_trait": "hair_puff" },
      { "u_lose_trait": "hair_beaded" },
      { "u_lose_trait": "hair_curls" },
      { "u_lose_trait": "hair_bun" },
      { "u_lose_trait": "hair_punk_long" },
      { "u_lose_trait": "hair_braid" },
      { "u_lose_trait": "hair_detective" },
      { "u_lose_trait": "hair_super_princess" },
      { "u_lose_trait": "hair_twintails" },
      { "u_lose_trait": "hair_bald" },
      { "u_lose_trait": "hair_fro" },
      { "u_lose_trait": "hair_ponytail" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "reset_all_beard_types",
    "//": "This will reset all beard types for the purposes of applying new ones.",
    "effect": [
      { "u_lose_trait": "FACIAL_HAIR_NECKBEARD" },
      { "u_lose_trait": "FACIAL_HAIR_SIDEBURNS" },
      { "u_lose_trait": "FACIAL_HAIR_SOUL_PATCH" },
      { "u_lose_trait": "FACIAL_HAIR_CHIN_STRIP" },
      { "u_lose_trait": "FACIAL_HAIR_3DAYSTUBBLE" },
      { "u_lose_trait": "FACIAL_HAIR_TOOTHBRUSH" },
      { "u_lose_trait": "FACIAL_HAIR_CHIN_STRAP" },
      { "u_lose_trait": "FACIAL_HAIR_MUSTACHE" },
      { "u_lose_trait": "FACIAL_HAIR_NECKBEARD" },
      { "u_lose_trait": "FACIAL_HAIR_WALRUS" },
      { "u_lose_trait": "FACIAL_HAIR_ZAPPA" },
      { "u_lose_trait": "FACIAL_HAIR_GOATEE" },
      { "u_lose_trait": "FACIAL_HAIR_CIRCLE" },
      { "u_lose_trait": "FACIAL_HAIR_SHORTBOXED" },
      { "u_lose_trait": "FACIAL_HAIR_HORSESHOE" },
      { "u_lose_trait": "FACIAL_HAIR_MUTTONCHOPS" },
      { "u_lose_trait": "FACIAL_HAIR_GUNSLINGER" },
      { "u_lose_trait": "FACIAL_HAIR_CHIN_CURTAIN" },
      { "u_lose_trait": "FACIAL_HAIR_HANDLEBAR" },
      { "u_lose_trait": "FACIAL_HAIR_VANDYKE" },
      { "u_lose_trait": "FACIAL_HAIR_BEARD" },
      { "u_lose_trait": "FACIAL_HAIR_ANCHOR" },
      { "u_lose_trait": "FACIAL_HAIR_ROYALE" },
      { "u_lose_trait": "FACIAL_HAIR_SHENANDOAH" },
      { "u_lose_trait": "FACIAL_HAIR_BEARD_LONG" },
      { "u_lose_trait": "FACIAL_HAIR_BEARD_VERY_LONG" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_apply_makeup",
    "condition": { "u_has_trait": "VANITY" },
    "effect": { "u_message": "You apply some makeup.  The world will now get to know the true meaning of beauty." },
    "false_effect": { "u_message": "You apply some makeup.  It feels good to take care of yourself." }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_use_microscope",
    "effect": {
      "run_eoc_selector": [ "EOC_observe_water_murky", "EOC_observe_soil", "EOC_selector_cancel" ],
      "names": [ "Murky water sample", "Soil sample", "Cancel" ],
      "hide_failing": true,
      "allow_cancel": true
    }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_observe_water_murky",
    "condition": { "u_has_item": "microscope_slide_water_murky" },
    "effect": {
      "u_message": "You place the slide on the stage, adjust the light and focus the lens, you manage to see  <microscope_water_murky>"
    }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_observe_soil",
    "condition": { "u_has_item": "microscope_slide_soil" },
    "effect": {
      "u_message": "You place the slide on the stage, adjust the light and focus the lens, you manage to see <microscope_soil>"
    }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_selector_cancel",
    "effect": { "u_message": "You changed your mind." }
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_MP3_REVERBERATION",
    "effect": [
      {
        "if": { "math": [ "has_var(n_mp3_timer)" ] },
        "then": {
          "if": { "math": [ "n_mp3_timer < 0" ] },
          "then": [ { "run_eocs": [ "EOC_MP3_REVERBERATION_PING" ] }, { "math": [ "n_mp3_timer = rand(20)+20" ] } ],
          "else": [ { "math": [ "n_mp3_timer -= 1" ] } ]
        },
        "else": { "math": [ "n_mp3_timer = rand(20)+20" ] }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_MP3_REVERBERATION_PING",
    "effect": [
      {
        "if": "has_alpha",
        "//": "only do the following if MP3 is in player's inventory.",
        "then": {
          "if": { "math": [ "n_cooldown < time('now')" ] },
          "then": { "run_eocs": [ "EOC_MP3_REVERBERATION_LOCATOR" ] },
          "else": { "u_message": "<mp3_reverberation_locator_cooldown>", "type": "info", "snippet": true }
        }
      }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_MP3_REVERBERATION_LOCATOR",
    "effect": [
      {
        "if": {
          "or": [
            { "u_at_om_location": "cabin_roof_3" },
            { "u_at_om_location": "cabin_roof_3_reverberation_hint" },
            { "u_at_om_location": "radio_tower_top" },
            { "u_at_om_location": "wasp_tower_top" }
          ]
        },
        "then": [
          { "u_message": "Its song drowns out the world.", "type": "info", "popup": true, "popup_w_interrupt_query": true },
          { "transform_item": "mp3_reverberation", "active": false },
          { "math": [ "n_cooldown = time('now')+time('1 d')+( time('8 h')*rand(4) )" ] },
          { "run_eocs": [ "EOC_REVERBERATION_ENTER" ], "time_in_future": "2 seconds" }
        ],
        "else": {
          "if": {
            "or": [
              { "u_near_om_location": "cabin_3", "range": 2 },
              { "u_near_om_location": "cabin_3_reverberation_hint", "range": 2 },
              { "u_near_om_location": "radio_tower", "range": 2 },
              { "u_near_om_location": "radio_tower_1", "range": 2 },
              { "u_near_om_location": "radio_tower_reverberation_mp3", "range": 2 },
              { "u_at_om_location": "radio_tower_even" },
              { "u_at_om_location": "radio_tower_odd" }
            ]
          },
          "then": [
            { "u_message": "<mp3_reverberation_locator_almost_there>", "type": "info", "snippet": true },
            { "u_add_morale": "morale_music", "bonus": 60, "max_bonus": 40 }
          ],
          "else": {
            "if": {
              "or": [
                { "u_near_om_location": "cabin_3", "range": 8 },
                { "u_near_om_location": "cabin_3_reverberation_hint", "range": 8 },
                { "u_near_om_location": "radio_tower", "range": 8 },
                { "u_near_om_location": "radio_tower_1", "range": 8 },
                { "u_near_om_location": "radio_tower_reverberation_mp3", "range": 8 }
              ]
            },
            "then": [
              { "u_message": "<mp3_reverberation_locator_close>", "type": "info", "snippet": true },
              { "u_add_morale": "morale_music", "bonus": 40, "max_bonus": 20 }
            ],
            "else": [
              { "u_message": "<music_description>", "type": "info", "snippet": true },
              { "u_add_morale": "morale_music", "bonus": 20, "max_bonus": 20 }
            ]
          }
        }
      }
    ]
  }
]
