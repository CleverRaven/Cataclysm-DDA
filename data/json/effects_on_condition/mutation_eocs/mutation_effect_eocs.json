[
  {
    "type": "effect_on_condition",
    "id": "mut_eyestalk",
    "recurrence": [ "2 hours 15 minutes", "10 hours 15 minutes" ],
    "condition": {
      "and": [
        { "u_has_trait": "EYESTALKS1" },
        { "not": { "or": [ { "u_has_effect": "visuals" }, { "u_has_effect": "narcosis" } ] } }
      ]
    },
    "deactivate_condition": { "not": { "u_has_trait": "EYESTALKS1" } },
    "effect": [
      { "u_message": "Your vision inverts!", "type": "bad" },
      { "sound_effect": "pixelated", "id": "bionics", "volume": 50 },
      { "u_add_effect": "visuals", "duration": "10 minutes" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "chitin2_molt_timer1",
    "recurrence": [ "24 days", "42 days" ],
    "condition": {
      "and": [
        { "u_has_trait": "CHITIN2" },
        { "not": { "u_has_effect": "molting" } },
        { "not": { "u_has_effect": "molting_imminent" } },
        { "not": { "u_has_trait": "CHITIN3" } },
        { "not": { "u_has_trait": "CRUSTACEAN_CARAPACE" } }
      ]
    },
    "effect": [ { "u_add_effect": "molting", "intensity": 1, "duration": "PERMANENT" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "chitin2_molt_timer2",
    "recurrence": [ "1 days", "2 days" ],
    "condition": {
      "and": [
        { "u_has_effect": "molting" },
        { "not": { "u_has_effect": "molting_imminent" } },
        { "not": { "u_has_trait": "CHITIN3" } },
        { "not": { "u_has_trait": "CRUSTACEAN_CARAPACE" } }
      ]
    },
    "effect": [ { "u_add_effect": "molting_imminent", "intensity": 1, "duration": "PERMANENT" }, { "u_lose_effect": "molting" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "chitin2_molt_timer_3",
    "recurrence": [ "1 hours", "3 hours" ],
    "condition": {
      "and": [
        { "u_has_effect": "molting_imminent" },
        { "not": { "u_has_effect": "molting" } },
        { "not": { "u_has_trait": "CHITIN3" } },
        { "not": { "u_has_trait": "CRUSTACEAN_CARAPACE" } }
      ]
    },
    "effect": [
      { "u_add_effect": "narcosis", "duration": "5 minutes" },
      { "u_add_effect": "sleep", "duration": "5 minutes" },
      {
        "u_message": "Your exoskeleton grows steadily more rigid until you can no longer move. You strain against it for a few minutes, and it peels and cracks away in chunks like a plaster mold, revealing a soft and tender new layer beneath.",
        "type": "bad"
      },
      { "u_lose_trait": "CHITIN2" },
      { "u_lose_trait": "CHITIN" },
      { "u_lose_effect": "molting_imminent" },
      { "u_spawn_item": "chitin_piece", "count": 3 },
      { "u_add_trait": "CHITIN_MOLTED" },
      { "u_add_trait": "CHITIN2_MOLTED" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "chitin2_molt_timer4",
    "recurrence": [ "8 hours", "12 hours" ],
    "condition": {
      "and": [
        { "u_has_trait": "CHITIN2_MOLTED" },
        { "not": { "u_has_effect": "molting" } },
        { "not": { "u_has_effect": "molting_imminent" } },
        { "not": { "u_has_trait": "CHITIN3_MOLTED" } },
        { "not": { "u_has_trait": "CRUSTACEAN_CARAPACE_MOLTED" } }
      ]
    },
    "effect": [
      { "u_message": "Your exoskeleton has finished hardening.", "type": "good" },
      { "u_lose_trait": "CHITIN_MOLTED" },
      { "u_lose_trait": "CHITIN2_MOLTED" },
      { "u_add_trait": "CHITIN" },
      { "u_add_trait": "CHITIN2" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "chitin3_molt_timer1",
    "recurrence": [ "24 days", "42 days" ],
    "condition": {
      "and": [
        { "u_has_trait": "CHITIN2" },
        { "or": [ { "u_has_trait": "CHITIN3" }, { "u_has_trait": "CRUSTACEAN_CARAPACE" } ] },
        { "not": { "u_has_effect": "molting" } },
        { "not": { "u_has_effect": "molting_imminent" } }
      ]
    },
    "effect": [ { "u_add_effect": "molting", "intensity": 1, "duration": "PERMANENT" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "chitin3_molt_timer2",
    "recurrence": [ "1 days", "2 days" ],
    "condition": {
      "and": [
        { "u_has_effect": "molting" },
        { "u_has_trait": "CHITIN2" },
        { "or": [ { "u_has_trait": "CHITIN3" }, { "u_has_trait": "CRUSTACEAN_CARAPACE" } ] },
        { "not": { "u_has_effect": "molting_imminent" } }
      ]
    },
    "effect": [ { "u_add_effect": "molting_imminent", "intensity": 1, "duration": "PERMANENT" }, { "u_lose_effect": "molting" } ]
  },
  {
    "type": "effect_on_condition",
    "id": "chitin3_molt_timer3",
    "recurrence": [ "1 hours", "3 hours" ],
    "condition": {
      "and": [
        { "u_has_trait": "CHITIN2" },
        { "u_has_trait": "CHITIN3" },
        { "u_has_effect": "molting_imminent" },
        { "not": { "u_has_effect": "molting" } }
      ]
    },
    "effect": [
      { "u_add_effect": "narcosis", "duration": "15 minutes" },
      { "u_add_effect": "sleep", "duration": "15 minutes" },
      {
        "u_message": "Your exoskeleton locks up around you like a straitjacket, completely immobilizing you.  As you try to move, you begin to feel it painlessly rip, opening a hole through which you can slowly emerge, raw, soft, and vulnerable.",
        "type": "bad"
      },
      { "u_lose_trait": "CHITIN3" },
      { "u_lose_trait": "CHITIN2" },
      { "u_lose_trait": "CHITIN" },
      { "u_lose_effect": "molting_imminent" },
      { "u_spawn_item": "chitin_piece", "count": 4 },
      { "u_add_trait": "CHITIN_MOLTED" },
      { "u_add_trait": "CHITIN2_MOLTED" },
      { "u_add_trait": "CHITIN3_MOLTED" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "chitin3_molt_timer4",
    "recurrence": [ "8 hours", "12 hours" ],
    "condition": {
      "and": [
        { "u_has_trait": "CHITIN2_MOLTED" },
        { "u_has_trait": "CHITIN3_MOLTED" },
        { "not": { "u_has_effect": "molting" } },
        { "not": { "u_has_effect": "molting_imminent" } }
      ]
    },
    "effect": [
      { "u_message": "Your exoskeleton has finished hardening.", "type": "good" },
      { "u_lose_trait": "CHITIN3_MOLTED" },
      { "u_lose_trait": "CHITIN2_MOLTED" },
      { "u_lose_trait": "CHITIN_MOLTED" },
      { "u_add_trait": "CHITIN" },
      { "u_add_trait": "CHITIN2" },
      { "u_add_trait": "CHITIN3" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "chitin_carapace_molt_timer3",
    "recurrence": [ "1 hours", "3 hours" ],
    "condition": {
      "and": [
        { "u_has_trait": "CHITIN2" },
        { "u_has_trait": "CRUSTACEAN_CARAPACE" },
        { "u_has_effect": "molting_imminent" },
        { "not": { "u_has_effect": "molting" } }
      ]
    },
    "effect": [
      { "u_add_effect": "narcosis", "duration": "15 minutes" },
      { "u_add_effect": "sleep", "duration": "15 minutes" },
      {
        "u_message": "Your exoskeleton locks up around you like a straitjacket, completely immobilizing you.  As you try to move, you begin to feel it painlessly rip, opening a hole through which you can slowly emerge, raw, soft, and vulnerable.",
        "type": "bad"
      },
      { "u_lose_trait": "CRUSTACEAN_CARAPACE" },
      { "u_lose_trait": "CHITIN2" },
      { "u_lose_trait": "CHITIN" },
      { "u_lose_effect": "molting_imminent" },
      { "u_spawn_item": "chitin_piece", "count": 5 },
      { "u_add_trait": "CHITIN_MOLTED" },
      { "u_add_trait": "CHITIN2_MOLTED" },
      { "u_add_trait": "CRUSTACEAN_CARAPACE_MOLTED" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "chitin_carapace_molt_timer4",
    "recurrence": [ "8 hours", "12 hours" ],
    "condition": {
      "and": [
        { "u_has_trait": "CHITIN2_MOLTED" },
        { "u_has_trait": "CRUSTACEAN_CARAPACE_MOLTED" },
        { "not": { "u_has_effect": "molting" } },
        { "not": { "u_has_effect": "molting_imminent" } }
      ]
    },
    "effect": [
      { "u_message": "Your exoskeleton has finished hardening.", "type": "good" },
      { "u_lose_trait": "CRUSTACEAN_CARAPACE_MOLTED" },
      { "u_lose_trait": "CHITIN2_MOLTED" },
      { "u_lose_trait": "CHITIN_MOLTED" },
      { "u_add_trait": "CHITIN" },
      { "u_add_trait": "CHITIN2" },
      { "u_add_trait": "CRUSTACEAN_CARAPACE" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_RASHY_SKIN",
    "recurrence": [ "2 hour", "24 hours" ],
    "condition": { "and": [ { "u_has_trait": "SKIN_RASHY" }, { "not": { "u_has_effect": "formication" } } ] },
    "effect": [ { "u_add_effect": "formication", "duration": "10 minutes", "target_part": "random" } ]
  },
  {
    "id": "EOC_MUTATE_LEG_HEAL",
    "eoc_type": "EVENT",
    "required_event": "gains_mutation",
    "condition": {
      "and": [
        { "or": [ { "u_has_trait": "NO_LEFT_LEG" }, { "u_has_trait": "NO_RIGHT_LEG" } ] },
        {
          "and": [
            {
              "or": [
                { "u_has_trait": "CRAB_LEGS" },
                { "u_has_trait": "GASTROPOD_FOOT" },
                { "u_has_trait": "AMORPHOUS" },
                { "u_has_trait": "ROOTS1" },
                { "u_has_trait": "LEG_TENTACLES" }
              ]
            }
          ]
        }
      ]
    },
    "effect": [
      { "u_lose_trait": "NO_LEFT_LEG" },
      { "u_lose_trait": "NO_RIGHT_LEG" },
      { "u_add_trait": "HAS_LEFT_LEG" },
      { "u_add_trait": "HAS_RIGHT_LEG" },
      { "u_lose_var": "missing_left_leg", "type": "traits", "context": "limbs" },
      { "u_lose_var": "missing_right_leg", "type": "traits", "context": "limbs" }
    ]
  },
  {
    "type": "effect_on_condition",
    "id": "EOC_LIMB_LOSS_CHECK_ON_HIT",
    "eoc_type": "EVENT",
    "required_event": "character_takes_damage",
    "global": false,
    "condition": {
      "or": [
        { "math": [ "_damage", ">=", "u_hp_max('arm_l') * 0.25" ] },
        { "math": [ "_damage", ">=", "u_hp_max('arm_r') * 0.25" ] },
        { "math": [ "_damage", ">=", "u_hp_max('leg_l') * 0.25" ] },
        { "math": [ "_damage", ">=", "u_hp_max('leg_r') * 0.25" ] }
      ]
    },
    "effect": [
      {
        "run_eocs": {
          "id": "EOC_REMOVE_LEFT_ARM",
          "condition": {
            "and": [
              { "not": { "u_has_trait": "NO_LEFT_ARM" } },
              { "not": { "u_has_var": "missing_left_arm", "type": "traits", "context": "limbs", "value": "yes" } },
              {
                "x_in_y_chance": { "x": { "math": [ "(u_hp('leg_r') / u_hp_max('leg_r')) * (_damage / 2)" ], "default": 15 }, "y": 100 }
              },
              { "math": [ "_damage", ">=", "u_hp_max('arm_l') * 0.25" ] }
            ]
          },
          "effect": [
            { "u_lose_effect": "disabled" },
            { "u_lose_trait": "HAS_LEFT_ARM" },
            { "u_add_trait": "NO_LEFT_ARM" },
            { "u_add_effect": "bleed", "intensity": 3, "duration": 1800, "target_part": "torso" },
            { "u_message": "Your left arm is cut off, and the severed part sails off in an arc!", "type": "bad" },
            { "u_cast_spell": { "id": "dummy_severed_left_arm", "hit_self": true } }
          ]
        }
      },
      {
        "run_eocs": {
          "id": "EOC_REMOVE_RIGHT_ARM",
          "condition": {
            "and": [
              { "not": { "u_has_trait": "NO_RIGHT_ARM" } },
              { "not": { "u_has_var": "missing_right_arm", "type": "traits", "context": "limbs", "value": "yes" } },
              {
                "x_in_y_chance": { "x": { "math": [ "(u_hp('leg_r') / u_hp_max('leg_r')) * (_damage / 2)" ], "default": 15 }, "y": 100 }
              },
              { "math": [ "_damage", ">=", "u_hp_max('arm_r') * 0.25" ] }
            ]
          },
          "effect": [
            { "u_lose_effect": "disabled" },
            { "u_lose_trait": "HAS_RIGHT_ARM" },
            { "u_add_trait": "NO_RIGHT_ARM" },
            { "u_add_effect": "bleed", "intensity": 3, "duration": 1800, "target_part": "torso" },
            { "u_message": "Your right arm is cut off, and the severed part sails off in an arc!", "type": "bad" },
            { "u_cast_spell": { "id": "dummy_severed_right_arm", "hit_self": true } }
          ]
        }
      },
      {
        "run_eocs": {
          "id": "EOC_REMOVE_LEFT_LEG",
          "condition": {
            "and": [
              { "not": { "u_has_trait": "NO_LEFT_LEG" } },
              { "not": { "u_has_var": "missing_left_leg", "type": "traits", "context": "limbs", "value": "yes" } },
              {
                "x_in_y_chance": { "x": { "math": [ "(u_hp('leg_r') / u_hp_max('leg_r')) * (_damage / 2)" ], "default": 15 }, "y": 100 }
              },
              { "math": [ "_damage", ">=", "u_hp_max('leg_l') * 0.25" ] }
            ]
          },
          "effect": [
            { "u_lose_effect": "disabled" },
            { "u_lose_trait": "HAS_LEFT_LEG" },
            { "u_add_trait": "NO_LEFT_LEG" },
            { "u_add_effect": "bleed", "intensity": 3, "duration": 1800, "target_part": "torso" },
            { "u_message": "Your left leg is cut off, and the severed part sails off in an arc!", "type": "bad" },
            { "u_cast_spell": { "id": "dummy_severed_left_leg", "hit_self": true } }
          ]
        }
      },
      {
        "run_eocs": {
          "id": "EOC_REMOVE_RIGHT_LEG",
          "condition": {
            "and": [
              { "not": { "u_has_trait": "NO_RIGHT_LEG" } },
              { "not": { "u_has_var": "missing_right_leg", "type": "traits", "context": "limbs", "value": "yes" } },
              {
                "x_in_y_chance": { "x": { "math": [ "(u_hp('leg_r') / u_hp_max('leg_r')) * (_damage / 2)" ], "default": 15 }, "y": 100 }
              },
              { "math": [ "_damage", ">=", "u_hp_max('leg_r') * 0.25" ] }
            ]
          },
          "effect": [
            { "u_lose_effect": "disabled" },
            { "u_lose_trait": "HAS_RIGHT_LEG" },
            { "u_add_trait": "NO_RIGHT_LEG" },
            { "u_add_effect": "bleed", "intensity": 3, "duration": 1800, "target_part": "torso" },
            { "u_message": "Your right leg is cut off, and the severed part sails off in an arc!", "type": "bad" },
            { "u_cast_spell": { "id": "dummy_severed_right_leg", "hit_self": true } }
          ]
        }
      }
    ]
  }
]
