[
  {
    "type": "npc_class",
    "id": "NC_REFUGEE_Draco",
    "name": "Refugee",
    "job_description": "I'm just trying to survive.",
    "common": false,
    "//": "Draco is a middle-aged musician, and generally a pretty nice guy.  He's always been a wanderer and this isn't his first time living basically homeless.",
    "bonus_str": { "rng": [ -2, 2 ] },
    "bonus_dex": { "rng": [ -1, 2 ] },
    "bonus_int": { "rng": [ -1, 3 ] },
    "bonus_per": { "rng": [ -1, 3 ] },
    "worn_override": "REFUGEE_Draco_worn",
    "carry_override": "REFUGEE_Draco_carried",
    "weapon_override": "REFUGEE_Draco_wield",
    "traits": [ { "trait": "PRETTY" }, { "trait": "OPTIMISTIC" }, { "trait": "BADBACK" }, { "group": "Appearance_African" } ],
    "skills": [
      { "skill": "ALL", "level": { "mul": [ { "one_in": 3 }, { "sum": [ { "dice": [ 2, 2 ] }, { "rng": [ 0, -4 ] } ] } ] } },
      { "skill": "speech", "bonus": { "rng": [ 2, 3 ] } },
      { "skill": "swimming", "bonus": { "rng": [ 1, 2 ] } }
    ]
  },
  {
    "type": "item_group",
    "id": "REFUGEE_Draco_worn",
    "subtype": "collection",
    "entries": [
      { "item": "boxer_shorts" },
      { "item": "socks" },
      { "item": "sweater" },
      { "item": "jeans" },
      { "item": "jacket_leather_red" },
      { "item": "hat_ball" },
      { "item": "sunglasses" },
      { "item": "boots_combat" }
    ]
  },
  {
    "type": "item_group",
    "id": "REFUGEE_Draco_carried",
    "subtype": "collection",
    "entries": [ { "item": "wire" } ]
  },
  {
    "type": "item_group",
    "id": "REFUGEE_Draco_wield",
    "subtype": "collection",
    "entries": [ { "item": "crowbar" } ]
  },
  {
    "type": "npc",
    "id": "refugee_DracoDune",
    "name_unique": "Draco Dune",
    "gender": "male",
    "name_suffix": "refugee",
    "class": "NC_REFUGEE_Draco",
    "attitude": 0,
    "mission": 7,
    "chat": "TALK_REFUGEE_Draco_1",
    "faction": "free_merchants"
  },
  {
    "type": "effect_type",
    "id": "u_met_Draco_Dune",
    "//": "Use this flag to indicate if the player has met this NPC before."
  },
  {
    "type": "effect_type",
    "id": "u_got_to_Draco_3_Draco_Dune",
    "//": "Use this flag to indicate if the player has gotten to conversation part 3."
  },
  {
    "type": "talk_topic",
    "id": "TALK_REFUGEE_Draco_1",
    "dynamic_line": {
      "u_has_effect": "u_met_Draco_Dune",
      "yes": "Always good to see you, friend.",
      "no": "Well now, good to see another new face!  Welcome to the center, friend, I'm Draco."
    },
    "responses": [
      {
        "text": "Nice to meet you, Draco.",
        "condition": { "not": { "u_has_effect": "u_met_Draco_Dune" } },
        "effect": { "u_add_effect": "u_met_Draco_Dune", "duration": "PERMANENT" },
        "topic": "TALK_REFUGEE_Draco_1_firstmeet",
        "switch": true
      },
      {
        "text": "Hi again, Draco, nice to see you too.",
        "condition": { "u_has_effect": "u_got_to_Draco_3_Draco_Dune" },
        "topic": "TALK_REFUGEE_Draco_5a"
      },
      {
        "text": "Hi, Draco.  What's up?",
        "condition": { "days_since_cataclysm": 180 },
        "topic": "TALK_REFUGEE_Draco_2",
        "switch": true
      },
      {
        "text": "Hi, Draco.  What's up?",
        "condition": { "days_since_cataclysm": 60 },
        "topic": "TALK_REFUGEE_Draco_2",
        "switch": true
      },
      {
        "text": "Hi, Draco.  What's up?",
        "condition": { "days_since_cataclysm": 30 },
        "topic": "TALK_REFUGEE_Draco_2",
        "switch": true
      },
      {
        "text": "Hi, Draco.  What's up?",
        "condition": { "u_has_effect": "u_met_Draco_Dune" },
        "topic": "TALK_REFUGEE_Draco_2",
        "switch": true
      },
      {
        "text": "Hi Draco, nice to meet you.  I gotta go though.",
        "effect": { "u_add_effect": "u_met_Draco_Dune", "duration": "PERMANENT" },
        "condition": { "not": { "u_has_effect": "u_met_Draco_Dune" } },
        "topic": "TALK_DONE"
      },
      {
        "text": "Hi Draco, nice to see you too.  I gotta go though.",
        "condition": { "u_has_effect": "u_met_Draco_Dune" },
        "topic": "TALK_DONE"
      }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_REFUGEE_Draco_1_firstmeet",
    "dynamic_line": "Nice to meet you too.  What brings you to these parts?  Got any stories to share?  Happy ones, hopefully... we've had our fill of sadness around here.",
    "responses": [
      { "text": "What about you, how're you doing?", "topic": "TALK_REFUGEE_Draco_2" },
      { "text": "Yeah, it's tough everywhere.  Well, bye.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_REFUGEE_Draco_2",
    "dynamic_line": "Well, look at you.  Asking after random folks like some sort of shepherd!  No, don't take offense now... I mean it well.  We could use more folks askin' after other folks.  I figure it makes the world go round, now, more than ever.  I'm well, friend, considering I have both of my legs and much of my health left to me.  A bit of pain in the back, but can't really complain much if that's the worst of it, right?  You look like you've had a story of your own to tell, just getting here.  I'm writing it in my imagination right now.  Fought through countless hordes, run ragged, chased at every turn, yeah, no thank-you any more of that for me!",
    "responses": [
      { "text": "What about you, what's your story?", "topic": "TALK_REFUGEE_Draco_3" },
      { "text": "No more indeed.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_REFUGEE_Draco_3",
    "dynamic_line": "Oh you don't have time for all that, do you?  Well, I'll give you the short version.  I've gotten kinda tired of it in the telling.  Frankly, it's not as heroic, not as inspiring, not as tragic, and certainly not as funny as some of the tales around here.  But it's mine, ya know?  I'm a musician.  Guitar's my baby.  You like folk and the blues, friend?  Well, that was my bag and I sure could please my own ear with em, anyway.  Folks who's bein' generous might also say it pleased theirs.  Problem is, I seem to be between guitars right now, you know? Temporarily guitar-light, if you get my saying.  Problem is, in the run for my life, I had to use old Jasmine as a bit of a billy club.  Had to curb some rowdy dudes on my way here.  Is was her or me, you understand?  You wouldn't begrudge a man breakin' his instrument to save his life, would ya?",
    "effect": { "u_add_effect": "u_met_Draco_Dune", "duration": "PERMANENT" },
    "responses": [
      { "text": "I think I would've done the same.  Nobody around here has a guitar?", "topic": "TALK_REFUGEE_Draco_4" },
      { "text": "Yes, yes I would... you monster.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_REFUGEE_Draco_4",
    "dynamic_line": "Would you believe that they don't!  Not a one in the whole place.  Well, maybe downstairs, but that's a different matter, isn't it?  Say, you're not planning on sticking around, right?  You're a free-roller, not a settler, seems like to me.  Don't know if I could beg or cajole you into maybe keepin' an ear out for a new guitar for me?  There gotta still be plenty out there not gettin' any love these days.  Whattya say?  Help an old man play some blues?  Would be good to have some real music around this place.  Be good for PEOPLE, you know what I'm sayin'?",
    "responses": [
      { "text": "Where would we be without music?", "topic": "TALK_REFUGEE_Draco_5a" },
      { "text": "You're aware that the world has ended, right?  I've got real problems to deal with.  You're on your own.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_REFUGEE_Draco_5a",
    "dynamic_line": "Let me ask you something.  What type are you?",
    "responses": [
      { "text": "Uhh, what do you mean?", "topic": "TALK_REFUGEE_Draco_5b" },
      { "text": "I'll tell you what type I am.", "topic": "TALK_REFUGEE_Draco_5c" },
      { "text": "No, not playing this game.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_REFUGEE_Draco_5b",
    "dynamic_line": "You know, what what kinda person are you?  What motivates you?",
    "responses": [
      { "text": "I'll tell you what type I am.", "topic": "TALK_REFUGEE_Draco_5c" },
      { "text": "Leaving.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_REFUGEE_Draco_5c",
    "dynamic_line": "So then, what type are you?",
    "responses": [
      { "text": "The 'just getting by' type.", "topic": "TALK_REFUGEE_Draco_6a" },
      { "text": "The serious type.", "topic": "TALK_REFUGEE_Draco_6b" },
      { "text": "The zany type.", "topic": "TALK_REFUGEE_Draco_6c" },
      { "text": "I fight stuff.", "topic": "TALK_REFUGEE_Draco_6d" },
      { "text": "I want to see it all.", "topic": "TALK_REFUGEE_Draco_6e" },
      { "text": "The 'doesn't have time for this' type.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_REFUGEE_Draco_6a",
    "dynamic_line": "Me too!  You can understand how folks be wantin' some liveliness in these times. Some music sure would help with that.  Damn, I miss it.  All I hear is those MP3 players with there tin-can drum machines and whiny vocals.  Help me find a guitar and we'll really get this place smokin'!",
    "responses": [
      { "text": "I could be persuaded.", "topic": "TALK_MISSION_LIST" },
      { "text": "I like that kind of music.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_REFUGEE_Draco_6b",
    "dynamic_line": "Me too!  Times are hard for folks and that's no laughing matter.  People need some normality in these times.  Some reminders how things used to be.  I think a sing-along or two could do folks good.",
    "responses": [
      { "text": "Couldn't hurt.", "topic": "TALK_MISSION_LIST" },
      { "text": "I don't sing.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_REFUGEE_Draco_6c",
    "dynamic_line": "Me too!  I did stand-up comedy at a club once.  Well, outside a club anyway.  You know what'd be funny?  Next time one of those stupid ferals starts running around chasing after a squirrel or something, if I had me a guitar I could play the Benny Hill tune and get everybody crackin' up.  Places needs some laughter badly.",
    "responses": [
      { "text": "That'd be awesome.", "topic": "TALK_MISSION_LIST" },
      { "text": "Yeah, wouldn't be that funny when Zed heard all the sound and broke in.  Be responsible.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_REFUGEE_Draco_6d",
    "dynamic_line": "Me too.  It's fight a stay afloat in these times.  Some music would lift all spirits, though, don't you think?",
    "responses": [
      { "text": "Can you play heavy metal on an acoustic guitar?", "topic": "TALK_MISSION_LIST" },
      { "text": "Boring.  I'm going to go destroy something.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_REFUGEE_Draco_6e",
    "dynamic_line": "Me too!  For now, anyway, that's not really possible for me.  I mean, I guess you know better than me about that.  Man, I used to travel all around.  Saw halfa the States with my guitar on my back.  Now, though, well, I think I'll stay inside for now.",
    "responses": [
      { "text": "Maybe I could help with something?", "topic": "TALK_MISSION_LIST" },
      { "text": "Well then, I'll leave you here where it's safe.", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "MISSION_REFUGEE_Draco_GET_GUITAR",
    "type": "mission_definition",
    "name": "Bring Draco an acoustic guitar.",
    "difficulty": 1,
    "value": 0,
    "goal": "MGOAL_FIND_ITEM",
    "item": "acoustic_guitar",
    "origins": [ "ORIGIN_SECONDARY" ],
    "dialogue": {
      "describe": "Yeah, sure, imagine how things would be if we had some live music around here?  I don't know how much I could thank you, though, if you're looking for payment.  You'd sure be improving the mood, though.",
      "offer": "I just want a functional acoustic guitar.  Preferably one that hasn't been used to cave in any zombie skulls.",
      "accepted": "Great!  We'll be makin' music in no time!",
      "rejected": "Oh well.  I understand your reluctancy... I guess.",
      "advice": "Well, I'll let you in on a little secret.  Guitars COULD be found at a music store.  Let that one sink in a bit.",
      "inquire": "How's my guitar comin', friend?",
      "success": "Hell yeah, bud!  You just made a lot of people really happy!",
      "success_lie": "Huh.  This... is something, isn't it.",
      "failure": "No worries.  They don't grow from trees, but we have time."
    }
  }
]

/*
!
!
!

NOTES NOTES NOTES AND COPYPASTA FOR USE LATER



Folks have been missing the little things in life.  New shoes, new cellphones, can't exactly go shopping, or, well, I guess you sorta can, if you mind the broken glass.  I left my wallet in an outdoorsman's store when I 'bought' this warmer coat.  Figured that's kinda it, you know?  It didn't matter anymore.  I don't think my insurance's going to pay out for any health care I get anymore.  I did what you see in the movies though, I rolled one up in a hundred dollar bill.  Ended up coughing and rerolling it in regular paper though.  Was too harsh.  Just letting you know in case you get the smart idea of trying it.

Say, I don't mean to get you in any trouble or nothing, but you haven't seen any green around town, have ya?  
What?
WHAT.
Oh yeah, some people've been growing it in their basements.
I'm not comfortable with where this is going.

"What it comes down to is, what do we do now?  Some folks have asked when the cavalry is coming.  I ask, when do we admit that we're it?"



(If you decide to go with him buying marijuana from you, btw, I was thinking of him commenting that it helps him relax but also helps with his joints. He's supposed to be a bit older, early fifties or so)
he'll trade it for Merch (FMCNote) x4



Easiest thing is to contact me by DM on discord, but otherwise a good starting point would be to pick someone in the refugee center that you find interesting and start writing dialogue for them in a PR. Just let me know so we don't conflict. Draco Dune already exists in game, and would be a pretty good starting one: I planned to give him a quest to help him get a guitar to play music for the other refugees. In my notes he's a pleasant, laid back guy who is doing his best to take this all in stride. He might also trade you some Merch (free merchant money) for marijuana once per week.


https://github.com/CleverRaven/Cataclysm-DDA/blob/bc6d06acd32ae65435a6d62c8a210a1e29acb6a8/data/json/npcs/refugee_center/surface_refugees/NPC_Vanessa_Toby.json

Basically you need to check the condition u_has_item to make sure the player has weed, and if they do, use u_sell_item to give the weed to the NPC
then u_buy_item to give the player some merch in return
Then you probably want to define an effect and use npc_add_effect to give Draco an effect that expires in several days once he's bought pot from you, so you can't just keep selling it to him to get infinite merch








{
    "id": "BGSS_PREPPER_2_STORY1",
    "type": "talk_topic",
    "dynamic_line": "Oh, man.  I thought I was ready.  I had it all planned out.  Bug out bags.  Loaded guns.  Maps of escape routes.  Bunker in the back yard.",
    "responses": [
      { "text": "Sounds like it didn't work out.", "topic": "BGSS_PREPPER_2_STORY2" },
      {
        "text": "Hey, I'd really be interested in seeing those maps.",
        "topic": "BGSS_PREPPER_2_MAPS",
        "condition": { "not": { "npc_has_effect": "player_BGSS_SAIDYES" } }
      },
      { "text": "<done_conversation_section>", "topic": "TALK_FRIEND" },
      { "text": "<end_talking>", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "BGSS_PREPPER_2_STORY2",
    "type": "talk_topic",
    "dynamic_line": "Depends on your definition.  I'm alive, aren't I?  When Hell itself came down from the skies and monsters started attacking the cities, I grabbed my stuff and crammed into the bunker.  My surface cameras stayed online for days; I could see everything happening up there.  I watched those things stride past.  I still have nightmares about the way their bodies moved, like they broke the world just to be here.  I had nothing better to do.  I watched them rip up the cops and the military, watched the dead rise back up and start fighting the living.  I watched the nice old lady down the street rip the head off my neighbor's dog.  I saw a soldier's body twitch and grow into some kind of electrified hulk beast.  I watched it all happen.",
    "responses": [
      { "text": "Why did you leave your bunker?", "topic": "BGSS_PREPPER_2_STORY3" },
      {
        "text": "Hey, I'd really be interested in seeing those maps.",
        "topic": "BGSS_PREPPER_2_MAPS",
        "condition": { "not": { "npc_has_effect": "player_BGSS_SAIDYES" } }
      },
      { "text": "<done_conversation_section>", "topic": "TALK_FRIEND" },
      { "text": "<end_talking>", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "BGSS_PREPPER_2_STORY3",
    "type": "talk_topic",
    "dynamic_line": "Honestly?  I was planning to die.  After what I'd seen, I went a little crazy.  I thought it was over for sure, I figured there was no point in fighting it.  I thought I wouldn't last a minute out here, but I couldn't bring myself to end it down there.  I headed out, planning to let the <zombies> finish me off, but what can I say?  Survival instinct is a funny thing, and I killed the ones outside the bunker.  I guess the adrenaline was what I needed.  It's kept me going since then.",
    "responses": [
      {
        "text": "Hey, I'd really be interested in seeing those maps.",
        "topic": "BGSS_PREPPER_2_MAPS",
        "condition": { "not": { "npc_has_effect": "player_BGSS_SAIDYES" } }
      },
      { "text": "Thanks for telling me that.  <done_conversation_section>", "topic": "TALK_FRIEND" },
      { "text": "Thanks for telling me that.  <end_talking>", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "BGSS_PREPPER_2_MAPS",
    "type": "talk_topic",
    "dynamic_line": "Yeah, I do.  I'd be willing to part with them for, say, $1000.  Straight from your ATM account, no cash cards.",
    "responses": [
      {
        "text": "[$1000] You have a deal.",
        "topic": "BGSS_PREPPER_2_SOLD",
        "condition": { "u_has_cash": 100000 },
        "effect": { "u_spend_cash": 100000 }
      },
      {
        "text": "Whatever's in that map benefits both of us.",
        "condition": { "not": { "npc_has_effect": "player_BGSS_SAIDNO" } },
        "trial": { "type": "PERSUADE", "difficulty": 40, "mod": [ [ "VALUE", 3 ], [ "TRUST", 1 ] ] },
        "success": { "topic": "BGSS_PREPPER_2_SOLD" },
        "failure": { "topic": "BGSS_PREPPER_2_NOSALE" }
      },
      {
        "text": "How 'bout you <swear> hand it over and I don't get <swear> pissed off?",
        "condition": { "not": { "npc_has_effect": "player_BGSS_SAIDNO" } },
        "trial": { "type": "INTIMIDATE", "difficulty": 30, "mod": [ [ "BRAVERY", -1 ], [ "FEAR", 3 ] ] },
        "success": { "topic": "BGSS_PREPPER_2_SOLD" },
        "failure": { "topic": "BGSS_PREPPER_2_NOSALE" }
      },
      { "text": "Sorry for changing the subject.  What was it you were saying?", "topic": "TALK_NONE" },
      { "text": "<done_conversation_section>", "topic": "TALK_FRIEND" },
      { "text": "<end_talking>", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "BGSS_PREPPER_2_SOLD",
    "type": "talk_topic",
    "dynamic_line": "All right.  Here they are.",
    "responses": [
      {
        "text": "Thanks!  What was it you were saying before?",
        "effect": { "npc_add_effect": "player_BGSS_SAIDYES", "duration": "PERMANENT", "u_buy_item": "survivormap" },
        "topic": "TALK_NONE"
      },
      {
        "text": "Thanks!  <done_conversation_section>",
        "effect": { "npc_add_effect": "player_BGSS_SAIDYES", "duration": "PERMANENT", "u_buy_item": "survivormap" },
        "topic": "TALK_FRIEND"
      },
      {
        "text": "Thanks!  <end_talking>",
        "effect": { "npc_add_effect": "player_BGSS_SAIDYES", "duration": "PERMANENT", "u_buy_item": "survivormap" },
        "topic": "TALK_DONE"
      }
    ]
  },
  {
    "id": "BGSS_PREPPER_2_NOSALE",
    "type": "talk_topic",
    "dynamic_line": "Nice try.  You want the maps, you pay up.",
    "responses": [
      {
        "text": "Fine.  What was it you were saying before?",
        "effect": { "npc_add_effect": "player_BGSS_SAIDNO", "duration": "PERMANENT" },
        "topic": "TALK_NONE"
      },
      {
        "text": "<done_conversation_section>",
        "effect": { "npc_add_effect": "player_BGSS_SAIDNO", "duration": "PERMANENT" },
        "topic": "TALK_FRIEND"
      },
      {
        "text": "<end_talking>",
        "effect": { "npc_add_effect": "player_BGSS_SAIDNO", "duration": "PERMANENT" },
        "topic": "TALK_DONE"
      }
    ]
  }
]


* /
