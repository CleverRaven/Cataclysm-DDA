[
  {
    "type": "npc",
    "id": "NPC_lighthouse_man",
    "gender": "male",
    "class": "NC_NONE",
    "name_unique": "Mikhail Frolov",
    "name_suffix": "Fisherman",
    "attitude": 0,
    "mission": 3,
    "chat": "TALK_lighthouse_man_1",
    "faction": "fisherman_family",
    "mission_offered": "MISSION_lighthouse_man_1"
  },
  {
    "type": "npc_class",
    "id": "NC_lighthouse_man",
    "common": false,
    "name": { "str": "Fisherman" },
    "job_description": "I'm just wandering.",
    "shopkeeper_item_group": "NPC_lighthouse_man_shop",
    "traits": [ { "group": "NPC_starting_traits" }, { "group": "Appearance_demographics" } ],
    "skills": [
      { "skill": "ALL", "level": { "mul": [ { "one_in": 3 }, { "sum": [ { "dice": [ 4, 2 ] }, { "rng": [ -4, -1 ] } ] } ] } }
    ]
  },
  {
    "type": "item_group",
    "id": "NPC_lighthouse_man_shop",
    "subtype": "collection",
    "items": [
      [ "fish_bait", 10 ],
      [ "fishspear", 10 ],
      [ "fish", 10 ],
      [ "fish_smoked", 10 ],
      [ "fish_cooked", 10 ],
      [ "salted_fish", 10 ],
      [ "fish_smoked", 10 ],
      [ "dry_fish", 10 ],
      [ "fish_pickled", 10 ],
      [ "fish_fried", 10 ],
      [ "soup_fish", 10 ],
      [ "doublespeargun", 10 ],
      [ "fish_trap", 10 ],
      [ "fishing_hook_bone", 10 ],
      [ "fishing_rod_basic", 10 ]
    ]
  },
  {
    "type": "talk_topic",
    "id": [
      "TALK_lighthouse_man_1",
      "TALK_lighthouse_man_Background",
      "TALK_lighthouse_man_hay",
      "TALK_lighthouse_man_survivors_yes",
      "TALK_lighthouse_man_survivors_no"
    ],
    "dynamic_line": "<greet>",
    "responses": [
      { "text": "About that job…", "condition": "has_assigned_mission", "topic": "TALK_MISSION_INQUIRE" },
      { "text": "<BGSS_intro_question>", "topic": "TALK_lighthouse_man_Background" },
      {
        "text": "Как ты?",
        "topic": "TALK_lighthouse_man_hay",
        "condition": { "npc_has_var": "helped_lighthouse_man", "type": "flag", "context": "help", "value": "yes" }
      },
      { "text": "Do you need any help?", "topic": "TALK_MISSION_LIST" },
      {
        "text": "Care to trade?",
        "topic": "TALK_lighthouse_man_1",
        "condition": { "npc_has_var": "helped_lighthouse_man", "type": "flag", "context": "help", "value": "yes" },
        "effect": "start_trade"
      },
      {
        "text": "Приходил кто-нибудь?",
        "condition": { "u_has_var": "lighthouse_fixed", "type": "global", "context": "safe_space", "value": "yes" },
        "trial": {
          "type": "CONDITION",
          "condition": {
            "not": { "npc_compare_time_since_var": "wait", "type": "time", "context": "survivors", "op": "<", "time": "14 days" }
          }
        },
        "success": {
          "topic": "TALK_lighthouse_man_survivors_yes",
          "effect": [
            { "npc_add_var": "wait", "type": "time", "context": "survivors", "time": true },
            { "mapgen_update": "lighthouse_man_survivor", "om_terrain": "lighthouse_ground" }
          ]
        },
        "failure": { "topic": "TALK_lighthouse_man_survivors_no" }
      },
      { "text": "Goodbye.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_lighthouse_man_Background",
    "dynamic_line": "Да я простой парень из простой семьи.  До <the_cataclysm> у меня был рыболовное судно, на нём же и ходил в море, добывать рыбу и прочую морскую живность.  Так жили мой дед, мой отец, да и я стал так жить.  У меня была большая семья, 7 человек, но выжили не многие, остались только жена да дочь…"
  },
  {
    "type": "talk_topic",
    "id": "TALK_lighthouse_man_hay",
    "dynamic_line": "Ты знаешь, очень даже хорошо.  Здесь уютно, много места, а главное безопасно.  Мы даже начали считать это место своим новым домом.  Кстати, я пока рыбачил, к острову приплыла бутылка с бумажкой внутри.  Вот, посмотри.\", он дал тебе какой-то лист бумаги, на нём написано: '0030045-0030045-35321700', и рядом нарисована оранжевая молния.  \"Интересно, чтобы это могло значить…"
  },
  {
    "type": "talk_topic",
    "id": "TALK_lighthouse_man_survivors_yes",
    "dynamic_line": "Заходил один, ну и остался.  Можешь поговорить с ним внизу."
  },
  {
    "type": "talk_topic",
    "id": "TALK_lighthouse_man_survivors_no",
    "dynamic_line": "Никого не было, <name_g>.  Я уж начинаю сомневаться, что кто-то ещё остался, кроме нас."
  },
  {
    "type": "talk_topic",
    "id": "TALK_lighthouse_man_lighthouse",
    "dynamic_line": "Are we there yet, <name_g>?",
    "responses": [
      {
        "text": "We're here.",
        "topic": "TALK_MISSION_INQUIRE",
        "condition": "mission_complete",
        "effect": [ "stop_following", { "npc_first_topic": "TALK_lighthouse_man_1" } ]
      },
      { "text": "Almost.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_lighthouse_man_cleaning",
    "dynamic_line": "Is it safe, my <name_g>?",
    "responses": [
      {
        "text": "Yes.  Ground floor is clear.",
        "topic": "TALK_lighthouse_man_cleaned",
        "condition": {
          "and": [
            { "npc_has_var": "lighthouse_man", "type": "count", "context": "cleaning", "value": "0" },
            "at_safe_space",
            { "npc_at_om_location": "lighthouse_ground" }
          ]
        },
        "effect": { "npc_adjust_var": "lighthouse_man", "type": "count", "context": "cleaning", "adjustment": 1 }
      },
      {
        "text": "Yes.  First floor is clear.",
        "topic": "TALK_lighthouse_man_cleaned",
        "condition": {
          "and": [
            { "npc_has_var": "lighthouse_man", "type": "count", "context": "cleaning", "value": "1" },
            "at_safe_space",
            { "npc_at_om_location": "lighthouse_z1" }
          ]
        },
        "effect": { "npc_adjust_var": "lighthouse_man", "type": "count", "context": "cleaning", "adjustment": 1 }
      },
      {
        "text": "Yes.  Second floor is clear.",
        "topic": "TALK_lighthouse_man_cleaned",
        "condition": {
          "and": [
            { "npc_has_var": "lighthouse_man", "type": "count", "context": "cleaning", "value": "2" },
            "at_safe_space",
            { "npc_at_om_location": "lighthouse_z2" }
          ]
        },
        "effect": { "npc_adjust_var": "lighthouse_man", "type": "count", "context": "cleaning", "adjustment": 1 }
      },
      {
        "text": "Yes.  Third floor is clear.",
        "topic": "TALK_lighthouse_man_cleaned",
        "condition": {
          "and": [
            { "npc_has_var": "lighthouse_man", "type": "count", "context": "cleaning", "value": "3" },
            "at_safe_space",
            { "npc_at_om_location": "lighthouse_z3" }
          ]
        },
        "effect": { "npc_adjust_var": "lighthouse_man", "type": "count", "context": "cleaning", "adjustment": 1 }
      },
      {
        "text": "Yes.  Fourth floor is clear.",
        "topic": "TALK_lighthouse_man_cleaned",
        "condition": {
          "and": [
            { "npc_has_var": "lighthouse_man", "type": "count", "context": "cleaning", "value": "4" },
            "at_safe_space",
            { "npc_at_om_location": "lighthouse_z4" }
          ]
        },
        "effect": { "npc_adjust_var": "lighthouse_man", "type": "count", "context": "cleaning", "adjustment": 1 }
      },
      {
        "text": "Yes.  Top floor is clear.",
        "condition": {
          "and": [
            { "npc_has_var": "lighthouse_man", "type": "count", "context": "cleaning", "value": "5" },
            "at_safe_space",
            { "npc_at_om_location": "lighthouse_z5" }
          ]
        },
        "effect": { "npc_adjust_var": "lighthouse_man", "type": "count", "context": "cleaning", "adjustment": 1 },
        "topic": "TALK_MISSION_INQUIRE"
      },
      { "text": "Not yet.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_lighthouse_man_cleaned",
    "dynamic_line": "<its_safe>  Let's clean the next floor.",
    "responses": [ { "text": "…", "topic": "TALK_DONE" } ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_lighthouse_man_family",
    "dynamic_line": "Did you find them, <name_g>?",
    "responses": [
      {
        "text": "We did it.  All safe.",
        "topic": "TALK_MISSION_SUCCESS",
        "condition": {
          "and": [
            { "u_has_mission": "MISSION_lighthouse_man_3" },
            { "not": "mission_complete" },
            { "u_has_var": "lighthouse_woman", "type": "flag", "context": "safe", "value": "yes" },
            { "u_has_var": "lighthouse_girl", "type": "flag", "context": "safe", "value": "yes" }
          ]
        },
        "effect": [ "mission_success", { "npc_first_topic": "TALK_lighthouse_man_1" } ]
      },
      {
        "text": "I'm sorry, I failed you… I couldn't bring them alive…",
        "topic": "TALK_lighthouse_man_fail",
        "condition": {
          "and": [
            "mission_complete",
            { "not": { "u_has_var": "lighthouse_woman", "type": "flag", "context": "safe", "value": "yes" } },
            { "u_has_var": "lighthouse_girl_dead", "type": "flag", "context": "death", "value": "yes" }
          ]
        },
        "effect": { "npc_first_topic": "TALK_lighthouse_man_1" }
      },
      {
        "text": "I'm sorry, I failed you… I couldn't bring your wife alive…",
        "topic": "TALK_lighthouse_man_fail",
        "condition": { "and": [ "mission_complete", { "u_has_var": "lighthouse_girl", "type": "flag", "context": "safe", "value": "yes" } ] },
        "effect": { "npc_first_topic": "TALK_lighthouse_man_1" }
      },
      {
        "text": "I'm sorry, I failed you… I couldn't bring your daughter alive…",
        "topic": "TALK_lighthouse_man_fail",
        "condition": {
          "and": [
            { "not": "mission_complete" },
            { "u_has_var": "lighthouse_woman", "type": "flag", "context": "safe", "value": "yes" },
            { "u_has_var": "lighthouse_girl_dead", "type": "flag", "context": "death", "value": "yes" }
          ]
        },
        "effect": { "npc_first_topic": "TALK_lighthouse_man_1" }
      },
      { "text": "Nothing, really.", "topic": "TALK_DONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_lighthouse_man_fail",
    "dynamic_line": "<name_g>… я доверил тебе самое ценное, что у меня осталось, а ты…",
    "responses": [ { "text": "I'm sorry…", "topic": "TALK_DONE", "effect": "end_conversation" } ]
  },
  {
    "id": "MISSION_lighthouse_man_1",
    "type": "mission_definition",
    "has_generic_rewards": false,
    "name": { "str": "Lighthouse" },
    "description": "Lead Mikhail to lighthouse.",
    "goal": "MGOAL_GO_TO",
    "difficulty": 0,
    "value": 5000,
    "start": {
      "assign_mission_target": { "om_terrain": "lighthouse_ground", "reveal_radius": 10 },
      "effect": [ "follow_only", { "npc_first_topic": "TALK_lighthouse_man_lighthouse" } ]
    },
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_lighthouse_man_2",
    "dialogue": {
      "describe": "-",
      "offer": "Мы уже давно странствуем с моей семьёй по штату после <the_cataclysm>, и я понял, что самое безопасное укрытие - остров.  Я оставил свою семью в убежище, а сам пошёл обследовать местность, в поисках какого-нибудь островка рядом, в озере или в океане.  И знаешь, я нашёл морскую карту с пометкой навигационных маяков недалеко отсюда.  Если хочешь, можешь помочь мне добраться до одного такого и хорошенько там всё осмотреть.",
      "accepted": "Good.  I'll be right behind you.",
      "rejected": "Ну, как хочешь.",
      "advice": "Сначала нам нужно найти транспорт, чтобы добраться туда.",
      "inquire": "Наконец-то добрались.",
      "success": "Выглядит отлично, <name_g>.  Теперь, мне нужно как-то очистить это место от <zombies>…",
      "success_lie": "-",
      "failure": "-"
    }
  },
  {
    "id": "MISSION_lighthouse_man_2",
    "type": "mission_definition",
    "has_generic_rewards": false,
    "name": { "str": "Clean lighthouse" },
    "description": "Clean lighthouse from <zombies> with Mikhail.",
    "goal": "MGOAL_CONDITION",
    "goal_condition": { "npc_has_var": "lighthouse_man", "type": "count", "context": "cleaning", "value": "6" },
    "difficulty": 0,
    "value": 5000,
    "start": {
      "effect": [
        "follow_only",
        { "npc_first_topic": "TALK_lighthouse_man_cleaning" },
        { "npc_add_var": "lighthouse_man", "type": "count", "context": "cleaning", "value": "0" }
      ]
    },
    "end": {
      "effect": [
        "stop_following",
        { "npc_first_topic": "TALK_lighthouse_man_1" },
        { "npc_lose_var": "lighthouse_man", "type": "count", "context": "cleaning", "value": "6" }
      ]
    },
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_lighthouse_man_3",
    "dialogue": {
      "describe": "-",
      "offer": "Так, маяк мы нашли.  Теперь, нужно его зачистить.  Хочешь помочь мне в этом?",
      "accepted": "Отлично.  Сделаем это вместе.  Я буду прямо за тобой.  Будем чистить этаж за этажом.  Если решишь, что этаж чист, скажи мне об этом, и мы перейдём к следующему, и так до самого верха.",
      "rejected": "Ну, как хочешь.",
      "advice": "Будь <very> аккуратен.  В тесных помещениях эти <name_b>s опаснее всего.",
      "inquire": "<its_safe>",
      "success": "Отлично, просто отлично.  Осталось только отмыть все полы…",
      "success_lie": "-",
      "failure": "-"
    }
  },
  {
    "id": "MISSION_lighthouse_man_3",
    "type": "mission_definition",
    "name": { "str": "Fisherman's family" },
    "description": "Mikhail asked you to bring back his family.",
    "goal": "MGOAL_ASSASSINATE",
    "difficulty": 0,
    "value": 25000,
    "start": {
      "effect": { "npc_first_topic": "TALK_lighthouse_man_family" },
      "assign_mission_target": { "om_terrain": "house_04_basement", "reveal_radius": 2 },
      "update_mapgen": {
        "place_npcs": [
          { "class": "NPC_lighthouse_woman", "x": 4, "y": 8, "target": true },
          { "class": "NPC_lighthouse_girl", "x": 3, "y": 8 }
        ]
      }
    },
    "end": { "effect": { "u_add_var": "lighthouse_family_safe", "type": "flag", "context": "help", "value": "yes" } },
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_lighthouse_man_4",
    "dialogue": {
      "describe": "-",
      "offer": "Маяк найден и очищен от <zombies>.  Теперь, мне нужно привести сюда мою семью.  Можно тебя попросить об услуге,  Поскольку мы приплыли на твоём транспорте, можешь вернуться назад, найти мою семью и привести их сюда?",
      "accepted": "Ты мой спаситель.  Я пока осмотрюсь тут, подготовлю здесь всё к их приезду.",
      "rejected": "Ну, как хочешь.",
      "advice": "Пожалуйста, будь очень осторожен.  Я не хочу потерять и их.",
      "inquire": "-",
      "success": "Я даже не знаю, как тебя отблагодарить, <name_g>.  Я в вечном долгу перед тобой.",
      "success_lie": "-",
      "failure": "-"
    }
  },
  {
    "id": "MISSION_lighthouse_man_4",
    "type": "mission_definition",
    "name": { "str": "Fisherman's boat" },
    "description": "Help Mikhail make a boat.  Bring 250 nails.",
    "goal": "MGOAL_FIND_ITEM",
    "item": "nail",
    "count": 250,
    "difficulty": 0,
    "value": 10000,
    "end": {
      "update_mapgen": {
        "om_terrain": "lighthouse_ground",
        "place_vehicles": [ { "vehicle": "canoe", "x": 3, "y": 3, "rotation": 0, "status": 0 } ]
      },
      "effect": [ { "npc_add_var": "helped_lighthouse_man", "type": "flag", "context": "help", "value": "yes" } ]
    },
    "origins": [ "ORIGIN_SECONDARY" ],
    "followup": "MISSION_lighthouse_man_5",
    "dialogue": {
      "describe": "-",
      "offer": "Здание очищено от <zombies>, моя семья здесь, всё складывается как нельзя лучше.  Осталось лишь обеспечить себя едой, транспортом и о будущем можно не волноваться.  Ты так помог мне и моей семье, может, поможешь нам ещё кое с чем?  Мне нужна лодка для рыбалки, ну и просто чтобы осматривать окрестности.  Поможешь мне сделать лодку?",
      "accepted": "Спасибо, <name_g>.  Мне нужно всего ничего: 250 nails.  Доски я найду, остальные инструменты тоже, а вот с гвоздями беда.  Многовато для одной лодки, но я хочу иметь ресурсов про запас, на всякий случай.",
      "rejected": "Ну, как хочешь.",
      "advice": "Пожалуйста, если можешь, не нужно разбирать здесь мебель.  Она ещё может пригодиться.",
      "inquire": "Нашёл?",
      "success": "<very> good, <name_g>, thank you!  Теперь нам не страшны ни голод, ни дождь, ни прочая погода, хе-хе.  Кстати, у меня есть небольшой запас рыбы, снастей, приманок да удилищ.  Если интересно, могу поделиться с тобой.",
      "success_lie": "-",
      "failure": "-"
    }
  },
  {
    "//": "TODO change update_mapgen",
    "id": "MISSION_lighthouse_man_5",
    "type": "mission_definition",
    "name": { "str": "Fix lighthouse" },
    "description": "Find someone to fix lighthouse.",
    "goal": "MGOAL_CONDITION",
    "goal_condition": { "u_has_var": "lighthouse_fixed", "type": "global", "context": "safe_space", "value": "ready" },
    "difficulty": 0,
    "value": 100000,
    "end": {
      "update_mapgen": {
        "om_terrain": "lighthouse_z5",
        "place_terrain": [ { "ter": "t_floor_olight", "x": 11, "y": 12 }, { "ter": "t_floor_olight", "x": 13, "y": 13 } ]
      },
      "effect": [
        { "npc_add_var": "wait", "type": "time", "context": "survivors", "time": true },
        { "u_add_var": "lighthouse_fixed", "type": "global", "context": "safe_space", "value": "yes" }
      ]
    },
    "origins": [ "ORIGIN_SECONDARY" ],
    "dialogue": {
      "describe": "-",
      "offer": "Моя семья в сборе, у нас есть запас еды, воды, транспорт и надёжная крыша над головой, и всё это благодаря тебе, <name_g>.  Теперь, я тоже хочу помочь другим выжившим.  Я вот что подумал: если мне удастся запустить этот старый маяк, другие выжившие увидят его свет издалека.  Если они его увидят, подумают, что здесь есть живые, и попробуют доплыть сюда.  Поможешь починить его?",
      "accepted": "Я знал что ты не откажешь!  Правда, есть одна проблема: я понятия не имею как его починить.  Может, если ты встретишь кого-нибудь, у кого есть experience in electrical engineering, мы сможем разобраться, как запустить эту старую рухлядь.",
      "rejected": "Ну, как хочешь.",
      "advice": "Я уверен, что не все сгорели в пламени <the_cataclysm> и ты сможешь найти подходящего человека.",
      "inquire": "Получилось?",
      "success": "Здорово, <name_g>!  Остаётся только ждать…",
      "success_lie": "-",
      "failure": "-"
    }
  },
  {
    "//": "TODO change npc to random npc or something like that",
    "type": "mapgen",
    "update_mapgen_id": "lighthouse_man_survivor",
    "method": "json",
    "object": { "place_npcs": [ { "class": "survivor_cop", "x": [ 7, 17 ], "y": [ 10, 15 ] } ] }
  }
]
